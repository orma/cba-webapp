(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/locales/source/en.json":[function(require,module,exports){
module.exports={
    "Analytics": "Analytics",
    "Assets": "Assets",
    "Provinces": "Provinces",
    "Explore": "Explore",
    "Editor": "Editor",
    "Tasks": "Tasks",
    "Task": "Task",
    "Province": "Province",
    "Field": "Field",
    "Done": "Done",
    "Status": "Status",
    "Total": "Total",
    "Complete": "Complete",
    "% Complete": "% Complete",
    "Progress": "Progress",
    "Language": "Language",
    "Search": "Search",
    "Options": "Options",
    "Clear search": "Clear search",
    "Loading": "Loading",
    "Width": "Width",
    "Condition": "Condition",
    "Surface": "Surface",
    "added": "added",
    "not added": "not added",
    "Back to overview": "Back to overview",
    "Select language": "Select language",
    "No data available": "No data available",
    "Change Language": "Change Language",
    "Menu": "Menu",
    "Previous": "Previous",
    "Next": "Next",
    "PCS": "PCS",
    "Tracking and visualizing road assets in Vietnam for inclusive growth.": "Tracking and visualizing road assets in Vietnam for inclusive growth.",
    "Access and improve Road Networks": "Access and improve Road Networks",
    "Work with the OpenRoads project to close this critical information gap and create a comprehensive road network of Vietnam": "Work with the OpenRoads project to close this critical information gap and create a comprehensive road network of Vietnam",
    "View assets": "View assets",
    "VPRoMMS Assets By Province": "VPRoMMS Assets By Province",
    "of VPRoMMS Ids have field data collected": "of VPRoMMS Ids have field data collected",
    "Visualized variable": "Visualized variable",
    "Road without VPRoMMS ID": "Road without VPRoMMS ID",
    "View analytics": "View analytics",
    "Explore on map": "Explore on map",
    "VPRoMMS Edits By Province": "VPRoMMS Edits By Province",
    "of VPRoMMS Ids added": "of VPRoMMS Ids added",
    "Show road without VPRoMMS ID": "Show road without VPRoMMS ID",
    "Select visualized variable": "Select visualized variable",
    "Page Not Found": "Page Not Found",
    "Select an action": "Select an action",
    "Information on VPRoMMS roads is not available": "Information on VPRoMMS roads is not available",
    "of VPRoMMS Ids have field data": "of VPRoMMS Ids have field data",
    "Download": "Download",
    "Download Roads": "Download Roads",
    "Download road network": "Download road network",
    "Road": "Road",
    "Roads": "Roads",
    "Districts": "Districts",
    "Performing action...": "Performing action...",
    "Selected": "Selected",
    "road selected": "road selected",
    "roads selected": "roads selected",
    "Select at least another one": "Select at least another one",
    "No roads selected yet. Click a road to select it": "No roads selected yet. Click a road to select it",
    "1 road selected. Select at least one more": "1 road selected. Select at least one more",
    "Cancel": "Cancel",
    "Confirm": "Confirm",
    "Submit": "Submit",
    "Delete": "Delete",
    "Create": "Create",
    "Confirm Delete": "Confirm Delete",
    "Key": "Key",
    "Value": "Value",
    "Create New Property": "Create New Property",
    "Remove Duplicates": "Remove Duplicates",
    "Remove Duplicate Roads": "Remove Duplicate Roads",
    "Click on a road to keep. The other roads here will be deleted.": "Click on a road to keep. The other roads here will be deleted.",
    "Delete Road": "Delete Road",
    "Edit Road": "Edit Road",
    "Add Road": "Add Road",
    "Create New Road": "Create New Road",
    "New Road Id": "New Road Id",
    "Invalid Road Id": "Invalid Road Id",
    "Create Intersection": "Create Intersection",
    "Finish task": "Finish task",
    "Skip task": "Skip task",
    "Show": "Show",
    "Hide": "Hide",
    "Upload": "Upload",
    "Upload RoadLabPro ZIP files": "Upload RoadLabPro ZIP files",
    "Road properties": "Road properties",
    "Road geometries": "Road geometries",
    "FAQ": "FAQ",
    "Frequently Asked Questions": "Frequently Asked Questions",
    "If you have any remaining questions": "If you have any remaining questions",
    "email us": "email us",
    "Question regarding ORMA, not answered in the FAQ": "Question regarding ORMA, not answered in the FAQ",
    "Select roads to work on": "Select roads to work on",
    "Choose an action to perform": "Choose an action to perform",
    "Showing 1 Road": "Showing 1 Road",
    "Showing 2 Roads": "Showing 2 Roads",
    "Showing": "Showing",
    "Admin": "Admin",
    "Admin Level": "Admin Level",
    "Search by Admin Area": "Search by Admin Area",
    "Search by VPRoMMS ID": "Search by VPRoMMS ID",
    "Please search for an Admin Area": "Please search for an Admin Area",
    "No results available. Please refine your search": "No results available. Please refine your search.",
    "No available data": "No available data",
    "Highway": "Highway",
    "Properties": "Properties",
    "Field Data": "Field Data",
    "View": "View",
    "Field Data Sources": "Field Data Sources",
    "Loading your first task": "Loading your first task",
    "Tasks Remaining": "Tasks Remaining",
    "No tasks remaining": "No tasks remaining",
    "Error": "Error",
    "Connection Error": "Connection Error",
    "Already Exists": "Already Exists",
    "Bad response": "Bad response",
    "Data not available": "Data not available",
    "Could not update task status": "Could not update task status",
    "Are you sure you want to delete VPRoMMS": "Are you sure you want to delete VPRoMMS",
    "Improve Map": "Improve Map",
    "VPRoMMS ID": "VPRoMMS ID",
    "Road Name": "Road Name",
    "Road Type": "Road Type",
    "Risk Score": "Risk Score",
    "Road Number": "Road Number",
    "End Latitude": "End Latitude",
    "Surface Type": "Surface Type",
    "Poverty Score": "Poverty Score",
    "Terrain Class": "Terrain Class",
    "Traffic Level": "Terrain Level",
    "End Longitude": "End Longitude",
    "End Point Name": "End Point Name",
    "Moisture Class": "Moisture Class",
    "Start Latitude": "Start Latitude",
    "Road Class Code": "Road Class Code",
    "Roughness (IRI)": "Roughness (IRI)",
    "IRI": "IRI",
    "No data": "No data",
    "Roughness Score": "Roughness Score",
    "Start Longitude": "Start Longitude",
    "Start Point Name": "Start Point Name",
    "Criticality Score": "Criticality Score",
    "Structural Number": "Structural Number",
    "Temperature Class": "Temperature Class",
    "or_responsibility": "or_responsibility",
    "Road Length (ORMA)": "Road Length (ORMA)",
    "Road Length (VProMMS)": "Road Length (VProMMS)",
    "Accessibility Score": "Accessibility Score",
    "Large Bus (veh/day)": "Large Bus (veh/day)",
    "Pavement Age (year)": "Pavement Age (year)",
    "Small Bus (veh/day)": "Small Bus (veh/day)",
    "Small Car (veh/day)": "Small Car (veh/day)",
    "Embankment Width (m)": "Embankment Width (m)",
    "Medium Bus (veh/day)": "Medium Bus (veh/day)",
    "Medium Car (veh/day)": "Medium Car (veh/day)",
    "Motorcycle (veh/day)": "Motorcycle (veh/day)",
    "Carriageway Width (m)": "Carriageway Width (m)",
    "Heavy Truck (veh/day)": "Heavy Truck (veh/day)",
    "Light Truck (veh/day)": "Light Truck (veh/day)",
    "Management Class Code": "Management Class Code",
    "Number of Lanes Class": "Number of Lanes Class",
    "Road Length (VPRoMMS)": "Road Length (VPRoMMS)",
    "Medium Truck (veh/day)": "Medium Truck (veh/day)",
    "4 Wheel Drive (veh/day)": "4 Wheel Drive (veh/day)",
    "Total Traffic (veh/day)": "Total Traffic (veh/day)",
    "Drainage Condition Class": "Drainage Condition Class",
    "Pavement Condition Class": "Pavement Condition Class",
    "Delivery Vehicle (veh/day)": "Delivery Vehicle (veh/day)",
    "Articulated Truck (veh/day)": "Articulated Truck (veh/day)",
    "Traffic Annual Growth Scenario": "Traffic Annual Growth Scenario",
    "Length (ORMA)": "Length (ORMA)",
    "Length (Tabular)": "Length (Tabular)",
    "Filter tasks by province": "Filter tasks by province",
    "Select a VPROMMID to apply": "Select a VPROMMID to apply",
    "province": "province",
    "commune": "commune",
    "district": "district"
}

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/locales/vi.json":[function(require,module,exports){
module.exports={
    "Analytics": "Phân tích",
    "Assets": "Tài sản",
    "Provinces": "Các tỉnh",
    "Explore": "Hiển thị",
    "Editor": "Chỉnh sửa",
    "Tasks": "Nhiệm vụ",
    "Task": "Nhiệm vụ",
    "Province": "Tỉnh",
    "Field": "Trường dữ liệu",
    "Done": "Hoàn thành",
    "Status": "Tình trạng",
    "Total": "Tổng",
    "Complete": "Hoàn thành",
    "% Complete": "% hoàn thành",
    "Progress": "Tiến độ",
    "Language": "Ngôn ngữ",
    "Search": "Tìm kiếm",
    "Options": "Tùy chọn",
    "Clear search": "Xóa tìm kiếm",
    "Loading": "Đang tải",
    "Width": "Chiều rộng",
    "Condition": "Tình trạng",
    "Surface": "Mặt đường",
    "added": "Đã có",
    "not added": "Chưa có",
    "Back to overview": "Quay về trang chủ",
    "Select language": "Lựa chọn ngôn ngữ",
    "No data available": "Không có dữ liệu",
    "Change Language": "Đổi ngôn ngữ",
    "Menu": "Mục chọn",
    "Previous": "Trước",
    "Next": "Tiếp",
    "PCS": "Chỉ số dự án",
    "Tracking and visualizing road assets in Vietnam for inclusive growth.": "Theo dõi và hiển thị tài sản đường bộ Việt Nam cho tăng trưởng chiều sâu",
    "Access and improve Road Networks": "Truy cập và cải thiện mạng lưới đường bộ",
    "Work with the OpenRoads project to close this critical information gap and create a comprehensive road network of Vietnam": "Làm việc với nền tảng OpenRoads để rút ngắn khoảng cách về thông tin và tạo ra một mạng lưới đường bộ toàn diện của Việt Nam",
    "View assets": "Xem tài sản",
    "VPRoMMS Assets By Province": "VProMMS theo Tỉnh",
    "of VPRoMMS Ids have field data collected": "VProMMS Ids có dự liệu hiện trường",
    "Visualized variable": "Thuộc tính hiển thị",
    "Road without VPRoMMS ID": "Đường không có mã VProMMS",
    "View analytics": "Xem phân tích",
    "Explore on map": "Hiển thị bản đồ",
    "VPRoMMS Edits By Province": "VProMMS theo Tỉnh",
    "of VPRoMMS Ids added": "mã VProMMS đã được thêm vào",
    "Show road without VPRoMMS ID": "Hiện đường không có mã VProMMS",
    "Select visualized variable": "Lựa chọn thuộc tính hiển thị",
    "Page Not Found": "Không tìm thấy trang",
    "Select an action": "Chọn thao tác",
    "Information on VPRoMMS roads is not available": "Không có dữ liệu VPRoMMS",
    "of VPRoMMS Ids have field data": "VProMMS ID có dự liệu hiện trường",
    "Download": "Tải về",
    "Download Roads": "Tải dữ liệu đường",
    "Download road network": "Tải xuống mạng lưới đường",
    "Road": "Đường",
    "Roads": "Các đường",
    "Districts": "Huyện",
    "Performing action...": "Chương trình đang chạy...",
    "Selected": "Đã chọn",
    "road selected": "đường đã chọn",
    "roads selected": "đường đã chọn",
    "Select at least another one": "Lựa chọn ít nhất một đối tượng nữa",
    "No roads selected yet. Click a road to select it": "Chưa có đường nào được chọn. Ấn vào một đường để chọn",
    "1 road selected. Select at least one more": "1 đường được chọn. Lựa chọn ít nhất một đối tượng nữa",
    "Cancel": "Hủy",
    "Confirm": "Xác nhận",
    "Submit": "Gửi đi",
    "Delete": "Xóa",
    "Create": "Tạo",
    "Confirm Delete": "Xác nhận xóa",
    "Key": "Khóa",
    "Value": "Giá trị",
    "Create New Property": "Tạo thuộc tính mới",
    "Remove Duplicates": "Xóa trùng lặp",
    "Remove Duplicate Roads": "Xóa đường trùng lặp",
    "Click on a road to keep. The other roads here will be deleted.": "Chọn một đường để giữ lại. Các đường khác sẽ bị xóa.",
    "Delete Road": "Xóa đường",
    "Edit Road": "Sửa đường",
    "Add Road": "Thêm đường",
    "Create New Road": "Tạo đường mới",
    "New Road Id": "Mã đường mới",
    "Invalid Road Id": "Mã đường không phù hợp",
    "Create Intersection": "Tạo nút giao",
    "Finish task": "Hoàn thành",
    "Skip task": "Bỏ qua",
    "Show": "Hiện",
    "Hide": "Ẩn",
    "Upload": "Tải lên",
    "Upload RoadLabPro ZIP files": "Tải lên tập tin RoadLabPro ZIP",
    "Road properties": "Thuộc tính đường",
    "Road geometries": "Tọa độ đường",
    "FAQ": "FAQ",
    "Frequently Asked Questions": "Các câu hỏi thường gặp",
    "If you have any remaining questions": "Nếu bạn còn câu hỏi nào",
    "email us": "gửi thư cho chúng tôi",
    "Question regarding ORMA, not answered in the FAQ": "Câu hỏi về ORMA, chưa được trả lời trong FAQ",
    "Select roads to work on": "Lựa chọn đường để làm việc",
    "Choose an action to perform": "Chọn thao tác",
    "Showing 1 Road": "Đang hiện 1 đường",
    "Showing 2 Roads": "Đang hiện 2 đường",
    "Showing": "Đang hiện",
    "Admin": "Hành chính",
    "Admin Level": "Cấp hành chính",
    "Search by Admin Area": "Tìm kiếm theo Địa giới hành chính",
    "Search by VPRoMMS ID": "Tìm kiếm theo VProMMS ID",
    "Please search for an Admin Area": "Tìm kiếm theo Địa giới hành chính",
    "No results available. Please refine your search": "Không có kết quả. Vui lòng tìm lại.",
    "No available data": "Không có dữ liệu",
    "Highway": "Đường cao tốc",
    "Properties": "Thuộc tính",
    "Field Data": "Dữ liệu hiện trường",
    "View": "Xem",
    "Field Data Sources": "Nguồn của dữ liệu hiện trường",
    "Loading your first task": "Đang tải nhiệm vụ đầu tiên",
    "Tasks Remaining": "Nhiệm vụ còn lại",
    "No tasks remaining": "Không còn nhiệm vụ nào",
    "Error": "Lỗi",
    "Connection Error": "Lỗi kết nối",
    "Already Exists": "Đã tồn tại",
    "Bad response": "Phản hồi kém",
    "Data not available": "Không có dữ liệu",
    "Could not update task status": "Không thể cập nhật trạng thái",
    "Are you sure you want to delete VPRoMMS": "Bạn có chắc muốn xóa mã VPRoMMS?",
    "Improve Map": "Cải thiện bản đồ",
    "VPRoMMS ID": "Mã VProMMS",
    "Road Name": "Tên đường",
    "Road Type": "Loại đường",
    "Risk Score": "Chỉ số rủi ro",
    "Road Number": "Số hiệu đường",
    "End Latitude": "Vĩ độ điểm cuối",
    "Surface Type": "Loại mặt đường",
    "Poverty Score": "Chỉ số đói nghèo",
    "Terrain Class": "Loại địa hình",
    "Traffic Level": "Loại địa hình",
    "End Longitude": "Kinh độ điểm cuối",
    "End Point Name": "Tên điểm cuối",
    "Moisture Class": "Phân loại độ ẩm",
    "Start Latitude": "Vĩ độ điểm đầu",
    "Road Class Code": "Mã cấp đường",
    "Roughness (IRI)": "Độ gồ ghề (IRI)",
    "IRI": "IRI",
    "No data": "Không có dữ liệu",
    "Roughness Score": "Chỉ số độ gồ ghề",
    "Start Longitude": "Kinh độ điểm đầu",
    "Start Point Name": "Tên điểm đầu",
    "Criticality Score": "Chỉ số tầm quan trọng",
    "Structural Number": "Số kết cấu",
    "Temperature Class": "Phân loại mức nhiệt",
    "or_responsibility": "Cấp quản lý",
    "Road Length (ORMA)": "Chiều dài đường (ORMA)",
    "Road Length (VProMMS)": "Chiều dài đường (VProMMS)",
    "Accessibility Score": "Chỉ số tiếp cận",
    "Large Bus (veh/day)": "Xe buýt cỡ lớn (xe/ngày)",
    "Pavement Age (year)": "Tuổi thọ mặt đường (năm)",
    "Small Bus (veh/day)": "Xe buýt cỡ nhỏ (xe/ngày)",
    "Small Car (veh/day)": "Ô tô cỡ nhỏ (xe/ngày)",
    "Embankment Width (m)": "Chiều rộng nền (m)",
    "Medium Bus (veh/day)": "Xe buýt cỡ trung (xe/ngày)",
    "Medium Car (veh/day)": "Ô tô cỡ trung (xe/ngày)",
    "Motorcycle (veh/day)": "Xe máy (xe/ngày)",
    "Carriageway Width (m)": "Chiều rộng mặt (m)",
    "Heavy Truck (veh/day)": "Xe tải hạng nặng (xe/ngày)",
    "Light Truck (veh/day)": "Xe tải hạng nhẹ (xe/ngày)",
    "Management Class Code": "Mã cấp quản lý",
    "Number of Lanes Class": "Số làn đường",
    "Road Length (VPRoMMS)": "Chiều dài đường (VProMMS)",
    "Medium Truck (veh/day)": "Xe tải cỡ trung (xe/ngày)",
    "4 Wheel Drive (veh/day)": "Xe hai cầu (xe/ngày)",
    "Total Traffic (veh/day)": "Tổng lưu lượng (xe/ngày)",
    "Drainage Condition Class": "Tình trạng thoát nước",
    "Pavement Condition Class": "Tình trạng mặt đường",
    "Delivery Vehicle (veh/day)": "Xe giao hàng (xe/ngày)",
    "Articulated Truck (veh/day)": "Xe rơ-móoc (xe/ngày)",
    "Traffic Annual Growth Scenario": "Kịch bản gia tăng lưu lượng hàng năm",
    "Length (ORMA)": "Chiều dài (ORMA)",
    "Length (Tabular)": "Chiều dài (Bảng)"
}

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-creators.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.fetchAdmins = fetchAdmins;
exports.clearAdmins = clearAdmins;
exports.fetchAdminInfo = fetchAdminInfo;
exports.removeAdminInfo = removeAdminInfo;
exports.cleanSearchResults = cleanSearchResults;
exports.fetchSearchResults = fetchSearchResults;
exports.selectExploreMapLayer = selectExploreMapLayer;
exports.exploreMapShowNoVpromms = exploreMapShowNoVpromms;
exports.fetchFieldVProMMsIds = fetchFieldVProMMsIds;
exports.setSearchType = setSearchType;
exports.setFilteredVProMMs = setFilteredVProMMs;
exports.fetchAdminBbox = fetchAdminBbox;
exports.fetchProvinces = fetchProvinces;

var _isomorphicFetch = require('isomorphic-fetch');

var _isomorphicFetch2 = _interopRequireDefault(_isomorphicFetch);

var _actionTypes = require('./action-types');

var actions = _interopRequireWildcard(_actionTypes);

var _config = require('../config');

var _config2 = _interopRequireDefault(_config);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// ////////////////////////////////////////////////////////////////
//                       ADMIN SUBREGIONS                        //
// ////////////////////////////////////////////////////////////////

function requestAdmins() {
  return {
    type: actions.REQUEST_ADMINS
  };
}

function receiveAdmins(json) {
  return {
    type: actions.RECEIVE_ADMINS,
    json: json,
    receivedAt: Date.now()
  };
}

function fetchAdmins() {
  var id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

  return function (dispatch) {
    dispatch(requestAdmins());

    // The function called by the thunk middleware can return a value,
    // that is passed on as the return value of the dispatch method.

    // In this case, we return a promise to wait for.
    // This is not required by thunk middleware, but it is convenient for us.
    var url = _config2.default.api + '/admin/units?name=' + id + '&limit=10';
    console.time('fetch subregions');
    return (0, _isomorphicFetch2.default)(url).then(function (response) {
      return response.json();
    }).then(function (json) {
      console.timeEnd('fetch subregions');
      dispatch(receiveAdmins(json));
    });
    // catch any error in the network call.
  };
}

function clearAdmins() {
  return {
    type: actions.CLEAR_ADMINS
  };
}

function requestAdminInfo() {
  return {
    type: actions.REQUEST_ADMIN_INFO
  };
}

function receiveAdminInfo(json) {
  return {
    type: actions.RECEIVE_ADMIN_INFO,
    json: json
  };
}

function fetchAdminInfo(id) {
  return function (dispatch) {
    dispatch(requestAdminInfo());
    var url = _config2.default.api + '/admin/' + id + '/info';
    return (0, _isomorphicFetch2.default)(url).then(function (response) {
      return response.json();
    }).then(function (json) {
      if (json.statusCode >= 400) {
        throw new Error('Bad Request');
      }
      dispatch(receiveAdminInfo(json));
    });
  };
}

function removeAdminInfo() {
  return {
    type: actions.REMOVE_ADMIN_INFO
  };
}

// ////////////////////////////////////////////////////////////////
//                        SEARCH RESULTS                         //
// ////////////////////////////////////////////////////////////////

function requestSearchResults(query) {
  return {
    type: actions.REQUEST_SEARCH_RESULTS,
    query: query
  };
}

function receiveSearchResults(json) {
  return {
    type: actions.RECEIVE_SEARCH_RESULTS,
    json: json,
    receivedAt: Date.now()
  };
}

function cleanSearchResults() {
  return {
    type: actions.CLEAN_SEARCH_RESULTS
  };
}

function fetchSearchResults(searchQuery) {
  return function (dispatch) {
    dispatch(requestSearchResults(searchQuery));

    console.time('fetch search results');
    return (0, _isomorphicFetch2.default)(_config2.default.api + '/admin/search/' + searchQuery).then(function (response) {
      return response.json();
    }).then(function (json) {
      console.timeEnd('fetch search results');
      // setTimeout(() => dispatch(receiveSearchResults(json)), 2000);
      dispatch(receiveSearchResults(json));
    });
    // catch any error in the network call.
  };
}

// ////////////////////////////////////////////////////////////////
//                         Explore Map                           //
// ////////////////////////////////////////////////////////////////

function selectExploreMapLayer(layer) {
  return {
    type: actions.SELECT_EXPLORE_MAP_LAYER,
    layer: layer
  };
}

function exploreMapShowNoVpromms(bool) {
  return {
    type: actions.EXPLORE_MAP_SHOW_NO_VPROMMS,
    bool: bool
  };
}

// ///////////////////////////////////////////////////////////////
//                             Roads                            //
// ///////////////////////////////////////////////////////////////
function requestFieldVProMMsids() {
  return {
    type: actions.REQUEST_VPROMMS_FIELD_IDS
  };
}

function receiveFieldVProMMsids(json) {
  return {
    type: actions.RECEIVE_VPROMMS_FIELD_IDS,
    json: json
  };
}

function fetchFieldVProMMsIds(json) {
  return function (dispatch) {
    dispatch(requestFieldVProMMsids());
    var url = _config2.default.api + '/field/ids';
    return (0, _isomorphicFetch2.default)(url).then(function (response) {
      return response.json();
    }).then(function (json) {
      if (json.statusCode >= 400) {
        throw new Error('Bad Response');
      }
      dispatch(receiveFieldVProMMsids(json));
    });
  };
}

// ////////////////////////////////////////////////////////////////
//                             Search                            //
// ////////////////////////////////////////////////////////////////
function setSearchType(text) {
  return {
    type: actions.SET_SEARCH_TYPE,
    text: text
  };
}

function setFilteredVProMMs(array) {
  return {
    type: actions.SET_FILTERED_VPROMMS,
    array: array
  };
}

// ////////////////////////////////////////////////////////////////
//                            Admins                             //
// ////////////////////////////////////////////////////////////////

function requestAdminBbox() {
  return {
    type: actions.REQUEST_ADMIN_BBOX
  };
}

function receiveAdminBbox(json) {
  return {
    type: actions.RECEIVE_ADMIN_BBOX,
    json: json
  };
}

function fetchAdminBbox(id) {
  return function (dispatch) {
    dispatch(requestAdminBbox());
    var url = _config2.default.api + '/admin/' + id + '/info';
    return (0, _isomorphicFetch2.default)(url).then(function (response) {
      return response.json();
    }).then(function (json) {
      // if not found, throw an error.
      if (json.statusCode >= 400) {
        throw new Error('Bad response');
      }
      dispatch(receiveAdminBbox(json));
    });
  };
}

function requestProvinces() {
  return {
    type: actions.REQUEST_PROVINCES
  };
}

function receiveProvinces(json) {
  return {
    type: actions.RECEIVE_PROVINCES,
    json: json
  };
}

function fetchProvinces() {
  return function (dispatch) {
    dispatch(requestProvinces());
    var url = _config2.default.api + '/admin/province/units';
    return (0, _isomorphicFetch2.default)(url).then(function (response) {
      return response.json();
    }).then(function (json) {
      if (json.statusCode >= 400) {
        throw new Error('Bad response');
      }
      dispatch(receiveProvinces(json));
    });
  };
}

},{"../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","./action-types":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-types.js","isomorphic-fetch":"isomorphic-fetch"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-types.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var REQUEST_ADMIN_INFO = exports.REQUEST_ADMIN_INFO = 'REQUEST_ADMIN_INFO';
var RECEIVE_ADMIN_INFO = exports.RECEIVE_ADMIN_INFO = 'RECEIVE_ADMIN_INFO';
var REMOVE_ADMIN_INFO = exports.REMOVE_ADMIN_INFO = 'REMOVE_ADMIN_INFO';

var REQUEST_ADMINS = exports.REQUEST_ADMINS = 'REQUEST_ADMINS';
var RECEIVE_ADMINS = exports.RECEIVE_ADMINS = 'RECEIVE_ADMINS';
var CLEAR_ADMINS = exports.CLEAR_ADMINS = 'CLEAR_ADMINS';

var REQUEST_SEARCH_RESULTS = exports.REQUEST_SEARCH_RESULTS = 'REQUEST_ADMIN_SEARCH_RESULTS';
var RECEIVE_SEARCH_RESULTS = exports.RECEIVE_SEARCH_RESULTS = 'RECEIVE_ADMIN_SEARCH_RESULTS';
var CLEAN_SEARCH_RESULTS = exports.CLEAN_SEARCH_RESULTS = 'CLEAN_SEARCH_RESULTS';

var SET_FILTERED_VPROMMS = exports.SET_FILTERED_VPROMMS = 'SET_FILTERED_VPROMMS';

var REQUEST_VPROMMS_BBOX = exports.REQUEST_VPROMMS_BBOX = 'REQUEST_VPROMMS_BBOX';
var RECIEVE_VPROMMS_BBOX = exports.RECIEVE_VPROMMS_BBOX = 'RECIEVE_VPROMMS_BBOX';

var REQUEST_VPROMMS_FIELD_IDS = exports.REQUEST_VPROMMS_FIELD_IDS = 'REQUEST_VPROMMS_FIELD_IDS';
var RECEIVE_VPROMMS_FIELD_IDS = exports.RECEIVE_VPROMMS_FIELD_IDS = 'RECEIVE_VPROMMS_FIELD_IDS';

var SELECT_EXPLORE_MAP_LAYER = exports.SELECT_EXPLORE_MAP_LAYER = 'SELECT_EXPLORE_MAP_LAYER';
var EXPLORE_MAP_SHOW_NO_VPROMMS = exports.EXPLORE_MAP_SHOW_NO_VPROMMS = 'EXPLORE_MAP_SHOW_NO_VPROMMS';

var REQUEST_ADMIN_BBOX = exports.REQUEST_ADMIN_BBOX = 'REQUEST_ADMIN_BBOX';
var RECEIVE_ADMIN_BBOX = exports.RECEIVE_ADMIN_BBOX = 'RECEIVE_ADMIN_BBOX';

var SET_SEARCH_TYPE = exports.SET_SEARCH_TYPE = 'SET_SEARCH_TYPE';

var REQUEST_PROVINCES = exports.REQUEST_PROVINCES = 'REQUEST_PROVINCES';
var RECEIVE_PROVINCES = exports.RECEIVE_PROVINCES = 'RECEIVE_PROVINCES';

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/assets-create.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _reactRedux = require('react-redux');

var _recompose = require('recompose');

var _reduxFractal = require('redux-fractal');

var _redux = require('redux');

var _reactRouter = require('react-router');

var _roads = require('../redux/modules/roads');

var _config = require('../config');

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

var _modal = require('./modal');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var AssetsCreateModal = function (_React$Component) {
  _inherits(AssetsCreateModal, _React$Component);

  function AssetsCreateModal(props) {
    _classCallCheck(this, AssetsCreateModal);

    var _this = _possibleConstructorReturn(this, (AssetsCreateModal.__proto__ || Object.getPrototypeOf(AssetsCreateModal)).call(this, props));

    _this.onSave = _this.onSave.bind(_this);
    _this.onCloseClick = _this.onCloseClick.bind(_this);

    _this.state = _this.prepareState(props);
    return _this;
  }

  _createClass(AssetsCreateModal, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (!this.props.revealed && nextProps.revealed) {
        this.setState(this.prepareState(nextProps));
      }
    }
  }, {
    key: 'prepareState',
    value: function prepareState(props) {
      return {
        vpromm: ''
      };
    }
  }, {
    key: 'onValueChange',
    value: function onValueChange(what, event) {
      this.setState(_defineProperty({}, what, event.target.value));
    }
  }, {
    key: 'onCloseClick',
    value: function onCloseClick(e) {
      // Block while processing.
      if (this.props.roadPropsOp.processing) return;
      this.props.onCloseClick();
    }
  }, {
    key: 'onSave',
    value: function () {
      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(e) {
        var vpromm, res;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                e.preventDefault();
                vpromm = this.state.vpromm;

                // Validate Vprom

                _context.prev = 2;
                _context.next = 5;
                return this.props.createRoad(vpromm);

              case 5:
                res = _context.sent;

                if (!res.error) {
                  _context.next = 8;
                  break;
                }

                throw new Error(res.error);

              case 8:
                this.props.onCloseClick({ action: 'redirect', vpromm: vpromm });
                _context.next = 14;
                break;

              case 11:
                _context.prev = 11;
                _context.t0 = _context['catch'](2);

                alert((0, _t.translate)(this.props.language, 'The Vpromm Id id not valid. Please try again.'));

              case 14:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 11]]);
      }));

      function onSave(_x) {
        return _ref.apply(this, arguments);
      }

      return onSave;
    }()
  }, {
    key: 'render',
    value: function render() {
      var processing = this.props.roadPropsOp.processing;


      return _react2.default.createElement(
        _modal.Modal,
        {
          id: 'assets-edit-modal',
          className: 'modal--medium',
          onCloseClick: this.onCloseClick,
          revealed: this.props.revealed },
        _react2.default.createElement(
          _modal.ModalHeader,
          null,
          _react2.default.createElement(
            'div',
            { className: 'modal__headline' },
            _react2.default.createElement(
              'h1',
              { className: 'modal__title' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Add new asset'
              )
            )
          )
        ),
        _react2.default.createElement(
          _modal.ModalBody,
          null,
          _react2.default.createElement(
            'form',
            { className: (0, _classnames2.default)('form', { disabled: processing }), disabled: processing, onSubmit: this.onSave },
            _react2.default.createElement(
              'div',
              { className: 'inner' },
              _react2.default.createElement(
                'fieldset',
                { className: 'form__fieldset' },
                _react2.default.createElement(
                  'legend',
                  { className: 'form__legend' },
                  _react2.default.createElement(
                    _t2.default,
                    null,
                    'Meta'
                  )
                ),
                _react2.default.createElement(
                  'div',
                  { className: 'form__group' },
                  _react2.default.createElement(
                    'label',
                    { className: 'form__label', htmlFor: 'vpromm' },
                    'VPRoMM ID'
                  ),
                  _react2.default.createElement('input', { type: 'text', id: 'vpromm', name: 'vpromm', className: 'form__control', value: this.state.vpromm, onChange: this.onValueChange.bind(this, 'vpromm') })
                )
              )
            )
          )
        ),
        _react2.default.createElement(
          _modal.ModalFooter,
          null,
          _react2.default.createElement(
            'button',
            { className: (0, _classnames2.default)('mfa-xmark', { disabled: processing }), disabled: processing, type: 'button', onClick: this.onCloseClick },
            _react2.default.createElement(
              'span',
              null,
              'Cancel'
            )
          ),
          _react2.default.createElement(
            'button',
            { className: (0, _classnames2.default)('mfa-main mfa-tick', { disabled: processing }), disabled: processing, type: 'submit', onClick: this.onSave },
            _react2.default.createElement(
              'span',
              null,
              'Save'
            )
          )
        )
      );
    }
  }]);

  return AssetsCreateModal;
}(_react2.default.Component);

if (_config.environment !== 'production') {
  AssetsCreateModal.propTypes = {
    revealed: _react.PropTypes.bool,
    roadPropsOp: _react.PropTypes.object,
    onCloseClick: _react.PropTypes.func,
    createRoad: _react.PropTypes.func,
    language: _react.PropTypes.string
  };
}

var AssetsCreate = function (_React$Component2) {
  _inherits(AssetsCreate, _React$Component2);

  function AssetsCreate(props) {
    _classCallCheck(this, AssetsCreate);

    var _this2 = _possibleConstructorReturn(this, (AssetsCreate.__proto__ || Object.getPrototypeOf(AssetsCreate)).call(this, props));

    _this2.onCreateAssetClick = _this2.onCreateAssetClick.bind(_this2);
    _this2.onModalClose = _this2.onModalClose.bind(_this2);

    _this2.state = {
      createModalOpen: false
    };
    return _this2;
  }

  _createClass(AssetsCreate, [{
    key: 'onModalClose',
    value: function onModalClose() {
      var _this3 = this;

      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

      this.setState({ createModalOpen: false });
      if (data.action === 'redirect') {
        // Why the setTimeout you ask?
        // For some reason redux-fractal doesn't play well with thunks.
        // It thinks that the action is being dispatched from a reducer and
        // throws an error. "Reducers may not dispatch actions."
        // This is meant to refresh the data after properties are saved.
        setTimeout(function () {
          _this3.props.router.push({ pathname: '/' + _this3.props.language + '/assets/road/' + data.vpromm + '/' });
        }, 0);
      }
    }
  }, {
    key: 'onCreateAssetClick',
    value: function onCreateAssetClick(e) {
      e.preventDefault();
      this.setState({ createModalOpen: true });
    }
  }, {
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'div',
        null,
        _react2.default.createElement(
          'a',
          { href: '#', className: 'ica-plus ica-main', onClick: this.onCreateAssetClick },
          _react2.default.createElement(
            _t2.default,
            null,
            'Add asset'
          )
        ),
        _react2.default.createElement(AssetsCreateModal, {
          revealed: this.state.createModalOpen,
          language: this.props.language,
          onCloseClick: this.onModalClose,
          createRoad: this.props.createRoad,
          roadPropsOp: this.props.roadPropsOp })
      );
    }
  }]);

  return AssetsCreate;
}(_react2.default.Component);

if (_config.environment !== 'production') {
  AssetsCreate.propTypes = {
    router: _react.PropTypes.object,
    createRoad: _react2.default.PropTypes.func,
    language: _react2.default.PropTypes.string,
    roadPropsOp: _react2.default.PropTypes.object
  };
}

//
//
//

// Road operations state and reducer.
// Handles operations done to the properties.
var stateOpOnRoad = {
  processing: false,
  data: {}
};

var reducerOpOnRoad = function reducerOpOnRoad() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : stateOpOnRoad;
  var action = arguments[1];

  switch (action.type) {
    case _roads.CREATE_ROAD:
      return _extends({}, state, { processing: true, error: false });
    case _roads.CREATE_ROAD_SUCCESS:
      return _extends({}, state, { processing: false, error: false, data: action.data });
    case _roads.CREATE_ROAD_ERROR:
      return _extends({}, state, { processing: false, error: true });
  }

  return state;
};

exports.default = (0, _recompose.compose)(_reactRouter.withRouter, (0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), (0, _reduxFractal.local)({
  key: function key(_ref2) {
    var vpromm = _ref2.vpromm;
    return 'create-road';
  },
  createStore: function createStore() {
    return (0, _redux.createStore)(reducerOpOnRoad);
  },
  mapStateToProps: function mapStateToProps(state) {
    return {
      roadPropsOp: state
    };
  },
  filterGlobalActions: function filterGlobalActions(_ref3) {
    var type = _ref3.type;
    return [_roads.CREATE_ROAD, _roads.CREATE_ROAD_SUCCESS, _roads.CREATE_ROAD_ERROR].indexOf(type) > -1;
  }
}), (0, _reactRedux.connect)(function (state, props) {
  return {};
}, function (dispatch) {
  return {
    createRoad: function createRoad() {
      return dispatch(_roads.createRoadEpic.apply(undefined, arguments));
    }
  };
}))(AssetsCreate);

},{"../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","../redux/modules/roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js","./modal":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/modal.js","classnames":"classnames","react":"react","react-redux":"react-redux","react-router":"react-router","recompose":"recompose","redux":"redux","redux-fractal":"redux-fractal"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/assets-edit-modal.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _lodash = require('lodash');

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

var _modal = require('./modal');

var _config = require('../config');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var idCounter = 0;
var uniqueId = function uniqueId(key) {
  return key + '-' + ++idCounter;
};

var AssetsEditModal = function (_React$Component) {
  _inherits(AssetsEditModal, _React$Component);

  function AssetsEditModal(props) {
    _classCallCheck(this, AssetsEditModal);

    var _this = _possibleConstructorReturn(this, (AssetsEditModal.__proto__ || Object.getPrototypeOf(AssetsEditModal)).call(this, props));

    _this.addProperty = _this.addProperty.bind(_this);
    _this.renderExistingProperties = _this.renderExistingProperties.bind(_this);
    _this.renderNewProperties = _this.renderNewProperties.bind(_this);
    _this.onSave = _this.onSave.bind(_this);
    _this.onCloseClick = _this.onCloseClick.bind(_this);

    _this.state = _this.prepareState(props);
    return _this;
  }

  _createClass(AssetsEditModal, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (!this.props.revealed && nextProps.revealed) {
        this.setState(this.prepareState(nextProps));
      }
    }
  }, {
    key: 'prepareState',
    value: function prepareState(props) {
      var roadProperties = props.roadProps.data.properties;
      var propertyNames = Object.keys(roadProperties);
      propertyNames.sort(function (a, b) {
        return a.toLowerCase() > b.toLowerCase() ? 1 : -1;
      });

      return {
        vpromm: props.vpromm,
        properties: propertyNames.map(function (p) {
          return {
            id: uniqueId('property'),
            key: p,
            value: roadProperties[p],
            valueOriginal: roadProperties[p],
            existing: true
          };
        }),
        propertiesToRemove: []
      };
    }
  }, {
    key: 'getBaseProperty',
    value: function getBaseProperty() {
      return {
        id: uniqueId('property'),
        key: '',
        value: '',
        existing: false
      };
    }
  }, {
    key: 'addProperty',
    value: function addProperty() {
      var properties = this.state.properties.concat(this.getBaseProperty());
      this.setState({ properties: properties });
    }
  }, {
    key: 'removeProperty',
    value: function removeProperty(id) {
      var field = this.state.properties.find(function (o) {
        return o.id === id;
      });
      var properties = this.state.properties.filter(function (o) {
        return o.id !== id;
      });
      var propertiesToRemove = this.state.propertiesToRemove;
      // Only properties that already should be removed from the DB.
      if (field.existing) {
        propertiesToRemove = propertiesToRemove.concat(field);
      }
      this.setState({ properties: properties, propertiesToRemove: propertiesToRemove });
    }
  }, {
    key: 'onValueChange',
    value: function onValueChange(what, event) {
      this.setState(_defineProperty({}, what, event.target.value));
    }
  }, {
    key: 'onPropertyChange',
    value: function onPropertyChange(id, what, event) {
      var properties = (0, _lodash.clone)(this.state.properties);
      var idx = (0, _lodash.findIndex)(properties, ['id', id]);

      var val = event.target.value;
      properties[idx][what] = val;

      this.setState({ properties: properties });
    }
  }, {
    key: 'onCloseClick',
    value: function onCloseClick(e) {
      // Block while processing.
      if (this.props.roadPropsOp.processing) return;
      this.props.onCloseClick();
    }
  }, {
    key: 'onSave',
    value: function () {
      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(e) {
        var propertiesToAdd, propertiesToUpdate, propertiesToRemove, originalVpromm, newVpromm, diffVpromm, successRes, res, _res;

        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                e.preventDefault();
                propertiesToAdd = this.state.properties.filter(function (property) {
                  return !property.existing && property.key !== '';
                });
                propertiesToUpdate = this.state.properties.filter(function (property) {
                  return property.existing && property.value !== property.valueOriginal;
                });
                propertiesToRemove = this.state.propertiesToRemove;
                originalVpromm = this.props.vpromm;
                newVpromm = this.state.vpromm;
                diffVpromm = newVpromm !== originalVpromm;
                _context.prev = 7;
                successRes = {};

                if (!(propertiesToAdd.length || propertiesToUpdate.length || propertiesToRemove.length)) {
                  _context.next = 16;
                  break;
                }

                _context.next = 12;
                return this.props.opOnRoadProperty(this.props.vpromm, {
                  add: propertiesToAdd,
                  replace: propertiesToUpdate,
                  remove: propertiesToRemove
                });

              case 12:
                res = _context.sent;

                if (!res.error) {
                  _context.next = 15;
                  break;
                }

                throw new Error(res.error);

              case 15:
                successRes = { action: 'refresh' };

              case 16:
                if (!diffVpromm) {
                  _context.next = 23;
                  break;
                }

                _context.next = 19;
                return this.props.editRoad(originalVpromm, newVpromm);

              case 19:
                _res = _context.sent;

                if (!_res.error) {
                  _context.next = 22;
                  break;
                }

                throw new Error(_res.error);

              case 22:
                successRes = { action: 'redirect', vpromm: newVpromm };

              case 23:

                this.props.onCloseClick(successRes);
                _context.next = 29;
                break;

              case 26:
                _context.prev = 26;
                _context.t0 = _context['catch'](7);

                alert('An error occurred while saving. Please try again.');

              case 29:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this, [[7, 26]]);
      }));

      function onSave(_x) {
        return _ref.apply(this, arguments);
      }

      return onSave;
    }()
  }, {
    key: 'renderExistingProperties',
    value: function renderExistingProperties(_ref2) {
      var id = _ref2.id,
          key = _ref2.key,
          value = _ref2.value;

      return _react2.default.createElement(
        'div',
        { className: 'form__group', key: id },
        _react2.default.createElement(
          'div',
          { className: 'form__inner-header' },
          _react2.default.createElement(
            'div',
            { className: 'form__inner-headline' },
            _react2.default.createElement(
              'label',
              { className: 'form__label', htmlFor: id },
              key
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'form__inner-actions' },
            _react2.default.createElement(
              'button',
              { type: 'button', className: 'fia-trash', title: 'Delete property', onClick: this.removeProperty.bind(this, id) },
              _react2.default.createElement(
                'span',
                null,
                'Delete'
              )
            )
          )
        ),
        _react2.default.createElement('input', { type: 'text', id: id, name: id, className: 'form__control', value: value, onChange: this.onPropertyChange.bind(this, id, 'value') })
      );
    }
  }, {
    key: 'renderNewProperties',
    value: function renderNewProperties(_ref3) {
      var id = _ref3.id,
          key = _ref3.key,
          value = _ref3.value;

      return _react2.default.createElement(
        'fieldset',
        { className: 'form__fieldset', key: id },
        _react2.default.createElement(
          'div',
          { className: 'form__inner-header' },
          _react2.default.createElement(
            'div',
            { className: 'form__inner-headline' },
            _react2.default.createElement(
              'legend',
              { className: 'form__legend' },
              _react2.default.createElement(
                _t2.default,
                null,
                'New attribute'
              )
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'form__inner-actions' },
            _react2.default.createElement(
              'button',
              { type: 'button', className: (0, _classnames2.default)('fia-trash'), title: 'Delete property', onClick: this.removeProperty.bind(this, id) },
              _react2.default.createElement(
                'span',
                null,
                'Delete'
              )
            )
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'form__hascol form__hascol--2' },
          _react2.default.createElement(
            'div',
            { className: 'form__group' },
            _react2.default.createElement(
              'label',
              { className: 'form__label', htmlFor: 'key-' + id },
              'Name'
            ),
            _react2.default.createElement('input', { type: 'text', id: 'key-' + id, name: 'key-' + id, className: 'form__control', value: key, onChange: this.onPropertyChange.bind(this, id, 'key') })
          ),
          _react2.default.createElement(
            'div',
            { className: 'form__group' },
            _react2.default.createElement(
              'label',
              { className: 'form__label', htmlFor: 'value-' + id },
              'Value'
            ),
            _react2.default.createElement('input', { type: 'text', id: 'value-' + id, name: 'value-' + id, className: 'form__control', value: value, onChange: this.onPropertyChange.bind(this, id, 'value') })
          )
        )
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var processing = this.props.roadPropsOp.processing;


      return _react2.default.createElement(
        _modal.Modal,
        {
          id: 'assets-edit-modal',
          className: 'modal--medium',
          onCloseClick: this.onCloseClick,
          revealed: this.props.revealed },
        _react2.default.createElement(
          _modal.ModalHeader,
          null,
          _react2.default.createElement(
            'div',
            { className: 'modal__headline' },
            _react2.default.createElement(
              'h1',
              { className: 'modal__title' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Edit attributes of'
              ),
              ' ',
              this.props.vpromm
            )
          )
        ),
        _react2.default.createElement(
          _modal.ModalBody,
          null,
          _react2.default.createElement(
            'form',
            { className: (0, _classnames2.default)('form', { disabled: processing }), disabled: processing, onSubmit: this.onSave },
            _react2.default.createElement(
              'div',
              { className: 'inner' },
              _react2.default.createElement(
                'fieldset',
                { className: 'form__fieldset' },
                _react2.default.createElement(
                  'legend',
                  { className: 'form__legend' },
                  _react2.default.createElement(
                    _t2.default,
                    null,
                    'Meta'
                  )
                ),
                _react2.default.createElement(
                  'div',
                  { className: 'form__group' },
                  _react2.default.createElement(
                    'label',
                    { className: 'form__label', htmlFor: 'vpromm' },
                    'VPRoMM ID'
                  ),
                  _react2.default.createElement('input', { type: 'text', id: 'vpromm', name: 'vpromm', className: 'form__control', value: this.state.vpromm, onChange: this.onValueChange.bind(this, 'vpromm') })
                )
              ),
              _react2.default.createElement(
                'fieldset',
                { className: 'form__fieldset' },
                _react2.default.createElement(
                  'legend',
                  { className: 'form__legend' },
                  _react2.default.createElement(
                    _t2.default,
                    null,
                    'Attributes'
                  )
                ),
                this.state.properties.filter(function (o) {
                  return o.existing;
                }).map(this.renderExistingProperties)
              ),
              this.state.properties.filter(function (o) {
                return !o.existing;
              }).map(this.renderNewProperties),
              _react2.default.createElement(
                'div',
                { className: 'form__extra-actions' },
                _react2.default.createElement(
                  'button',
                  { type: 'button', className: 'fea-plus', title: 'Add new file', onClick: this.addProperty },
                  _react2.default.createElement(
                    'span',
                    null,
                    'New attribute'
                  )
                )
              )
            )
          )
        ),
        _react2.default.createElement(
          _modal.ModalFooter,
          null,
          _react2.default.createElement(
            'button',
            { className: (0, _classnames2.default)('mfa-xmark', { disabled: processing }), disabled: processing, type: 'button', onClick: this.onCloseClick },
            _react2.default.createElement(
              'span',
              null,
              'Cancel'
            )
          ),
          _react2.default.createElement(
            'button',
            { className: (0, _classnames2.default)('mfa-main mfa-tick', { disabled: processing }), disabled: processing, type: 'submit', onClick: this.onSave },
            _react2.default.createElement(
              'span',
              null,
              'Save'
            )
          )
        )
      );
    }
  }]);

  return AssetsEditModal;
}(_react2.default.Component);

if (_config.environment !== 'production') {
  AssetsEditModal.propTypes = {
    vpromm: _react.PropTypes.string,
    revealed: _react.PropTypes.bool,
    roadProps: _react.PropTypes.object,
    roadPropsOp: _react.PropTypes.object,
    onCloseClick: _react.PropTypes.func,
    opOnRoadProperty: _react.PropTypes.func,
    editRoad: _react.PropTypes.func
  };
}

exports.default = AssetsEditModal;

},{"../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","./modal":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/modal.js","classnames":"classnames","lodash":"lodash","react":"react"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/confirmation-prompt.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.showConfirm = showConfirm;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _modal = require('./modal');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var noop = function noop() {};
// Once the component is mounted we store it to be able to access it from
// the outside.
var theConfirmationModal = null;

var ConfirmationPrompt = _react2.default.createClass({
  displayName: 'ConfirmationPrompt',

  getInitialState: function getInitialState() {
    return {
      onConfirm: noop,
      onCancel: noop,
      revealed: false,
      title: 'Confirm',
      description: null,
      body: _react2.default.createElement(
        'p',
        null,
        'Are you sure'
      )
    };
  },

  keyListener: function keyListener(e) {
    // Enter.
    if (this.state.revealed && e.keyCode === 13) {
      e.preventDefault();
      this.onConfirm();
    }
  },

  onConfirm: function onConfirm() {
    this.setState({ revealed: false });
    this.state.onConfirm();
  },

  onCancel: function onCancel() {
    this.setState({ revealed: false });
    this.state.onCancel();
  },

  componentDidMount: function componentDidMount() {
    if (theConfirmationModal !== null) {
      throw new Error('<ConfirmationPrompt /> component was already mounted. Only 1 is allowed.');
    }
    theConfirmationModal = this;
    document.addEventListener('keyup', this.keyListener);
  },

  componentWillUnmount: function componentWillUnmount() {
    document.removeEventListener('keyup', this.keyListener);
  },

  render: function render() {
    return _react2.default.createElement(
      _modal.Modal,
      {
        id: 'confirmation-prompt',
        className: 'modal--small modal--prompt',
        onCloseClick: this.onCancel,
        revealed: this.state.revealed },
      _react2.default.createElement(
        _modal.ModalHeader,
        null,
        _react2.default.createElement(
          'div',
          { className: 'modal__headline' },
          _react2.default.createElement(
            'h1',
            { className: 'modal__title' },
            this.state.title
          ),
          _react2.default.createElement(
            'div',
            { className: 'modal__description' },
            this.state.description
          )
        )
      ),
      _react2.default.createElement(
        _modal.ModalBody,
        null,
        this.state.body
      ),
      _react2.default.createElement(
        _modal.ModalFooter,
        null,
        _react2.default.createElement(
          'button',
          { className: 'mfa-xmark', type: 'button', onClick: this.onCancel },
          _react2.default.createElement(
            'span',
            null,
            'Cancel'
          )
        ),
        _react2.default.createElement(
          'button',
          { className: 'mfa-main mfa-tick', type: 'submit', onClick: this.onConfirm },
          _react2.default.createElement(
            'span',
            null,
            'Confirm'
          )
        )
      )
    );
  }
});

exports.default = ConfirmationPrompt;
function showConfirm(opt) {
  var onConfirm = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;
  var onCancel = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : noop;

  if (theConfirmationModal === null) {
    throw new Error('<ConfirmationPrompt /> component not mounted');
  }

  theConfirmationModal.setState(Object.assign({}, opt, {
    revealed: true,
    onConfirm: onConfirm,
    onCancel: onCancel
  }));
}

},{"./modal":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/modal.js","react":"react"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/district-list.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRouter = require('react-router');

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

var _constants = require('../constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var DistrictList = function DistrictList(_ref) {
  var districts = _ref.districts,
      aaId = _ref.aaId,
      language = _ref.language;
  return _react2.default.createElement(
    'nav',
    { className: 'a-subnav' },
    _react2.default.createElement(
      'h2',
      null,
      _react2.default.createElement(
        _t2.default,
        null,
        'Districts'
      )
    ),
    _react2.default.createElement(
      'ul',
      { className: 'a-children' },
      districts.filter(function (_ref2) {
        var id = _ref2.id;
        return _constants.ADMIN_MAP.district[id] !== undefined;
      }).map(function (child, i) {
        return _react2.default.createElement(
          'li',
          {
            key: child.id
          },
          _react2.default.createElement(
            _reactRouter.Link,
            {
              className: _constants.ADMIN_MAP.district[child.id] === '' ? 'disabled' : '',
              to: '/' + language + '/assets/' + aaId + '/' + child.id
            },
            child.name_en
          )
        );
      })
    )
  );
};

exports.default = DistrictList;

},{"../constants":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/constants.js","./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react","react-router":"react-router"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/dropdown.js":[function(require,module,exports){
(function (process){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactTether = require('react-tether');

var _reactTether2 = _interopRequireDefault(_reactTether);

var _reactTransitionGroup = require('react-transition-group');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var activeDropdowns = [];

/*
<Dropdown
  className='browse-menu'
  triggerClassName='browse-button'
  triggerActiveClassName='button--active'
  triggerText='Menu'
  triggerTitle='Toggle menu options'
  direction='down'
  alignment='right' >

  <h6 className='drop__title'>Browse</h6>
  <ul className='drop__menu drop__menu--select'>
    <li><Link to='' className='drop__menu-item' activeClassName='drop__menu-item--active'>Label</Link></li>
  </ul>

</Dropdown>
*/

var Dropdown = function (_React$Component) {
  _inherits(Dropdown, _React$Component);

  function Dropdown(props) {
    _classCallCheck(this, Dropdown);

    var _this = _possibleConstructorReturn(this, (Dropdown.__proto__ || Object.getPrototypeOf(Dropdown)).call(this, props));

    _this.state = {
      open: false
    };

    _this._bodyListener = _this._bodyListener.bind(_this);
    _this._toggleDropdown = _this._toggleDropdown.bind(_this);
    return _this;
  }

  _createClass(Dropdown, [{
    key: '_bodyListener',
    value: function _bodyListener(e) {
      // Get the dropdown that is a parent of the clicked element. If any.
      var theSelf = e.target;
      if (theSelf.tagName === 'BODY' || theSelf.tagName === 'HTML' || e.target.getAttribute('data-hook') === 'dropdown:close') {
        this.close();
        return;
      }

      // If the trigger element is an "a" the target is the "span", but it is a
      // button, the target is the "button" itself.
      // This code handles this case. No idea why this is happening.
      // TODO: Unveil whatever black magic is at work here.
      if (theSelf.tagName === 'SPAN' && theSelf.parentNode === this.triggerRef && theSelf.parentNode.getAttribute('data-hook') === 'dropdown:btn') {
        return;
      }
      if (theSelf.tagName === 'SPAN' && theSelf.parentNode.getAttribute('data-hook') === 'dropdown:close') {
        this.close();
        return;
      }

      if (theSelf && theSelf.getAttribute('data-hook') === 'dropdown:btn') {
        if (theSelf !== this.triggerRef) {
          this.close();
        }
        return;
      }

      do {
        if (theSelf && theSelf.getAttribute('data-hook') === 'dropdown:content') {
          break;
        }
        theSelf = theSelf.parentNode;
      } while (theSelf && theSelf.tagName !== 'BODY' && theSelf.tagName !== 'HTML');

      if (theSelf !== this.dropdownRef) {
        this.close();
      }
    }
  }, {
    key: '_toggleDropdown',
    value: function _toggleDropdown(e) {
      e.preventDefault();
      this.toggle();
    }

    // Lifecycle method.
    // Called once as soon as the component has a DOM representation.

  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      activeDropdowns.push(this);
      window.addEventListener('click', this._bodyListener);
    }

    // Lifecycle method.

  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      activeDropdowns.splice(activeDropdowns.indexOf(this), 1);
      window.removeEventListener('click', this._bodyListener);
    }
  }, {
    key: 'toggle',
    value: function toggle() {
      this.setState({ open: !this.state.open });
    }
  }, {
    key: 'open',
    value: function open() {
      !this.state.open && this.setState({ open: true });
    }
  }, {
    key: 'close',
    value: function close() {
      this.state.open && this.setState({ open: false });
    }
  }, {
    key: 'renderTriggerElement',
    value: function renderTriggerElement() {
      var _this2 = this;

      var _props = this.props,
          id = _props.id,
          triggerTitle = _props.triggerTitle,
          triggerText = _props.triggerText,
          triggerClassName = _props.triggerClassName,
          triggerActiveClassName = _props.triggerActiveClassName,
          TriggerElement = _props.triggerElement;


      var triggerKlasses = ['drop__toggle'];
      var triggerProps = {
        onClick: this._toggleDropdown,
        'data-hook': 'dropdown:btn',
        ref: function ref(el) {
          _this2.triggerRef = el;
        }
      };

      if (triggerClassName) {
        triggerKlasses.push(triggerClassName);
      }

      if (this.state.open && triggerActiveClassName) {
        triggerKlasses.push(triggerActiveClassName);
      }

      triggerProps.className = triggerKlasses.join(' ');

      // Additional trigger props.
      if (TriggerElement === 'button') {
        triggerProps.type = 'button';
      } else {
        triggerProps.href = '#';
        if (id) {
          triggerProps.href += id;
        }
      }
      if (triggerTitle) {
        triggerProps.title = triggerTitle;
      }

      return _react2.default.createElement(
        TriggerElement,
        triggerProps,
        _react2.default.createElement(
          'span',
          null,
          triggerText
        )
      );
    }
  }, {
    key: 'renderContent',
    value: function renderContent() {
      var _this3 = this;

      var _props2 = this.props,
          id = _props2.id,
          direction = _props2.direction,
          className = _props2.className;

      // Base and additional classes for the trigger and the content.

      var klasses = ['drop__content', 'drop__content--react', 'drop-trans--' + direction];
      var dropdownContentProps = {
        ref: function ref(el) {
          _this3.dropdownRef = el;
        },
        'data-hook': 'dropdown:content'
      };

      if (className) {
        klasses.push(className);
      }

      dropdownContentProps.className = klasses.join(' ');

      if (id) {
        dropdownContentProps.id = id;
      }

      return _react2.default.createElement(
        _reactTransitionGroup.CSSTransition,
        {
          'in': this.state.open,
          appear: true,
          unmountOnExit: true,
          classNames: 'drop-trans',
          timeout: { enter: 300, exit: 300 } },
        _react2.default.createElement(
          TransitionItem,
          {
            props: dropdownContentProps,
            onChange: this.props.onChange },
          this.props.children
        )
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var _props3 = this.props,
          alignment = _props3.alignment,
          direction = _props3.direction;


      var allowed = void 0;
      if (direction === 'up' || direction === 'down') {
        allowed = ['left', 'center', 'right'];
      } else if (direction === 'left' || direction === 'right') {
        allowed = ['top', 'middle', 'bottom'];
      } else {
        throw new Error('Dropdown: direction "' + direction + '" is not supported. Use one of: up, down, left, right');
      }

      if (allowed.indexOf(alignment) === -1) {
        throw new Error('Dropdown: alignment "' + alignment + '" is not supported when direction is ' + direction + '. Use one of: ' + allowed.join(', '));
      }

      var tetherAttachment = void 0;
      var tetherTargetAttachment = void 0;
      switch (direction) {
        case 'up':
          tetherAttachment = 'bottom ' + alignment;
          tetherTargetAttachment = 'top ' + alignment;
          break;
        case 'down':
          tetherAttachment = 'top ' + alignment;
          tetherTargetAttachment = 'bottom ' + alignment;
          break;
        case 'right':
          tetherAttachment = alignment + ' left';
          tetherTargetAttachment = alignment + ' right';
          break;
        case 'left':
          tetherAttachment = alignment + ' right';
          tetherTargetAttachment = alignment + ' left';
          break;
      }

      // attachment={tetherAttachment}
      // targetAttachment={tetherTargetAttachment}
      return _react2.default.createElement(
        _reactTether2.default
        // attachment is the content.
        ,
        { attachment: tetherAttachment
          // targetAttachment is the trigger
          , targetAttachment: tetherTargetAttachment,
          constraints: [{
            to: 'scrollParent',
            attachment: 'together'
          }] },
        this.renderTriggerElement(),
        this.renderContent()
      );
    }
  }], [{
    key: 'closeAll',
    value: function closeAll() {
      activeDropdowns.forEach(function (d) {
        return d.close();
      });
    }
  }]);

  return Dropdown;
}(_react2.default.Component);

exports.default = Dropdown;


Dropdown.defaultProps = {
  triggerElement: 'button',
  direction: 'down',
  alignment: 'center'
};

if (process.env.NODE_ENV !== 'production') {
  Dropdown.propTypes = {
    id: _react.PropTypes.string,
    onChange: _react.PropTypes.func,

    triggerElement: _react.PropTypes.oneOf(['a', 'button']),
    triggerClassName: _react.PropTypes.string,
    triggerActiveClassName: _react.PropTypes.string,
    triggerTitle: _react.PropTypes.string,
    triggerText: _react.PropTypes.string.isRequired,

    direction: _react.PropTypes.oneOf(['up', 'down', 'left', 'right']),
    alignment: _react.PropTypes.oneOf(['left', 'center', 'right', 'top', 'middle', 'bottom']),

    className: _react.PropTypes.string,
    children: _react.PropTypes.node
  };
}

var TransitionItem = function (_React$Component2) {
  _inherits(TransitionItem, _React$Component2);

  function TransitionItem() {
    _classCallCheck(this, TransitionItem);

    return _possibleConstructorReturn(this, (TransitionItem.__proto__ || Object.getPrototypeOf(TransitionItem)).apply(this, arguments));
  }

  _createClass(TransitionItem, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      this.props.onChange && this.props.onChange(true);
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      this.props.onChange && this.props.onChange(false);
    }
  }, {
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'div',
        this.props.props,
        this.props.children
      );
    }
  }]);

  return TransitionItem;
}(_react2.default.Component);

if (process.env.NODE_ENV !== 'production') {
  TransitionItem.propTypes = {
    onChange: _react.PropTypes.func,
    props: _react.PropTypes.object,
    children: _react.PropTypes.node
  };
}

}).call(this,require('_process'))

},{"_process":"/home/tungst/Desktop/OpenRoads/pycba-webapp/node_modules/process/browser.js","react":"react","react-tether":"react-tether","react-transition-group":"react-transition-group"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/map-legend.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _lineColors = require('../utils/line-colors');

var _lineColors2 = _interopRequireDefault(_lineColors);

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var renderTitle = function renderTitle(layer) {
  if (layer === 'iri') {
    return _react2.default.createElement(
      _t2.default,
      null,
      'IRI'
    );
  } else if (layer === 'or_width') {
    return _react2.default.createElement(
      _t2.default,
      null,
      'Width'
    );
  } else if (layer === 'or_condition') {
    return _react2.default.createElement(
      _t2.default,
      null,
      'Condition'
    );
  } else if (layer === 'or_surface') {
    return _react2.default.createElement(
      _t2.default,
      null,
      'Surface'
    );
  }
};

var MapLegend = function MapLegend(_ref) {
  var layer = _ref.layer;

  var colors = _lineColors2.default[layer];
  var continuous = colors.type !== 'categorical';
  var stops = colors.stops;

  var bestColorLabel = void 0;
  var worstColorLabel = void 0;

  if (continuous) {
    bestColorLabel = stops[0][0];
    worstColorLabel = stops[stops.length - 1][0];
  }

  return _react2.default.createElement(
    'figcaption',
    { className: 'panel legend-panel' },
    _react2.default.createElement(
      'div',
      { className: 'panel__body' },
      _react2.default.createElement(
        'h3',
        { className: 'map-legend-title' },
        renderTitle(layer)
      ),
      _react2.default.createElement(
        'div',
        null,
        _react2.default.createElement(
          'div',
          { className: 'map-legend-scale-container' },
          _react2.default.createElement('div', { className: 'map-legend-scale' }),
          _react2.default.createElement(
            'span',
            { className: 'map-legend-scale-label' },
            bestColorLabel
          ),
          _react2.default.createElement(
            'span',
            { className: 'map-legend-scale-label' },
            worstColorLabel
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'map-legend-nodata-container' },
          _react2.default.createElement('div', { className: 'map-legend-nodata' }),
          _react2.default.createElement(
            'span',
            { className: 'map-legend-nodata-label' },
            _react2.default.createElement(
              _t2.default,
              null,
              'No data'
            )
          )
        )
      )
    )
  );
};

MapLegend.propTypes = {
  layer: _react2.default.PropTypes.string,
  language: _react2.default.PropTypes.string
};

exports.default = (0, _recompose.getContext)({ language: _react2.default.PropTypes.string })(MapLegend);

},{"../utils/line-colors":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/utils/line-colors.js","./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/map-options.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var MapOptions = function MapOptions(_ref) {
  var language = _ref.language,
      handleLayerChange = _ref.handleLayerChange,
      handleShowNoVpromms = _ref.handleShowNoVpromms;
  return _react2.default.createElement(
    'div',
    { className: 'panel options-panel' },
    _react2.default.createElement(
      'div',
      { className: 'panel__body' },
      _react2.default.createElement(
        'form',
        { className: 'form' },
        _react2.default.createElement(
          'div',
          { className: 'form__group' },
          _react2.default.createElement(
            'label',
            { className: 'form__label' },
            _react2.default.createElement(
              _t2.default,
              null,
              'Visualized variable'
            )
          ),
          _react2.default.createElement(
            'select',
            { className: 'form__control', onChange: function onChange(e) {
                return handleLayerChange(e);
              } },
            _react2.default.createElement(
              'option',
              { value: 'iri' },
              (0, _t.translate)(language, 'IRI')
            )
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'form__group' },
          _react2.default.createElement(
            'label',
            { className: 'form__label' },
            (0, _t.translate)(language, 'Options')
          ),
          _react2.default.createElement(
            'label',
            {
              className: 'form__option form__option--switch option fos-io',
              htmlFor: 'show-no-vpromms'
            },
            _react2.default.createElement('input', { type: 'checkbox', defaultChecked: true, name: 'show-no-vpromms', id: 'show-no-vpromms', value: 'show-no-vpromms', onChange: function onChange(e) {
                return handleShowNoVpromms(e);
              } }),
            _react2.default.createElement('span', { className: 'form__option__ui' }),
            _react2.default.createElement(
              'span',
              { className: 'form__option__text' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Road without VPRoMMS ID'
              ),
              ' ',
              _react2.default.createElement(
                'b',
                null,
                '----'
              )
            )
          )
        )
      )
    )
  );
};

MapOptions.propTypes = {
  layer: _react2.default.PropTypes.string,
  handleLayerChange: _react2.default.PropTypes.func,
  handleShowNoVpromms: _react2.default.PropTypes.func,
  language: _react2.default.PropTypes.string
};

exports.default = (0, _recompose.getContext)({ language: _react2.default.PropTypes.string })(MapOptions);

},{"./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/map-search.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _recompose = require('recompose');

var _reactRedux = require('react-redux');

var _reactRouterRedux = require('react-router-redux');

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

var _actionCreators = require('../actions/action-creators');

var _roads = require('../redux/modules/roads');

var _reactRouter = require('react-router');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var MapSearch = _react2.default.createClass({
  displayName: 'MapSearch',

  propTypes: {
    searchType: _react2.default.PropTypes.string,
    fetching: _react2.default.PropTypes.bool,
    vpromms: _react2.default.PropTypes.array,
    admins: _react2.default.PropTypes.array,
    filteredVProMMs: _react2.default.PropTypes.array,
    language: _react2.default.PropTypes.string,
    _setSearchType: _react2.default.PropTypes.func,
    _fetchAdmins: _react2.default.PropTypes.func,
    _clearAdmins: _react2.default.PropTypes.func,
    _setFilteredVProMMs: _react2.default.PropTypes.func,
    fetchRoadBbox: _react2.default.PropTypes.func,
    _fetchFieldVProMMsIds: _react2.default.PropTypes.func,
    _fetchAdminBbox: _react2.default.PropTypes.func,
    fetchRoadProperty: _react2.default.PropTypes.func
  },

  getInitialState: function getInitialState() {
    return {
      searchVal: '',
      showResults: true
    };
  },

  componentDidMount: function componentDidMount() {
    this.props._fetchFieldVProMMsIds();
    this.search = _lodash2.default.debounce(this.search, 300);
  },

  componentWillUnmount: function componentWillUnmount() {
    this.props._clearAdmins();
    this.props._setFilteredVProMMs([]);
  },

  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    if (this.props.language !== nextProps.language) {
      this.setState({ searchVal: '', showResults: false });
      this.props._clearAdmins();
      this.props._setFilteredVProMMs([]);
    }
  },

  onClearSearch: function onClearSearch(e) {
    this.setState({ searchVal: '', showResults: false });
    this.props._clearAdmins();
    this.props._setFilteredVProMMs([]);
  },

  onSearchTypeChange: function onSearchTypeChange(e) {
    this.props._setSearchType(e.target.value);
    this.setState({ searchVal: '', showResults: true });
    this.props._clearAdmins();
    this.props._setFilteredVProMMs([]);
  },

  onSearchQueryChange: function onSearchQueryChange(e) {
    var searchVal = e.target.value;
    this.setState({ searchVal: searchVal, showResults: true });
    // The search function is debounced.
    this.search(_lodash2.default.trim(searchVal));
  },

  onSearchSubmit: function onSearchSubmit(e) {
    e.preventDefault();
    this.setState({ showResults: true });
    // On enter, use the first value. Feeling lucky!
    var searchVal = this.state.searchVal;
    if (searchVal.length) {
      if (this.props.searchType === 'Admin' && this.props.admins[0]) {
        this.searchAdminArea(this.props.admins[0].id);
        this.setState({ searchVal: this.props.admins[0].name_en });
      } else if (this.props.filteredVProMMs[0]) {
        this.searchVProMMsID(this.props.filteredVProMMs[0]);
        this.setState({ searchVal: this.props.filteredVProMMs[0] });
      }
    }
  },

  search: function search(searchVal) {
    if (this.props.searchType === 'Admin') {
      if (searchVal.length > 0) {
        this.props._fetchAdmins(searchVal);
      } else {
        this.props._clearAdmins();
      }
    } else {
      if (searchVal.length >= 2) {
        // Filter the available vpromms.
        var matches = this.props.vpromms.filter(function (vpromm) {
          return vpromm.slice(0, searchVal.length) === searchVal.toUpperCase();
        });
        this.props._setFilteredVProMMs(matches.slice(0, 10));
      } else {
        this.props._setFilteredVProMMs([]);
      }
    }
  },

  searchVProMMsID: function searchVProMMsID(VProMMsID) {
    var _this = this;

    this.setState({ showResults: false }, function () {
      // Wait for the state to be set, otherwise the shouldComponentUpdate
      // of the parent will prevent the re-render.
      // This is an artifact.
      _this.props.fetchRoadBbox(VProMMsID);
      _this.props.fetchRoadProperty(VProMMsID);
    });
  },

  searchAdminArea: function searchAdminArea(adminAreaID) {
    var _this2 = this;

    this.setState({ showResults: false }, function () {
      // Wait for the state to be set, otherwise the shouldComponentUpdate
      // of the parent will prevent the re-render.
      // This is an artifact.
      _this2.props._fetchAdminBbox(adminAreaID);
    });
  },

  onAAClick: function onAAClick(aa, e) {
    e.preventDefault();
    this.searchAdminArea(aa.id);
    this.setState({ searchVal: this.props.language === 'en' ? aa.name_en : aa.name_vn });
  },

  onVprommClick: function onVprommClick(id, e) {
    e.preventDefault();
    this.searchVProMMsID(id);
    this.setState({ searchVal: id });
  },

  renderResults: function renderResults() {
    var _this3 = this;

    if (!this.state.showResults) {
      return null;
    }

    if (this.props.fetching) {
      return _react2.default.createElement(
        'div',
        { className: 'search-results' },
        _react2.default.createElement(
          'p',
          { className: 'info' },
          _react2.default.createElement(
            _t2.default,
            null,
            'Loading'
          ),
          '...'
        )
      );
    }

    // Data to work with depends n the search type.
    var data = this.props.searchType === 'Admin' ? this.props.admins : this.props.filteredVProMMs;
    var contents = null;

    if (this.props.searchType === 'Admin') {
      if (data.length) {
        contents = (0, _lodash2.default)(data).groupBy(function (o) {
          return o.level;
        }).reduce(function (acc, level, key) {
          acc.push(_react2.default.createElement(
            'h4',
            { key: 'aa-type-admin-' + key },
            _react2.default.createElement(
              _t2.default,
              null,
              'Admin Level'
            ),
            ' - ',
            _react2.default.createElement(
              _t2.default,
              null,
              key
            )
          ));

          var adminAreas = level.reduce(function (_acc, o) {
            return _acc.concat(_react2.default.createElement(
              'li',
              { key: o.id },
              _react2.default.createElement(
                'a',
                { href: '#', onClick: _this3.onAAClick.bind(null, o) },
                _this3.props.language === 'en' ? o.name_en : o.name_vn
              )
            ));
          }, []);

          acc.push(_react2.default.createElement(
            'ul',
            { key: 'aa-admins-' + key },
            adminAreas
          ));

          return acc;
        }, []);
      } else {
        if (this.state.searchVal) {
          contents = _react2.default.createElement(
            'p',
            { className: 'info', key: 'no-results' },
            _react2.default.createElement(
              _t2.default,
              null,
              'No results available. Please refine your search'
            )
          );
        }
      }
    } else if (this.props.searchType === 'VProMMs' && this.state.searchVal.length >= 2) {
      if (!data.length) {
        contents = _react2.default.createElement(
          'p',
          { className: 'info', key: 'no-results' },
          _react2.default.createElement(
            _t2.default,
            null,
            'No results available. Please refine your search'
          )
        );
      } else {
        contents = [_react2.default.createElement(
          'h4',
          { key: 'vpromms-title' },
          'VProMMs'
        )];

        var vpromms = data.reduce(function (acc, o, key) {
          return acc.concat(_react2.default.createElement(
            'li',
            { key: o },
            _react2.default.createElement(
              'a',
              { href: '#', onClick: _this3.onVprommClick.bind(null, o) },
              o
            )
          ));
        }, []);

        contents.push(_react2.default.createElement(
          'ul',
          { key: 'vpromms-list' },
          vpromms
        ));
      }
    }

    if (contents === null) {
      return null;
    }

    return _react2.default.createElement(
      'div',
      { className: 'search-results' },
      _react2.default.createElement(
        'div',
        { className: 'inner' },
        contents
      )
    );
  },

  render: function render() {
    var _props = this.props,
        language = _props.language,
        searchType = _props.searchType;


    return _react2.default.createElement(
      'form',
      { className: 'form search', onSubmit: this.onSearchSubmit },
      _react2.default.createElement(
        'div',
        { className: 'form__group' },
        _react2.default.createElement(
          'label',
          { className: 'form__label', htmlFor: 'search-field' },
          _react2.default.createElement(
            _t2.default,
            null,
            'Search'
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'form__input-group form__input-group--medium' },
          _react2.default.createElement(
            'select',
            { className: 'form__control', onChange: this.onSearchTypeChange, value: searchType },
            _react2.default.createElement(
              'option',
              { value: 'Admin' },
              (0, _t.translate)(language, 'Admin')
            ),
            _react2.default.createElement(
              'option',
              { value: 'VProMMs' },
              'VProMMs'
            )
          ),
          _react2.default.createElement('input', {
            type: 'text',
            id: 'search-field',
            name: 'search-field',
            className: 'form__control',
            placeholder: (0, _t.translate)(language, 'Search'),
            value: this.state.searchVal,
            onChange: this.onSearchQueryChange }),
          _react2.default.createElement(
            'button',
            {
              type: 'button',
              className: 'search__button',
              onClick: this.onSearchSubmit
            },
            _react2.default.createElement(
              'span',
              null,
              _react2.default.createElement(
                _t2.default,
                null,
                'Search'
              )
            )
          )
        ),
        this.state.searchVal !== '' && _react2.default.createElement(
          'button',
          {
            type: 'button',
            className: 'search__clear',
            title: (0, _t.translate)(language, 'Clear search'),
            onClick: this.onClearSearch
          },
          _react2.default.createElement(
            'span',
            null,
            _react2.default.createElement(
              _t2.default,
              null,
              'Clear search'
            )
          )
        ),
        this.renderResults()
      )
    );
  }
});

exports.default = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), _reactRouter.withRouter,
// withProps(({ location: { query: { activeRoad } } }) => ({
//   activeRoad
// })),
(0, _reactRedux.connect)(function (state) {
  return {
    searchType: state.setSearchType.searchType,
    admins: state.admins.units,
    vpromms: state.fieldVProMMsids.ids,
    filteredVProMMs: state.setFilteredVProMMs,
    fetching: state.admins.fetching
  };
}, function (dispatch, _ref) {
  var location = _ref.location;
  return {
    _fetchFieldVProMMsIds: function _fetchFieldVProMMsIds() {
      return dispatch(_actionCreators.fetchFieldVProMMsIds.apply(undefined, arguments));
    },
    _setSearchType: function _setSearchType() {
      return dispatch(_actionCreators.setSearchType.apply(undefined, arguments));
    },
    _setFilteredVProMMs: function _setFilteredVProMMs(filteredVProMMs) {
      return dispatch((0, _actionCreators.setFilteredVProMMs)(filteredVProMMs));
    },
    _clearAdmins: function _clearAdmins() {
      return dispatch((0, _actionCreators.clearAdmins)());
    },
    _fetchAdmins: function _fetchAdmins(id) {
      return dispatch((0, _actionCreators.fetchAdmins)(id));
    },
    _fetchAdminBbox: function _fetchAdminBbox(id) {
      return dispatch((0, _actionCreators.fetchAdminBbox)(id));
    },
    fetchRoadBbox: function fetchRoadBbox(vprommsId) {
      dispatch((0, _reactRouterRedux.push)(Object.assign({}, location, {
        query: Object.assign({}, location.query, {
          activeRoad: vprommsId
        })
      })));
      dispatch((0, _roads.fetchRoadBboxEpic)(vprommsId));
    },
    fetchRoadProperty: function fetchRoadProperty(vprommsId) {
      dispatch((0, _roads.fetchRoadPropertyEpic)(vprommsId));
    }
  };
}))(MapSearch);

},{"../actions/action-creators":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-creators.js","../redux/modules/roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js","./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","lodash":"lodash","react":"react","react-redux":"react-redux","react-router":"react-router","react-router-redux":"react-router-redux","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/modal.js":[function(require,module,exports){
(function (process){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ModalFooter = exports.ModalBody = exports.ModalHeader = exports.Modal = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactPortal = require('react-portal');

var _reactTransitionGroup = require('react-transition-group');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Modal = exports.Modal = function (_React$Component) {
  _inherits(Modal, _React$Component);

  function Modal(props) {
    _classCallCheck(this, Modal);

    var _this = _possibleConstructorReturn(this, (Modal.__proto__ || Object.getPrototypeOf(Modal)).call(this, props));

    _this.componentAddedBodyClass = false;

    _this.onOverlayClick = _this.onOverlayClick.bind(_this);
    _this.onCloseClick = _this.onCloseClick.bind(_this);
    _this.keyListener = _this.keyListener.bind(_this);

    _this.el = document.createElement('div');
    _this.el.className = 'modal-portal-' + Math.random().toString();
    _this.rootEl = document.querySelector('#site-canvas');
    if (!_this.rootEl) throw new Error('Portal root element does not exist.');
    return _this;
  }

  _createClass(Modal, [{
    key: 'keyListener',
    value: function keyListener(e) {
      // ESC.
      if (this.props.revealed && e.keyCode === 27) {
        e.preventDefault();
        this.props.onCloseClick();
      }
    }

    // closeModal () {
    //   this.setState({ revealed: false });
    // },

    // openModal () {
    //   this.setState({ revealed: true });
    // },

    // getInitialState () {
    //   return {
    //     revealed: this.props.revealed
    //   };
    // },

  }, {
    key: 'toggleBodyClass',
    value: function toggleBodyClass(revealed) {
      var bd = document.getElementsByTagName('body')[0];
      if (revealed) {
        this.componentAddedBodyClass = true;
        bd.classList.add('modal__unscrollable-y');
      } else if (this.componentAddedBodyClass) {
        // Only act if the class was added by this component.
        this.componentAddedBodyClass = false;
        bd.classList.remove('modal__unscrollable-y');
      }
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      this.toggleBodyClass(this.props.revealed);
    }
  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      document.addEventListener('keyup', this.keyListener);
      this.toggleBodyClass(this.props.revealed);

      this.rootEl.appendChild(this.el);
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      document.removeEventListener('keyup', this.keyListener);
      this.toggleBodyClass(false);

      this.rootEl.removeChild(this.el);
    }
  }, {
    key: 'onOverlayClick',
    value: function onOverlayClick(e) {
      // Prevent children from triggering this.
      if (e.target === e.currentTarget) {
        // Overlay click is disabled.
        // this.props.onOverlayClick.call(this, e);
      }
    }
  }, {
    key: 'onCloseClick',
    value: function onCloseClick(e) {
      e.preventDefault();
      this.props.onCloseClick(e);
    }
  }, {
    key: 'getChild',
    value: function getChild(klass) {
      var c = null;
      _react2.default.Children.forEach(this.props.children, function (o) {
        if (!c && o.type === klass) {
          c = o;
        }
      });
      return c;
    }
  }, {
    key: 'render',
    value: function render() {
      var klasses = ['modal'];
      if (this.props.className) {
        klasses.push(this.props.className);
      }

      return _react2.default.createElement(
        _reactPortal.Portal,
        { node: this.el && this.el },
        _react2.default.createElement(
          _reactTransitionGroup.CSSTransition,
          {
            'in': this.props.revealed,
            appear: true,
            unmountOnExit: true,
            classNames: 'modal',
            timeout: { enter: 300, exit: 300 } },
          _react2.default.createElement(
            'section',
            { className: klasses.join(' '), key: 'modal-' + this.props.id, onClick: this.onOverlayClick, id: this.props.id },
            _react2.default.createElement(
              'div',
              { className: 'modal__inner' },
              this.getChild(ModalHeader),
              this.getChild(ModalBody),
              this.getChild(ModalFooter)
            ),
            _react2.default.createElement(
              'button',
              { className: 'modal__button-dismiss', title: 'Close', onClick: this.onCloseClick },
              _react2.default.createElement(
                'span',
                null,
                'Dismiss'
              )
            )
          )
        )
      );
    }
  }]);

  return Modal;
}(_react2.default.Component);

Modal.defaultProps = {
  revealed: false,

  onOverlayClick: function onOverlayClick(e) {
    if (process.env.NODE_ENV !== 'production') {
      console.warn('Modal', 'onOverlayClick handler not implemented');
    }
  },

  onCloseClick: function onCloseClick(e) {
    if (process.env.NODE_ENV !== 'production') {
      console.warn('Modal', 'onCloseClick handler not implemented');
    }
  }
};

if (process.env.NODE_ENV !== 'production') {
  Modal.propTypes = {
    id: _react.PropTypes.string.isRequired,
    revealed: _react.PropTypes.bool,
    className: _react.PropTypes.string,
    onOverlayClick: _react.PropTypes.func,
    onCloseClick: _react.PropTypes.func,
    children: function children(props, propName, componentName) {
      var types = ['ModalHeader', 'ModalBody', 'ModalFooter'];
      var typesRequired = ['ModalHeader', 'ModalBody'];
      var children = _react2.default.Children.toArray(props[propName]);

      var c = children.length;
      if (c === 0 || c > 3) {
        return new Error(componentName + ' should have at least a child but no more than 3');
      }

      var components = {};

      for (var i = 0; i < c; i++) {
        var o = children[i];
        var name = o.type.name;
        if (types.indexOf(name) === -1) {
          return new Error(componentName + ' children should be of the following types: ' + types.join(', '));
        }
        if (!components[name]) {
          components[name] = 0;
        }
        if (++components[name] > 1) {
          return new Error(componentName + ' should have only one instance of: ' + name);
        }
      }

      for (var _i = 0; _i < typesRequired.length; _i++) {
        if (!components[typesRequired[_i]]) {
          return new Error(componentName + ' should have a ' + typesRequired[_i]);
        }
      }
    }
  };
}

var ModalHeader = exports.ModalHeader = function (_React$Component2) {
  _inherits(ModalHeader, _React$Component2);

  function ModalHeader() {
    _classCallCheck(this, ModalHeader);

    return _possibleConstructorReturn(this, (ModalHeader.__proto__ || Object.getPrototypeOf(ModalHeader)).apply(this, arguments));
  }

  _createClass(ModalHeader, [{
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'header',
        { className: 'modal__header' },
        this.props.children
      );
    }
  }]);

  return ModalHeader;
}(_react2.default.Component);

if (process.env.NODE_ENV !== 'production') {
  ModalHeader.propTypes = {
    children: _react.PropTypes.node
  };
}

var ModalBody = exports.ModalBody = function (_React$Component3) {
  _inherits(ModalBody, _React$Component3);

  function ModalBody() {
    _classCallCheck(this, ModalBody);

    return _possibleConstructorReturn(this, (ModalBody.__proto__ || Object.getPrototypeOf(ModalBody)).apply(this, arguments));
  }

  _createClass(ModalBody, [{
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'div',
        { className: 'modal__body' },
        this.props.children
      );
    }
  }]);

  return ModalBody;
}(_react2.default.Component);

if (process.env.NODE_ENV !== 'production') {
  ModalBody.propTypes = {
    children: _react.PropTypes.node
  };
}

var ModalFooter = exports.ModalFooter = function (_React$Component4) {
  _inherits(ModalFooter, _React$Component4);

  function ModalFooter() {
    _classCallCheck(this, ModalFooter);

    return _possibleConstructorReturn(this, (ModalFooter.__proto__ || Object.getPrototypeOf(ModalFooter)).apply(this, arguments));
  }

  _createClass(ModalFooter, [{
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'footer',
        { className: 'modal__footer' },
        this.props.children
      );
    }
  }]);

  return ModalFooter;
}(_react2.default.Component);

if (process.env.NODE_ENV !== 'production') {
  ModalFooter.propTypes = {
    children: _react.PropTypes.node
  };
}

}).call(this,require('_process'))

},{"_process":"/home/tungst/Desktop/OpenRoads/pycba-webapp/node_modules/process/browser.js","react":"react","react-portal":"react-portal","react-transition-group":"react-transition-group"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/province-table-column-header.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _recompose = require('recompose');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ProvinceTableColumnHeader = (0, _recompose.withHandlers)({
  sortLink: function sortLink(_ref) {
    var columnKey = _ref.columnKey,
        sortLinkHandler = _ref.sortLinkHandler;
    return function () {
      return sortLinkHandler(columnKey);
    };
  }
})(function (_ref2) {
  var columnKey = _ref2.columnKey,
      label = _ref2.label,
      sortField = _ref2.sortField,
      sortOrder = _ref2.sortOrder,
      sortLink = _ref2.sortLink;
  return _react2.default.createElement(
    'th',
    {
      className: 'table-properties-head sortable',
      onClick: sortLink
    },
    _react2.default.createElement('i', {
      className: (0, _classnames2.default)({
        'collecticon-sort-none': sortField !== columnKey,
        'collecticon-sort-asc': sortField === columnKey && sortOrder === 'asc',
        'collecticon-sort-desc': sortField === columnKey && sortOrder === 'desc'
      })
    }),
    _react2.default.createElement(
      _t2.default,
      null,
      label
    )
  );
});

exports.default = ProvinceTableColumnHeader;

},{"./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","classnames":"classnames","react":"react","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/province-table-row.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRouter = require('react-router');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ProvinceTableRow = function ProvinceTableRow(_ref) {
  var id = _ref.id,
      name = _ref.name,
      routeId = _ref.routeId,
      osmCount = _ref.osmCount,
      count = _ref.count,
      percentageComplete = _ref.percentageComplete,
      language = _ref.language;
  return _react2.default.createElement(
    'tr',
    null,
    _react2.default.createElement(
      'td',
      null,
      _react2.default.createElement(
        _reactRouter.Link,
        { to: language + '/assets/' + routeId },
        _react2.default.createElement(
          'strong',
          null,
          name
        )
      )
    ),
    _react2.default.createElement(
      'td',
      null,
      osmCount
    ),
    _react2.default.createElement(
      'td',
      null,
      count
    ),
    _react2.default.createElement(
      'td',
      null,
      _react2.default.createElement(
        'div',
        { className: 'meter' },
        _react2.default.createElement('div', {
          className: 'meter__internal',
          style: { width: percentageComplete + '%' }
        })
      )
    )
  );
};

exports.default = ProvinceTableRow;

},{"react":"react","react-router":"react-router"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/province-table.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _lodash = require('lodash');

var _provinceTableRow = require('./province-table-row');

var _provinceTableRow2 = _interopRequireDefault(_provinceTableRow);

var _provinceTableColumnHeader = require('./province-table-column-header');

var _provinceTableColumnHeader2 = _interopRequireDefault(_provinceTableColumnHeader);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ProvinceTable = function ProvinceTable(_ref) {
  var provinces = _ref.provinces,
      language = _ref.language,
      sortField = _ref.sortField,
      sortOrder = _ref.sortOrder,
      sortHandler = _ref.sortHandler;
  return _react2.default.createElement(
    'div',
    { className: 'table' },
    _react2.default.createElement(
      'table',
      null,
      _react2.default.createElement(
        'thead',
        null,
        _react2.default.createElement(
          'tr',
          null,
          [['name', 'Province'], ['osmCount', 'Field'], ['count', 'Total'], ['percentageComplete', 'Progress']].map(function (_ref2) {
            var _ref3 = _slicedToArray(_ref2, 2),
                columnKey = _ref3[0],
                columnLabel = _ref3[1];

            return _react2.default.createElement(_provinceTableColumnHeader2.default, {
              key: columnLabel,
              columnKey: columnKey,
              label: columnLabel,
              sortField: sortField,
              sortOrder: sortOrder,
              sortLinkHandler: sortHandler
            });
          })
        )
      ),
      _react2.default.createElement(
        'tbody',
        null,
        (0, _lodash.map)((0, _lodash.orderBy)(provinces, [sortField], [sortOrder]), function (_ref4) {
          var id = _ref4.id,
              name = _ref4.name,
              routeId = _ref4.routeId,
              osmCount = _ref4.osmCount,
              count = _ref4.count,
              percentageComplete = _ref4.percentageComplete;
          return _react2.default.createElement(_provinceTableRow2.default, {
            key: id,
            id: id,
            name: name,
            routeId: routeId,
            osmCount: osmCount,
            count: count,
            percentageComplete: percentageComplete,
            language: language
          });
        })
      )
    )
  );
};

exports.default = ProvinceTable;

},{"./province-table-column-header":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/province-table-column-header.js","./province-table-row":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/province-table-row.js","lodash":"lodash","react":"react"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/road-pagination.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _lodash = require('lodash');

var _recompose = require('recompose');

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var PageNumber = (0, _recompose.withHandlers)({
  buttonClick: function buttonClick(_ref) {
    var setPage = _ref.setPage,
        page = _ref.page;
    return function () {
      return setPage(page);
    };
  }
})(function (_ref2) {
  var page = _ref2.page,
      currentPage = _ref2.currentPage,
      buttonClick = _ref2.buttonClick;
  return _react2.default.createElement(
    'li',
    null,
    page === currentPage ? _react2.default.createElement(
      'strong',
      null,
      page
    ) : _react2.default.createElement(
      'button',
      {
        className: 'button button-base-light',
        onClick: buttonClick
      },
      page
    )
  );
});

var RoadPagination = function RoadPagination(_ref3) {
  var start = _ref3.start,
      end = _ref3.end,
      currentPage = _ref3.page,
      roadPageCount = _ref3.roadPageCount,
      setPage = _ref3.setPage,
      nextPage = _ref3.nextPage,
      previousPage = _ref3.previousPage;
  return _react2.default.createElement(
    'div',
    { className: 'a-paginator' },
    _react2.default.createElement(
      'ul',
      null,
      (0, _lodash.range)(start, end + 1).map(function (page) {
        return _react2.default.createElement(PageNumber, {
          key: page,
          page: page,
          currentPage: currentPage,
          setPage: setPage
        });
      })
    ),
    _react2.default.createElement(
      'button',
      {
        className: 'button button-base-light',
        onClick: previousPage,
        disabled: currentPage === 1
      },
      _react2.default.createElement(
        _t2.default,
        null,
        'Previous'
      )
    ),
    _react2.default.createElement(
      'button',
      {
        className: 'button button-base-light',
        onClick: nextPage,
        disabled: currentPage === roadPageCount
      },
      _react2.default.createElement(
        _t2.default,
        null,
        'Next'
      )
    )
  );
};

exports.default = (0, _recompose.compose)((0, _recompose.withProps)(function (_ref4) {
  var page = _ref4.page,
      roadPageCount = _ref4.roadPageCount;

  var start = Math.max(page - 10, 1);
  var end = Math.min(start + 10, roadPageCount);
  return { start: start, end: end };
}), (0, _recompose.withHandlers)({
  nextPage: function nextPage(_ref5) {
    var page = _ref5.page,
        setPage = _ref5.setPage;
    return function () {
      return setPage(Math.max(page + 1, 1));
    };
  },
  previousPage: function previousPage(_ref6) {
    var page = _ref6.page,
        roadPageCount = _ref6.roadPageCount,
        setPage = _ref6.setPage;
    return function () {
      return setPage(Math.min(page - 1, roadPageCount));
    };
  }
}))(RoadPagination);

},{"./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","lodash":"lodash","react":"react","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/road-progress-bar.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var RoadProgressBar = function RoadProgressBar(_ref) {
  var percent = _ref.percent,
      roadOsmCount = _ref.roadOsmCount,
      roadCount = _ref.roadCount;
  return _react2.default.createElement(
    'div',
    { className: 'a-main__status' },
    _react2.default.createElement(
      'h2',
      null,
      _react2.default.createElement(
        'strong',
        null,
        percent
      ),
      _react2.default.createElement(
        'span',
        null,
        '% ',
        _react2.default.createElement(
          _t2.default,
          null,
          'of VPRoMMS Ids have field data'
        ),
        ' ',
        _react2.default.createElement(
          'em',
          null,
          '(',
          roadOsmCount,
          ' / ',
          roadCount,
          ')'
        )
      )
    ),
    _react2.default.createElement(
      'div',
      { className: 'meter' },
      _react2.default.createElement('div', { className: 'meter__internal', style: { width: percent + '%' } })
    )
  );
};

exports.default = (0, _recompose.withProps)(function (_ref2) {
  var _ref2$roadOsmCount = _ref2.roadOsmCount,
      roadOsmCount = _ref2$roadOsmCount === undefined ? 0 : _ref2$roadOsmCount,
      roadCount = _ref2.roadCount;
  return {
    percent: roadCount === 0 ? 0 : (roadOsmCount / roadCount * 100).toFixed(2)
  };
})(RoadProgressBar);

},{"./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/road-table-row.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TableErrorRow = undefined;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRouter = require('react-router');

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _config = require('../config');

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var RowReadView = function RowReadView(_ref) {
  var vpromm = _ref.vpromm,
      properties = _ref.properties,
      hasOSMData = _ref.hasOSMData,
      language = _ref.language,
      shouldShowProperties = _ref.shouldShowProperties,
      toggleProperties = _ref.toggleProperties,
      showDeleteView = _ref.showDeleteView,
      showEditView = _ref.showEditView;

  return _react2.default.createElement(
    'tr',
    null,
    _react2.default.createElement(
      'td',
      null,
      _react2.default.createElement(
        _reactRouter.Link,
        { to: '/' + language + '/assets/road/' + vpromm + '/' },
        _react2.default.createElement(
          'strong',
          null,
          vpromm
        )
      )
    ),
    _react2.default.createElement(
      'td',
      { className: hasOSMData ? 'added' : 'not-added' },
      _react2.default.createElement(
        'div',
        { className: 'a-table-actions' },
        _react2.default.createElement(
          _reactRouter.Link,
          { className: 'a-table-action', to: '/' + language + '/assets/road/' + vpromm + '/' },
          _react2.default.createElement(
            _t2.default,
            null,
            'View'
          )
        ),
        _react2.default.createElement(
          'a',
          { className: (0, _classnames2.default)('a-table-action', { disabled: !hasOSMData }), href: _config.api + '/properties/roads/' + vpromm + '.geojson?download', disabled: !hasOSMData },
          _react2.default.createElement(
            _t2.default,
            null,
            'Download'
          )
        )
      )
    )
  );
};

var TableRow = function TableRow(props) {
  if (props.viewState === 'read') {
    return _react2.default.createElement(RowReadView, props);
  }
};

TableRow.propTypes = {
  viewState: _react2.default.PropTypes.string.isRequired
};

var TableErrorRow = exports.TableErrorRow = function TableErrorRow() {
  return _react2.default.createElement(
    'tr',
    { className: 'error-row' },
    _react2.default.createElement('td', null),
    _react2.default.createElement(
      'td',
      { colSpan: '3' },
      _react2.default.createElement(
        'p',
        { className: 'invalid' },
        _react2.default.createElement(
          'strong',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Error'
          )
        )
      )
    )
  );
};

exports.default = TableRow;

},{"../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","classnames":"classnames","react":"react","react-router":"react-router"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/road-table.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _roadTableRowContainer = require('../containers/road-table-row-container');

var _roadTableRowContainer2 = _interopRequireDefault(_roadTableRowContainer);

var _roadPagination = require('./road-pagination');

var _roadPagination2 = _interopRequireDefault(_roadPagination);

var _roadProgressBar = require('./road-progress-bar');

var _roadProgressBar2 = _interopRequireDefault(_roadProgressBar);

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var RoadTable = function RoadTable(_ref) {
  var roadsPage = _ref.roadsPage,
      roadsPageStatus = _ref.roadsPageStatus,
      roadCount = _ref.roadCount,
      roadPageCount = _ref.roadPageCount,
      roadOsmCount = _ref.roadOsmCount,
      roadCountStatus = _ref.roadCountStatus,
      page = _ref.page,
      sortField = _ref.sortField,
      sortOrder = _ref.sortOrder,
      sortColumnAction = _ref.sortColumnAction,
      setPage = _ref.setPage;
  return _react2.default.createElement(
    'div',
    { className: 'table-container' },
    roadCountStatus === 'complete' && roadCount > 0 && _react2.default.createElement(_roadProgressBar2.default, {
      roadOsmCount: roadOsmCount,
      roadCount: roadCount
    }),
    roadsPageStatus === 'pending' ? _react2.default.createElement(
      'div',
      { className: 'a-subnav loading' },
      _react2.default.createElement(
        'h2',
        null,
        _react2.default.createElement(
          _t2.default,
          null,
          'Loading'
        )
      )
    ) : roadsPageStatus === 'error' ? _react2.default.createElement(
      'div',
      { className: 'a-subnav error' },
      _react2.default.createElement(
        'h2',
        null,
        _react2.default.createElement(
          _t2.default,
          null,
          'Error'
        )
      )
    ) : _react2.default.createElement(
      'div',
      { className: 'table a-table' },
      _react2.default.createElement(
        'table',
        null,
        _react2.default.createElement(
          'thead',
          null,
          _react2.default.createElement(
            'tr',
            null,
            _react2.default.createElement(
              'th',
              { className: 'table-properties-head' },
              _react2.default.createElement(
                _t2.default,
                null,
                'VPRoMMS ID'
              )
            ),
            _react2.default.createElement(
              'th',
              { className: 'table-properties-head' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Field Data'
              )
            )
          )
        ),
        _react2.default.createElement(
          'tbody',
          null,
          _lodash2.default.map(roadsPage, function (vpromm) {
            return _react2.default.createElement(_roadTableRowContainer2.default, {
              key: vpromm,
              vpromm: vpromm
            });
          })
        )
      )
    ),
    roadCountStatus === 'complete' && _react2.default.createElement(_roadPagination2.default, {
      page: page,
      roadPageCount: roadPageCount,
      setPage: setPage
    })
  );
};

RoadTable.propTypes = {
  roadsPage: _react2.default.PropTypes.array,
  roadPageCount: _react2.default.PropTypes.number
};

exports.default = RoadTable;

},{"../containers/road-table-row-container":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/containers/road-table-row-container.js","./road-pagination":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/road-pagination.js","./road-progress-bar":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/road-progress-bar.js","./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","lodash":"lodash","react":"react"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/site-header.js":[function(require,module,exports){
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _reactRouter = require('react-router');

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _t = require('./t');

var _t2 = _interopRequireDefault(_t);

var _dropdown = require('./dropdown');

var _dropdown2 = _interopRequireDefault(_dropdown);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var classForLanguage = function classForLanguage(current, lang) {
  return (0, _classnames2.default)('drop__menu-item', { 'drop__menu-item--active': current === lang });
};

var SiteHeader = function SiteHeader(_ref) {
  var language = _ref.language,
      pathname = _ref.pathname;
  return _react2.default.createElement(
    'header',
    { className: 'site__header' },
    _react2.default.createElement(
      'div',
      { className: 'inner' },
      _react2.default.createElement(
        'div',
        { className: 'site__headline' },
        _react2.default.createElement(
          'h1',
          { className: 'site__title' },
          _react2.default.createElement(
            _reactRouter.Link,
            { to: '/' + language },
            _react2.default.createElement('img', { src: 'assets/graphics/layout/openroads-vn-logo-hor-neg.svg', width: '736', height: '96', alt: 'OpenRoads Vietnam logo' }),
            _react2.default.createElement(
              'span',
              null,
              'OpenRoads'
            ),
            ' ',
            _react2.default.createElement(
              'strong',
              null,
              'Vietnam'
            )
          )
        )
      ),
      _react2.default.createElement(
        'nav',
        { className: 'site__nav', role: 'navigation' },
        _react2.default.createElement(
          _dropdown2.default,
          {
            className: 'site__menu-language',
            triggerClassName: 'button-language',
            triggerActiveClassName: 'button--active',
            triggerText: language === 'en' ? 'English' : 'Tiếng Việth',
            triggerTitle: (0, _t.translate)(language, 'Change Language'),
            direction: 'down',
            alignment: 'center' },
          _react2.default.createElement(
            'h3',
            { className: 'drop__title' },
            _react2.default.createElement(
              _t2.default,
              null,
              'Select language'
            )
          ),
          _react2.default.createElement(
            'ul',
            { className: 'drop__menu drop__menu--select' },
            _react2.default.createElement(
              'li',
              null,
              _react2.default.createElement(
                _reactRouter.Link,
                { to: pathname.replace(/^\/[a-z]+/, '/en'), className: classForLanguage(language, 'en') },
                'English'
              )
            ),
            _react2.default.createElement(
              'li',
              null,
              _react2.default.createElement(
                _reactRouter.Link,
                { to: pathname.replace(/^\/[a-z]+/, '/vi'), className: classForLanguage(language, 'vi') },
                'Ti\u1EBFng Vi\u1EC7t'
              )
            )
          )
        ),
        _react2.default.createElement(
          'ul',
          { className: 'site__menu-global' },
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              _reactRouter.Link,
              {
                to: '/' + language + '/assets',
                className: 'site__menu-global-item',
                activeClassName: 'site__menu-global-item--active' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Assets'
              )
            )
          ),
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              _reactRouter.Link,
              {
                to: '/' + language + '/explore',
                className: 'site__menu-global-item',
                activeClassName: 'site__menu-global-item--active' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Explore'
              )
            )
          ),
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              _reactRouter.Link,
              {
                to: '/' + language + '/editor',
                className: 'site__menu-global-item',
                activeClassName: 'site__menu-global-item--active' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Editor'
              )
            )
          ),
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              _reactRouter.Link,
              {
                to: '/' + language + '/tasks',
                className: 'site__menu-global-item',
                activeClassName: 'site__menu-global-item--active' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Tasks'
              )
            )
          ),
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              _reactRouter.Link,
              {
                to: '/' + language + '/upload',
                className: 'site__menu-global-item',
                activeClassName: 'site__menu-global-item--active' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Upload'
              )
            )
          ),
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              _reactRouter.Link,
              {
                to: '/' + language + '/faq',
                className: 'site__menu-global-item',
                activeClassName: 'site__menu-global-item--active' },
              _react2.default.createElement(
                _t2.default,
                null,
                'FAQ'
              )
            )
          ),
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              _reactRouter.Link,
              {
                to: '/' + language + '/demo',
                className: 'site__menu-global-item',
                activeClassName: 'site__menu-global-item--active' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Demo'
              )
            )
          )
        )
      )
    )
  );
};

SiteHeader.propTypes = {
  language: _react2.default.PropTypes.string.isRequired,
  pathname: _react2.default.PropTypes.string.isRequired
};

module.exports = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), _reactRouter.withRouter, (0, _recompose.mapProps)(function (_ref2) {
  var language = _ref2.language,
      pathname = _ref2.router.location.pathname;
  return {
    language: language,
    pathname: pathname
  };
}))(SiteHeader);

},{"./dropdown":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/dropdown.js","./t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","classnames":"classnames","react":"react","react-router":"react-router","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.translate = undefined;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _en = require('../../locales/source/en.json');

var _en2 = _interopRequireDefault(_en);

var _vi = require('../../locales/vi.json');

var _vi2 = _interopRequireDefault(_vi);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var translate = exports.translate = function translate(language, str) {
  if (language === 'en' && _en2.default[str]) {
    return _en2.default[str];
  } else if (language === 'vi' && _vi2.default[str]) {
    return _vi2.default[str];
  }

  if (language === 'en' && "staging" !== 'production') {
    console.warn('No english translation for', str);
  }

  return str;
};

var T = function T(_ref) {
  var language = _ref.language,
      str = _ref.children;

  if (language === 'en' && _en2.default[str]) {
    return _react2.default.createElement(
      'span',
      null,
      _en2.default[str]
    );
  } else if (language === 'vi' && _vi2.default[str]) {
    return _react2.default.createElement(
      'span',
      null,
      _vi2.default[str]
    );
  }

  if (language === 'en' && "staging" !== 'production') {
    console.warn('No english translation for', str);
  }

  return _react2.default.createElement(
    'span',
    null,
    str
  );
};

T.propTypes = {
  language: _react.PropTypes.string.isRequired,
  children: _react.PropTypes.string.isRequired
};

exports.default = (0, _recompose.getContext)({ language: _react.PropTypes.string })(T);

},{"../../locales/source/en.json":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/locales/source/en.json","../../locales/vi.json":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/locales/vi.json","react":"react","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/task-list-item.js":[function(require,module,exports){
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var TaskListItem = _react2.default.createClass({
  displayName: 'TaskListItem',
  propTypes: {
    _id: _react2.default.PropTypes.string,
    vpromm: _react2.default.PropTypes.string,
    province: _react2.default.PropTypes.object,
    mode: _react2.default.PropTypes.string,
    type: _react2.default.PropTypes.string,
    language: _react2.default.PropTypes.string,
    selected: _react2.default.PropTypes.bool,
    isHighlighted: _react2.default.PropTypes.bool,
    toggleSelect: _react2.default.PropTypes.func,
    onMouseOver: _react2.default.PropTypes.func,
    onMouseOut: _react2.default.PropTypes.func
  },

  toggleSelect: function toggleSelect() {
    var _props = this.props,
        _id = _props._id,
        toggleSelect = _props.toggleSelect;

    toggleSelect(_id);
  },

  handleMouseOver: function handleMouseOver() {
    var _props2 = this.props,
        _id = _props2._id,
        onMouseOver = _props2.onMouseOver;

    onMouseOver(_id);
  },

  handleMouseOut: function handleMouseOut() {
    var _props3 = this.props,
        _id = _props3._id,
        onMouseOut = _props3.onMouseOut;

    onMouseOut(_id);
  },

  renderCheckbox: function renderCheckbox() {
    var _props4 = this.props,
        _id = _props4._id,
        selected = _props4.selected;

    return _react2.default.createElement(
      'label',
      { className: 'form__option form__option--custom-checkbox' },
      _react2.default.createElement('input', {
        type: 'checkbox',
        name: 'road-' + _id + '--checkbox',
        id: 'road-' + _id + '--checkbox',
        value: 'road-' + _id,
        onChange: this.toggleSelect,
        checked: selected
      }),
      _react2.default.createElement('span', { className: 'form__option__ui' }),
      _react2.default.createElement(
        'span',
        { className: 'form__option__text visually-hidden' },
        _react2.default.createElement(
          _t2.default,
          null,
          'Selected'
        )
      )
    );
  },

  renderRadio: function renderRadio() {
    var _props5 = this.props,
        _id = _props5._id,
        selected = _props5.selected;

    return _react2.default.createElement(
      'label',
      { className: 'form__option form__option--custom-radio' },
      _react2.default.createElement('input', {
        type: 'radio',
        name: 'road-group--radio',
        id: 'road-' + _id + '--radio',
        value: 'road-' + _id,
        onChange: this.toggleSelect,
        checked: selected
      }),
      _react2.default.createElement('span', { className: 'form__option__ui' }),
      _react2.default.createElement(
        'span',
        { className: 'form__option__text visually-hidden' },
        _react2.default.createElement(
          _t2.default,
          null,
          'Selected'
        )
      )
    );
  },

  render: function render() {
    var _props6 = this.props,
        vpromm = _props6.vpromm,
        language = _props6.language,
        type = _props6.type,
        isHighlighted = _props6.isHighlighted,
        province = _props6.province;


    return _react2.default.createElement(
      'li',
      { className: 'road-list__item', onMouseOver: this.handleMouseOver, onMouseOut: this.handleMouseOut },
      _react2.default.createElement(
        'article',
        { className: 'road ' + (isHighlighted ? 'road--highlight' : ''), id: 'road-{_id}' },
        _react2.default.createElement(
          'header',
          { className: 'road__header' },
          _react2.default.createElement(
            'div',
            { className: 'road__headline' },
            _react2.default.createElement(
              'h1',
              { className: 'road__title' },
              vpromm || (0, _t.translate)(language, 'No ID')
            ),
            vpromm && _react2.default.createElement(
              'p',
              { className: 'road__subtitle' },
              province.name_en
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'road__h-actions' },
            type === 'checkbox' && this.renderCheckbox(),
            type === 'radio' && this.renderRadio()
          )
        )
      )
    );
  }
});

module.exports = TaskListItem;

},{"../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js":[function(require,module,exports){
'use strict';

var _lodash = require('lodash');

/*
 * App configuration.
 *
 * Uses settings in config/production.js, with any properties set by
 * config/staging.js or config/local.js overriding them depending upon the
 * environment.
 *
 * This file should not be modified.  Instead, modify one of:
 *
 *  - config/production.js
 *      Production settings (base).
 *  - config/staging.js
 *      Overrides to production if ENV is staging.
 *  - config/local.js
 *      Overrides if local.js exists.
 *      This last file is gitignored, so you can safely change it without
 *      polluting the repo.
 */

var configurations = {'local': require('./config/local.js'),'production': require('./config/production.js'),'staging': require('./config/staging.js')};
var config = configurations.local || {};

if ("staging" === 'staging') {
  (0, _lodash.defaultsDeep)(config, configurations.staging);
}
(0, _lodash.defaultsDeep)(config, configurations.production);

module.exports = config;

},{"./config/local.js":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config/local.js","./config/production.js":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config/production.js","./config/staging.js":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config/staging.js","lodash":"lodash"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config/local.js":[function(require,module,exports){
"use strict";

module.exports = {};

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config/production.js":[function(require,module,exports){
'use strict';
/*
 * App config for production.
 */

module.exports = {
  environment: 'production',
  api: 'http://api.openroads-vn.com',
  mbToken: 'pk.eyJ1Ijoib3BlbnJvYWRzIiwiYSI6InJ0aUQ2N3MifQ.R3hdFqriZr6kEUr-j_FYpg',
  editorUrl: '//editor.openroads-vn.com',
  roadNetTileLayerUrl: 'http://api.openroads-vn.com:3000/dashboard/{z}/{x}/{y}.png',
  provinceDumpBaseUrl: 'https:/openroads-vn-dumps-prod.s3.amazonaws.com/by-province-id/'
};

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config/staging.js":[function(require,module,exports){
'use strict';
/*
 * App config overrides for staging.
 */

module.exports = {
  environment: 'staging'
};

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/constants.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var ADMIN_MAP = exports.ADMIN_MAP = {
  province: {
    '101': '',
    '103': '',
    '104': '',
    '106': '',
    '107': '',
    '109': '',
    '111': '',
    '113': { id: '67', name: 'Nam Dinh' },
    '115': '',
    '117': '',
    '201': { id: '03', name: 'Ha Giang' },
    '203': { id: '04', name: 'Cao Bang' },
    '205': { id: '02', name: 'Lao Cai' },
    '207': { id: '53', name: 'Bac Kan' },
    '209': { id: '09', name: 'Lang Son' },
    '401': { id: '21', name: 'Thanh Hoa' },
    '403': { id: '22', name: 'Nghe An' },
    '405': { id: '23', name: 'Ha Tinh' },
    '407': '',
    '409': { id: '25', name: 'Quang Tri' },
    '411': { id: '26', name: 'Thua Thien Hue' },
    '501': '',
    '503': { id: '27', name: 'Quang Nam' },
    '505': '',
    '507': { id: '31', name: 'Binh Dinh' },
    '509': '',
    '511': '',
    '601': '',
    '603': '',
    '605': '',
    '606': '',
    '607': '',
    '701': '',
    '705': '',
    '707': '',
    '709': '',
    '711': '',
    '713': '',
    '715': '',
    '717': '',
    '801': '',
    '803': '',
    '805': '',
    '807': '',
    '809': '',
    '810': '',
    '811': '',
    '813': '',
    '814': { id: '24', name: 'Quang Binh' },
    '815': '',
    '816': '',
    '817': '',
    '819': '',
    '821': '',
    '823': ''
  },
  district: {
    '40319': 'TK',
    '40305': 'QP',
    '40329': 'DL',
    '40313': 'NG',
    '40309': 'KS',
    '40331': 'TC',
    '40315': 'TD',
    '40335': 'ND',
    '40337': 'HN',
    '40317': 'QL',
    '40323': 'YT',
    '40303': 'CL',
    '40314': '',
    '40307': 'QC',
    '40325': 'DC',
    '40333': 'NL',
    '40327': 'AS',
    '40311': 'QH',
    '40321': 'CC',
    '40301': 'VI',
    '40507': 'DT',
    '40501': 'HT',
    '40515': 'CX',
    '40517': 'HK',
    '40503': 'HL',
    '40519': 'KA',
    '40512': '',
    '40513': 'TH',
    '40509': 'HS',
    '40505': 'NX',
    '40510': 'VQ',
    '40511': 'CL',
    '81410': 'DH',
    '40913': 'HL',
    '40905': 'VL',
    '40915': 'HH',
    '40917': 'DA',
    '40901': 'DH',
    '40906': 'CC',
    '40909': 'CL',
    '40903': 'QT',
    '40911': 'TP',
    '40907': 'GL',
    '41115': 'AL',
    '41105': 'QD',
    '41117': 'ND',
    '41109': 'PV',
    '41103': 'PD',
    '41101': 'HE',
    '41111': 'HU',
    '41107': 'HR',
    '41113': 'PL',
    '50315': 'TB',
    '50325': 'NT',
    '50305': 'DG',
    '50304': 'TG',
    '50319': 'HD',
    '50321': 'TP',
    '50309': 'DB',
    '50318': '',
    '50327': 'BT',
    '50311': 'DX',
    '50313': 'NG',
    '50328': 'NM',
    '50317': 'QS',
    '50329': 'PN',
    '50303': 'HA',
    '50323': 'PS',
    '50307': 'DL',
    '50301': 'TK',
    '50715': 'TS',
    '50721': 'VC',
    '50709': 'MN',
    '50711': 'VT',
    '50703': 'AL',
    '50705': 'HN',
    '50719': 'TP',
    '50707': 'HA',
    '50713': 'PC',
    '50701': 'QN',
    '50717': 'AN',
    '11309': '',
    '11305': '',
    '11315': '',
    '11307': '',
    '11319': '',
    '11303': '',
    '11301': '',
    '11311': '',
    '11313': '',
    '20513': 'SP',
    '20509': 'BH',
    '20508': 'SM',
    '20519': 'VB',
    '20507': 'BX',
    '20501': 'LC',
    '20505': 'MK',
    '20511': 'BT',
    '20111': 'BM',
    '20105': 'MV',
    '20107': 'YM',
    '20103': 'DV',
    '20120': 'QG',
    '20101': 'HG',
    '20109': 'QB',
    '20119': 'BQ',
    '20115': 'VX',
    '20117': 'XM',
    '20113': 'HS',
    '20303': 'BC',
    '20321': 'TA',
    '20311': 'TK',
    '20307': 'TN',
    '20301': 'CB',
    '20318': 'PH',
    '20304': 'BM',
    '20317': 'QY',
    '20315': 'HA',
    '20309': 'TL',
    '20319': 'HL',
    '20313': 'NB',
    '20305': 'HQ',
    '20911': 'VQ',
    '20905': 'VL',
    '20917': 'CH',
    '20909': 'BS',
    '20915': 'LB',
    '20901': 'LS',
    '20921': 'HL',
    '20903': 'TD',
    '20907': 'BG',
    '20919': 'DL',
    '20913': 'CA',
    '10133': '',
    '10145': '',
    '10125': '',
    '10115': '',
    '10135': '',
    '10111': '',
    '10131': '',
    '10149': '',
    '10151': '',
    '10109': '',
    '10123': '',
    '10141': '',
    '10108': '',
    '10119': '',
    '10139': '',
    '10103': '',
    '10113': '',
    '10129': '',
    '10153': '',
    '10105': '',
    '10121': '',
    '10147': '',
    '10101': '',
    '10137': '',
    '10117': '',
    '10107': '',
    '10114': '',
    '10127': '',
    '10143': '',
    '10310': '',
    '10323': '',
    '10321': '',
    '10307': '',
    '10315': '',
    '10325': '',
    '10317': '',
    '10305': '',
    '10311': '',
    '10313': '',
    '10309': '',
    '10303': '',
    '10301': '',
    '10314': '',
    '10319': '',
    '10407': '',
    '10401': '',
    '10403': '',
    '10406': '',
    '10402': '',
    '10405': '',
    '10404': '',
    '10409': '',
    '10601': '',
    '10611': '',
    '10612': '',
    '10607': '',
    '10608': '',
    '10609': '',
    '10605': '',
    '10603': '',
    '10723': '',
    '10711': '',
    '10705': '',
    '10713': '',
    '10721': '',
    '10703': '',
    '10717': '',
    '10715': '',
    '10719': '',
    '10701': '',
    '10709': '',
    '10707': '',
    '10907': '',
    '10911': '',
    '10904': '',
    '10902': '',
    '10913': '',
    '10901': '',
    '10905': '',
    '10906': '',
    '10903': '',
    '10909': '',
    '11107': '',
    '11111': '',
    '11103': '',
    '11109': '',
    '11105': '',
    '11101': '',
    '11505': 'HH',
    '11515': 'TH',
    '11501': 'TB',
    '11513': 'KX',
    '11509': 'NH',
    '11503': 'QP',
    '11511': 'VT',
    '11507': 'TT',
    '11701': 'NB',
    '11705': 'NQ',
    '11711': 'YM',
    '11703': 'TD',
    '11709': 'HL',
    '11713': 'TK',
    '11707': 'GV',
    '20515': 'BY',
    '20709': '',
    '20704': '',
    '20711': '',
    '20712': '',
    '20703': '',
    '20705': '',
    '20707': '',
    '20701': '',
    '21107': 'HY',
    '21105': 'CH',
    '21111': 'SD',
    '21101': 'TQ',
    '21109': 'YS',
    '21103': 'NH',
    '21309': 'MC',
    '21315': 'VC',
    '21301': 'YB',
    '21313': '',
    '21317': 'TT',
    '21311': 'TY',
    '21307': 'VC',
    '21303': 'NL',
    '21305': 'LC',
    '21511': '',
    '21513': '',
    '21501': '',
    '21509': '',
    '21503': '',
    '21515': '',
    '21517': '',
    '21507': '',
    '21505': '',
    '21703': '',
    '21719': '',
    '21707': '',
    '21709': '',
    '21718': '',
    '21715': '',
    '21701': '',
    '21720': '',
    '21712': '',
    '21717': '',
    '21713': '',
    '21711': '',
    '21705': '',
    '22109': '',
    '22119': '',
    '22103': '',
    '22113': '',
    '22105': '',
    '22111': '',
    '22117': '',
    '22115': '',
    '22107': '',
    '22101': '',
    '22521': 'DT',
    '22512': 'DH',
    '22513': 'TY',
    '22503': 'CP',
    '22517': 'VP',
    '22507': 'BL',
    '22515': 'BC',
    '22505': 'UB',
    '22525': 'YH',
    '22511': 'HH',
    '22501': 'HL',
    '22519': 'HB',
    '22523': 'CT',
    '22506': 'MC',
    '30117': 'TU',
    '30107': 'PT',
    '30105': 'MT',
    '30109': 'SH',
    '30108': 'TD',
    '30103': 'LC',
    '30211': '',
    '30201': '',
    '30219': '',
    '30203': '',
    '30216': '',
    '30217': '',
    '30215': '',
    '30204': '',
    '30213': '',
    '30315': 'SM',
    '30309': 'BY',
    '30307': 'TC',
    '30303': 'QN',
    '30319': 'MC',
    '30305': 'ML',
    '30301': 'SL',
    '30317': 'YC',
    '30313': 'MS',
    '30316': 'SC',
    '30311': 'PY',
    '30507': 'KS',
    '30510': 'CP',
    '30501': 'HB',
    '30515': 'LC',
    '30513': 'TL',
    '30509': 'LG',
    '30503': 'DR',
    '30517': 'LT',
    '30511': 'KB',
    '30519': 'YT',
    '30505': 'MC',
    '40143': 'HH',
    '40147': 'TS',
    '40107': 'ML',
    '40137': 'TX',
    '40111': 'QS',
    '40145': 'DS',
    '40123': 'TN',
    '40101': 'TH',
    '40125': 'NX',
    '40149': 'QX',
    '40135': 'YD',
    '40151': 'NC',
    '40131': 'HT',
    '40129': 'VL',
    '40153': 'TG',
    '40121': 'NL',
    '40119': 'TT',
    '40141': 'TU',
    '40139': 'HL',
    '40103': 'BS',
    '40133': 'NS',
    '40115': 'CT',
    '40127': 'NT',
    '40105': 'SS',
    '40109': 'QH',
    '40117': 'LC',
    '40113': 'BT',
    '40703': 'TH',
    '40707': 'QT',
    '40713': 'LT',
    '40709': 'BT',
    '40705': 'MH',
    '40701': 'DH',
    '40711': 'QN',
    '50109': '',
    '50112': '',
    '50103': '',
    '50105': '',
    '50111': '',
    '50107': '',
    '50101': '',
    '50501': 'QN',
    '50517': 'NH',
    '50519': 'ML',
    '50509': 'SN',
    '50525': 'BT',
    '50511': 'SY',
    '50513': 'SH',
    '50505': 'BS',
    '50503': 'LS',
    '50523': 'DP',
    '50508': 'TT',
    '50507': 'TB',
    '50521': 'MD',
    '50515': 'TN',
    '50912': 'SH',
    '50910': 'PH',
    '50905': 'SC',
    '50901': 'TH',
    '50903': 'DX',
    '50907': 'TA',
    '50909': 'SO',
    '50911': 'TH',
    '50913': 'SH',
    '51108': '',
    '51103': 'VN',
    '51107': 'DK',
    '51113': 'KS',
    '51105': 'NH',
    '51102': 'CR',
    '51101': 'NT',
    '51111': 'KV',
    '60114': '',
    '60107': 'DT',
    '60111': 'DH',
    '60113': 'ST',
    '60103': 'DG',
    '60109': 'KP',
    '60108': 'KR',
    '60101': 'KT',
    '60105': 'NH',
    '60307': 'CH',
    '60303': 'KB',
    '60315': 'DC',
    '60322': 'IP',
    '60317': 'CG',
    '60319': 'CS',
    '60321': 'AP',
    '60313': 'KC',
    '60309': 'IG',
    '60306': 'MY',
    '60311': 'AK',
    '60324': '',
    '60301': 'PL',
    '60305': 'DD',
    '60323': 'KP',
    '60312': 'DP',
    '60513': 'BD',
    '60507': 'KN',
    '60525': 'KB',
    '60517': 'MD',
    '60531': 'LA',
    '60523': 'KA',
    '60503': 'EH',
    '60511': 'BD',
    '60509': 'KK',
    '60515': 'EK',
    '60501': 'BM',
    '60519': 'KP',
    '60524': '',
    '60505': 'ES',
    '60629': '',
    '60621': '',
    '60633': '',
    '60632': '',
    '60627': '',
    '60611': '',
    '60634': '',
    '60635': '',
    '60709': '',
    '60713': '',
    '60715': '',
    '60707': '',
    '60719': '',
    '60701': '',
    '60711': '',
    '60705': '',
    '60717': '',
    '60723': '',
    '60703': '',
    '60721': '',
    '70140': '',
    '70119': '',
    '70139': '',
    '70121': '',
    '70101': '',
    '70137': '',
    '70123': '',
    '70135': '',
    '70111': '',
    '70131': '',
    '70105': '',
    '70107': '',
    '70109': '',
    '70129': '',
    '70128': '',
    '70103': '',
    '70113': '',
    '70115': '',
    '70133': '',
    '70117': '',
    '70125': '',
    '70141': '',
    '70127': '',
    '70143': '',
    '70506': '',
    '70501': '',
    '70504': '',
    '70505': '',
    '70503': '',
    '70507': '',
    '70709': '',
    '70708': '',
    '70702': '',
    '70705': '',
    '70703': '',
    '70706': '',
    '70701': '',
    '70707': '',
    '70917': '',
    '70905': '',
    '70903': '',
    '70913': '',
    '70901': '',
    '70911': '',
    '70907': '',
    '70909': '',
    '70915': '',
    '71103': '',
    '71108': '',
    '71102': '',
    '71105': '',
    '71104': '',
    '71101': '',
    '71107': '',
    '71309': '',
    '71310': '',
    '71311': '',
    '71313': '',
    '71305': '',
    '71317': '',
    '71315': '',
    '71307': '',
    '71301': '',
    '71312': '',
    '71303': '',
    '71511': '',
    '71509': '',
    '71507': '',
    '71505': '',
    '71501': '',
    '71513': '',
    '71515': '',
    '71503': '',
    '71502': '',
    '71517': '',
    '71711': '',
    '71705': '',
    '71709': '',
    '71714': '',
    '71703': '',
    '71701': '',
    '71712': '',
    '71707': '',
    '80115': '',
    '80101': '',
    '80127': '',
    '80117': '',
    '80109': '',
    '80107': '',
    '80111': '',
    '80123': '',
    '80105': '',
    '80113': '',
    '80125': '',
    '80103': '',
    '80121': '',
    '80119': '',
    '80313': '',
    '80321': '',
    '80307': '',
    '80317': '',
    '80301': '',
    '80305': '',
    '80319': '',
    '80315': '',
    '80303': '',
    '80309': '',
    '80311': '',
    '80515': '',
    '80517': '',
    '80503': '',
    '80501': '',
    '80511': '',
    '80519': '',
    '80521': '',
    '80509': '',
    '80513': '',
    '80505': '',
    '80507': '',
    '80717': '',
    '80701': '',
    '80707': '',
    '80715': '',
    '80703': '',
    '80711': '',
    '80705': '',
    '80709': '',
    '80713': '',
    '80718': '',
    '80909': '',
    '80911': '',
    '80913': '',
    '80903': '',
    '80908': '',
    '80901': '',
    '80905': '',
    '80907': '',
    '81014': 'DT',
    '81105': '',
    '81115': '',
    '81103': '',
    '81113': '',
    '81101': '',
    '81109': '',
    '81111': '',
    '81107': '',
    '81313': '',
    '81311': '',
    '81303': '',
    '81321': '',
    '81304': '',
    '81309': '',
    '81323': '',
    '81305': '',
    '81319': '',
    '81301': '',
    '81317': '',
    '81307': '',
    '81315': '',
    '81325': '',
    '81509': '',
    '81515': '',
    '81511': '',
    '81507': '',
    '81503': '',
    '81501': '',
    '81513': '',
    '81505': '',
    '81603': '',
    '81611': '',
    '81601': '',
    '81602': '',
    '81609': '',
    '81607': '',
    '81605': '',
    '81713': '',
    '81703': '',
    '81715': '',
    '81705': '',
    '81711': '',
    '81709': '',
    '81701': '',
    '81707': '',
    '81907': '',
    '81911': '',
    '81903': '',
    '81901': '',
    '81909': '',
    '81905': '',
    '81912': '',
    '81906': '',
    '81913': '',
    '82109': '',
    '82103': '',
    '82106': '',
    '82105': '',
    '82104': '',
    '82107': '',
    '82101': '',
    '82309': '',
    '82314': '',
    '82305': '',
    '82310': '',
    '82313': '',
    '82311': '',
    '82301': '',
    '82307': '',
    '82303': ''
  }
};

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/containers/province-table-container.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _provinceTable = require('../components/province-table');

var _provinceTable2 = _interopRequireDefault(_provinceTable);

var _constants = require('../constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ProvinceTableContainer = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), (0, _recompose.withStateHandlers)({ sortField: 'name', sortOrder: 'asc' }, {
  sortHandler: function sortHandler(_ref) {
    var sortField = _ref.sortField,
        sortOrder = _ref.sortOrder;
    return function (field) {
      return sortField === field ? { sortOrder: sortOrder === 'asc' ? 'desc' : 'asc' } : { sortField: field, sortOrder: 'asc' };
    };
  }
}), (0, _recompose.withProps)(function (_ref2) {
  var provinces = _ref2.provinces,
      provincesRoadCount = _ref2.provincesRoadCount;
  return {
    provinces: provinces.map(function (province) {
      var _ADMIN_MAP$province$p = _constants.ADMIN_MAP.province[province.id],
          id = _ADMIN_MAP$province$p.id,
          name = _ADMIN_MAP$province$p.name;
      var _provincesRoadCount$i = provincesRoadCount[id],
          count = _provincesRoadCount$i.count,
          osmCount = _provincesRoadCount$i.osmCount;


      return {
        name: name,
        id: id,
        routeId: province.id,
        osmCount: osmCount,
        count: count,
        percentageComplete: count > 0 ? osmCount / count * 100 : 0
      };
    })
  };
}))(_provinceTable2.default);

exports.default = ProvinceTableContainer;

},{"../components/province-table":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/province-table.js","../constants":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/constants.js","react":"react","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/containers/road-table-container.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRouter = require('react-router');

var _recompose = require('recompose');

var _lodash = require('lodash');

var _reduxFractal = require('redux-fractal');

var _redux = require('redux');

var _reactRedux = require('react-redux');

var _roadTable = require('../components/road-table');

var _roadTable2 = _interopRequireDefault(_roadTable);

var _roads = require('../redux/modules/roads');

var _roadCount = require('../redux/modules/roadCount');

var _constants = require('../constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var reducer = function reducer() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
    sortOrder: 'asc',
    sortField: 'id',
    page: 1
  };
  var action = arguments[1];

  if (action.type === 'SORT_COLUMN') {
    return Object.assign({}, state, {
      sortOrder: action.sortOrder,
      sortField: action.sortField
    });
  } else if (action.type === 'SET_PAGE') {
    return Object.assign({}, state, {
      page: action.page
    });
  }

  return state;
};

var fetchData = function fetchData(_ref) {
  var roadsPage = _ref.roadsPage,
      roadsPageStatus = _ref.roadsPageStatus,
      roadPageCount = _ref.roadPageCount,
      roadCountStatus = _ref.roadCountStatus,
      province = _ref.province,
      district = _ref.district,
      page = _ref.page,
      sortField = _ref.sortField,
      sortOrder = _ref.sortOrder,
      fetchRoads = _ref.fetchRoads,
      fetchRoadCount = _ref.fetchRoadCount;

  if (!roadsPage && roadsPageStatus !== 'pending' && roadsPageStatus !== 'error') {
    fetchRoads(province, district, page, sortField, sortOrder);
  }

  if (!roadPageCount && roadCountStatus !== 'pending' && roadCountStatus !== 'error') {
    fetchRoadCount(province, district);
  }
};

var RoadTableContainer = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), _reactRouter.withRouter, (0, _reduxFractal.local)({
  key: function key(_ref2) {
    var _ref2$router$params = _ref2.router.params,
        _ref2$router$params$a = _ref2$router$params.aaId,
        aaId = _ref2$router$params$a === undefined ? '' : _ref2$router$params$a,
        _ref2$router$params$a2 = _ref2$router$params.aaIdSub,
        aaIdSub = _ref2$router$params$a2 === undefined ? '' : _ref2$router$params$a2;
    return 'road-table-' + aaId + '-' + aaIdSub;
  },
  createStore: function createStore() {
    return (0, _redux.createStore)(reducer);
  },
  mapDispatchToProps: function mapDispatchToProps(dispatch, _ref3) {
    var sortOrder = _ref3.sortOrder;
    return {
      sortColumn: function sortColumn(sortField, sortOrder) {
        return dispatch({ type: 'SORT_COLUMN', sortField: sortField, sortOrder: sortOrder });
      },
      setPage: function setPage(page) {
        return dispatch({ type: 'SET_PAGE', page: page });
      }
    };
  },
  filterGlobalActions: function filterGlobalActions(_ref4) {
    var type = _ref4.type;
    return false;
  }
}), (0, _recompose.withProps)(function (_ref5) {
  var _ref5$router$params = _ref5.router.params,
      aaId = _ref5$router$params.aaId,
      aaIdSub = _ref5$router$params.aaIdSub;
  return {
    province: _constants.ADMIN_MAP.province[aaId] && _constants.ADMIN_MAP.province[aaId].id,
    district: _constants.ADMIN_MAP.district[aaIdSub]
  };
}), (0, _reactRedux.connect)(function (state, _ref6) {
  var province = _ref6.province,
      district = _ref6.district,
      page = _ref6.page,
      sortField = _ref6.sortField,
      sortOrder = _ref6.sortOrder;

  var roadPageKey = (0, _roads.getRoadPageKey)(province, district, page, sortField, sortOrder);
  var roadsPage = state.roads.roadsByPage[roadPageKey] && state.roads.roadsByPage[roadPageKey].roads;
  var roadsPageStatus = state.roads.roadsByPage[roadPageKey] && state.roads.roadsByPage[roadPageKey].status;

  var roadCount = void 0;
  var roadOsmCount = void 0;
  var roadCountStatus = void 0;

  if (district) {
    var roadCountKey = (0, _roadCount.getRoadCountKey)(province, district);

    roadCount = (0, _lodash.at)(state, ['roadCount.districts.' + roadCountKey + '.count'])[0];
    roadOsmCount = (0, _lodash.at)(state, ['roadCount.districts.' + roadCountKey + '.osmCount'])[0];
    roadCountStatus = state.roadCount.districts[roadCountKey] && state.roadCount.districts[roadCountKey].status;
  } else {
    roadCount = (0, _lodash.at)(state, 'roadCount.provinces.provinceCount.' + province + '.count')[0];
    roadOsmCount = (0, _lodash.at)(state, 'roadCount.provinces.provinceCount.' + province + '.osmCount')[0];
    roadCountStatus = state.roadCount.provinces.status;
  }

  return {
    roadsPage: roadsPage,
    roadsPageStatus: roadsPageStatus,
    roadCount: roadCount,
    roadPageCount: Math.ceil(roadCount / 20),
    roadOsmCount: roadOsmCount,
    roadCountStatus: roadCountStatus
  };
}, function (dispatch) {
  return {
    fetchRoads: function fetchRoads(province, district, page, sortField, sortOrder) {
      return dispatch((0, _roads.fetchRoadsEpic)(province, district, page, sortField, sortOrder));
    },
    fetchRoadCount: function fetchRoadCount(province, district) {
      return district ? dispatch((0, _roadCount.fetchDistrictRoadCountEpic)(province, district)) : dispatch((0, _roadCount.fetchProvincesRoadCountEpic)());
    }
  };
}), (0, _recompose.withHandlers)({
  sortColumnAction: function sortColumnAction(_ref7) {
    var sortField = _ref7.sortField,
        sortOrder = _ref7.sortOrder,
        sortColumn = _ref7.sortColumn;
    return function (fieldId) {
      if (sortField === fieldId) {
        sortColumn(fieldId, sortOrder === 'asc' ? 'desc' : 'asc');
      } else {
        sortColumn(fieldId, 'asc');
      }
    };
  }
}), (0, _recompose.lifecycle)({
  componentWillMount: function componentWillMount() {
    fetchData(this.props);
  },
  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    fetchData(nextProps);
  }
}))(_roadTable2.default);

exports.default = RoadTableContainer;

},{"../components/road-table":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/road-table.js","../constants":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/constants.js","../redux/modules/roadCount":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roadCount.js","../redux/modules/roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js","lodash":"lodash","react":"react","react-redux":"react-redux","react-router":"react-router","recompose":"recompose","redux":"redux","redux-fractal":"redux-fractal"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/containers/road-table-row-container.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _reactRouter = require('react-router');

var _reactRedux = require('react-redux');

var _reduxFractal = require('redux-fractal');

var _redux = require('redux');

var _roadTableRow = require('../components/road-table-row');

var _roadTableRow2 = _interopRequireDefault(_roadTableRow);

var _roads = require('../redux/modules/roads');

var _constants = require('../constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var reducerFactory = function reducerFactory(_ref) {
  var vpromm = _ref.vpromm;
  return function () {
    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
      viewState: 'read',
      newRoadId: '',
      shouldShowProperties: false,
      formIsInvalid: false,
      status: 'complete',
      error: false,
      vpromm: vpromm
    };
    var action = arguments[1];

    if (action.type === 'SHOW_READ_VIEW') {
      return Object.assign({}, state, {
        viewState: 'read',
        newRoadId: '',
        formIsInvalid: false,
        status: 'complete',
        error: false
      });
    } else if (action.type === 'SHOW_EDIT_VIEW') {
      return Object.assign({}, state, {
        viewState: 'edit'
      });
    } else if (action.type === 'SHOW_DELETE_VIEW') {
      return Object.assign({}, state, {
        viewState: 'delete'
      });
    } else if (action.type === 'SHOW_PROPERTIES') {
      return Object.assign({}, state, {
        shouldShowProperties: true
      });
    } else if (action.type === 'HIDE_PROPERTIES') {
      return Object.assign({}, state, {
        shouldShowProperties: false
      });
    } else if (action.type === 'UPDATE_NEW_ROAD_ID') {
      return Object.assign({}, state, {
        newRoadId: action.id,
        formIsInvalid: false,
        status: 'complete',
        error: false
      });
    } else if (action.type === 'FORM_IS_INVALID') {
      return Object.assign({}, state, {
        formIsInvalid: true
      });
    } else if (action.type === _roads.EDIT_ROAD && action.id === state.vpromm) {
      return Object.assign({}, state, {
        status: 'pending',
        formIsInvalid: false
      });
    } else if (action.type === _roads.EDIT_ROAD_SUCCESS && action.id === state.vpromm) {
      return Object.assign({}, state, {
        status: 'complete',
        newRoadId: ''
      });
    } else if (action.type === _roads.EDIT_ROAD_ERROR && action.id === state.vpromm) {
      return Object.assign({}, state, {
        status: 'error',
        error: action.error
      });
    } else if (action.type === _roads.DELETE_ROAD && action.id === state.vpromm) {
      return Object.assign({}, state, {
        status: 'pending',
        formIsInvalid: false
      });
    } else if (action.type === _roads.DELETE_ROAD_SUCCESS && action.id === state.vpromm) {
      return Object.assign({}, state, {
        status: 'complete'
      });
    } else if (action.type === _roads.DELETE_ROAD_ERROR && action.id === state.vpromm) {
      return Object.assign({}, state, {
        status: 'error',
        error: action.error
      });
    }

    return state;
  };
};

var TableRowContainer = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), _reactRouter.withRouter, (0, _reduxFractal.local)({
  key: function key(_ref2) {
    var vpromm = _ref2.vpromm;
    return vpromm + '-table-row';
  },
  createStore: function createStore(props) {
    return (0, _redux.createStore)(reducerFactory(props));
  },
  mapDispatchToProps: function mapDispatchToProps(dispatch, _ref3) {
    var vpromm = _ref3.vpromm;
    return {
      showProperties: function showProperties() {
        return dispatch({ type: 'SHOW_PROPERTIES' });
      },
      hideProperties: function hideProperties() {
        return dispatch({ type: 'HIDE_PROPERTIES' });
      },
      showReadView: function showReadView(e) {
        e.preventDefault();
        dispatch({ type: 'SHOW_READ_VIEW' });
      },
      showEditView: function showEditView(e) {
        e.preventDefault();
        dispatch({ type: 'SHOW_EDIT_VIEW' });
      },
      showDeleteView: function showDeleteView(e) {
        e.preventDefault();
        dispatch({ type: 'SHOW_DELETE_VIEW' });
      },
      updateNewRoadId: function updateNewRoadId(_ref4) {
        var id = _ref4.target.value;
        return dispatch({ type: 'UPDATE_NEW_ROAD_ID', id: id });
      },
      invalidateForm: function invalidateForm() {
        return dispatch({ type: 'FORM_IS_INVALID' });
      },
      confirmDelete: function confirmDelete() {
        return dispatch((0, _roads.deleteRoadEpic)(vpromm));
      },
      submitEdit: function submitEdit(newRoadId) {
        return dispatch((0, _roads.editRoadEpic)(vpromm, newRoadId));
      }
    };
  },
  filterGlobalActions: function filterGlobalActions(_ref5) {
    var type = _ref5.type;
    return [_roads.EDIT_ROAD, _roads.EDIT_ROAD_SUCCESS, _roads.EDIT_ROAD_ERROR, _roads.DELETE_ROAD, _roads.DELETE_ROAD_SUCCESS, _roads.DELETE_ROAD_ERROR].indexOf(type) > -1;
  }
}), (0, _recompose.withProps)(function (_ref6) {
  var _ref6$router$params = _ref6.router.params,
      aaId = _ref6$router$params.aaId,
      aaIdSub = _ref6$router$params.aaIdSub;
  return {
    province: _constants.ADMIN_MAP.province[aaId] && _constants.ADMIN_MAP.province[aaId].id,
    district: _constants.ADMIN_MAP.district[aaIdSub]
  };
}), (0, _reactRedux.connect)(function (state, _ref7) {
  var vpromm = _ref7.vpromm;
  return {
    road: state.roads.roadsById[vpromm]
  };
}),
/**
 * If road does not exist in the redux store, something went wrong in the fetching/deserialization
 * of the roads redux subtree.
 * see redux/modules/roads.js#fetchRoadsEpic
 */
(0, _recompose.branch)(function (_ref8) {
  var road = _ref8.road;
  return !road;
}, (0, _recompose.renderComponent)(_roadTableRow.TableErrorRow)), (0, _recompose.withProps)(function (_ref9) {
  var road = _ref9.road;
  return {
    properties: road.properties,
    hasOSMData: road.hasOSMData
  };
}), (0, _recompose.withHandlers)({
  toggleProperties: function toggleProperties(_ref10) {
    var shouldShowProperties = _ref10.shouldShowProperties,
        showProperties = _ref10.showProperties,
        hideProperties = _ref10.hideProperties;
    return function () {
      return shouldShowProperties ? hideProperties() : showProperties();
    };
  },
  confirmEdit: function confirmEdit(_ref11) {
    var newRoadId = _ref11.newRoadId,
        province = _ref11.province,
        district = _ref11.district,
        submitEdit = _ref11.submitEdit,
        invalidateForm = _ref11.invalidateForm;
    return function (e) {
      e.preventDefault();
      // TODO - expose validation error messages
      if (!(0, _roads.roadIdIsValid)(newRoadId, province, district)) {
        return invalidateForm();
      }

      submitEdit(newRoadId);
    };
  }
}))(_roadTableRow2.default);

exports.default = TableRowContainer;

},{"../components/road-table-row":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/road-table-row.js","../constants":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/constants.js","../redux/modules/roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js","react":"react","react-redux":"react-redux","react-router":"react-router","recompose":"recompose","redux":"redux","redux-fractal":"redux-fractal"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/main.js":[function(require,module,exports){
'use strict';

require('babel-polyfill');

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactDom = require('react-dom');

var _reactRedux = require('react-redux');

var _reactRouter = require('react-router');

var _store = require('./redux/store');

var _store2 = _interopRequireDefault(_store);

var _uhoh = require('./views/uhoh');

var _uhoh2 = _interopRequireDefault(_uhoh);

var _app = require('./views/app');

var _app2 = _interopRequireDefault(_app);

var _home = require('./views/home');

var _home2 = _interopRequireDefault(_home);

var _editor = require('./views/editor');

var _editor2 = _interopRequireDefault(_editor);

var _tasks = require('./views/tasks');

var _tasks2 = _interopRequireDefault(_tasks);

var _explore = require('./views/explore');

var _explore2 = _interopRequireDefault(_explore);

var _assets = require('./views/assets');

var _assets2 = _interopRequireDefault(_assets);

var _assetsIndex = require('./views/assets-index');

var _assetsIndex2 = _interopRequireDefault(_assetsIndex);

var _assetsAdminArea = require('./views/assets-admin-area');

var _assetsAdminArea2 = _interopRequireDefault(_assetsAdminArea);

var _assetsDetail = require('./views/assets-detail');

var _assetsDetail2 = _interopRequireDefault(_assetsDetail);

var _upload = require('./views/upload');

var _upload2 = _interopRequireDefault(_upload);

var _faq = require('./views/faq');

var _faq2 = _interopRequireDefault(_faq);

var _demo = require('./views/demo');

var _demo2 = _interopRequireDefault(_demo);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var validateLanguage = function validateLanguage(_ref, replace) {
  var lang = _ref.params.lang;

  if (lang !== 'en' && lang !== 'vi') {
    replace('/en/404');
  }
};

(0, _reactDom.render)(_react2.default.createElement(
  _reactRedux.Provider,
  { store: _store2.default },
  _react2.default.createElement(
    _reactRouter.Router,
    { history: _reactRouter.hashHistory },
    _react2.default.createElement(_reactRouter.Redirect, { from: '/', to: '/en' }),
    _react2.default.createElement(
      _reactRouter.Route,
      { path: '/:lang', component: _app2.default, onEnter: validateLanguage },
      _react2.default.createElement(_reactRouter.Route, { path: 'tasks', component: _tasks2.default, pageClass: 'tasks' }),
      _react2.default.createElement(_reactRouter.Route, { path: 'upload', component: _upload2.default, pageClass: 'upload' }),
      _react2.default.createElement(_reactRouter.Route, { path: 'editor', component: _editor2.default, pageClass: 'editor' }),
      _react2.default.createElement(_reactRouter.Route, { path: 'editor/*', component: _editor2.default, pageClass: 'editor' }),
      _react2.default.createElement(_reactRouter.Route, { path: 'explore', component: _explore2.default, pageClass: 'explore' }),
      _react2.default.createElement(_reactRouter.Route, { path: 'faq', component: _faq2.default, pageClass: 'faq' }),
      _react2.default.createElement(_reactRouter.Route, { path: 'demo', component: _demo2.default, pageClass: 'demo' }),
      _react2.default.createElement(
        _reactRouter.Route,
        { path: 'assets', component: _assets2.default },
        _react2.default.createElement(_reactRouter.IndexRoute, { component: _assetsIndex2.default, pageClass: 'assets' }),
        _react2.default.createElement(_reactRouter.Route, { path: 'road/:vpromm', component: _assetsDetail2.default, pageClass: 'assets-inner-canvas' }),
        _react2.default.createElement(_reactRouter.Route, { path: ':aaId', component: _assetsAdminArea2.default, pageClass: 'assets-inner-canvas' }),
        _react2.default.createElement(_reactRouter.Route, { path: ':aaId/:aaIdSub', component: _assetsAdminArea2.default, pageClass: 'assets-inner-canvas' })
      ),
      _react2.default.createElement(_reactRouter.IndexRoute, { component: _home2.default, pageClass: 'page--landing' }),
      _react2.default.createElement(_reactRouter.Route, { path: '*', component: _uhoh2.default })
    )
  )
), document.querySelector('.site-canvas'));

},{"./redux/store":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/store.js","./views/app":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/app.js","./views/assets":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/assets.js","./views/assets-admin-area":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/assets-admin-area.js","./views/assets-detail":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/assets-detail.js","./views/assets-index":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/assets-index.js","./views/demo":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/demo.js","./views/editor":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/editor.js","./views/explore":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/explore.js","./views/faq":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/faq.js","./views/home":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/home.js","./views/tasks":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/tasks.js","./views/uhoh":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/uhoh.js","./views/upload":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/upload.js","babel-polyfill":"babel-polyfill","react":"react","react-dom":"react-dom","react-redux":"react-redux","react-router":"react-router"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/map.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.setMapPosition = exports.SET_MAP_POSITION = undefined;

var _actionTypes = require('../../actions/action-types');

var _zoom2 = require('../../utils/zoom');

var _roads = require('./roads');

/**
 * constants
 */
var SET_MAP_POSITION = exports.SET_MAP_POSITION = 'SET_MAP_POSITION';

/**
 * actions
 */
var setMapPosition = exports.setMapPosition = function setMapPosition(lng, lat, zoom, waySlug) {
  return { type: SET_MAP_POSITION, lng: lng, lat: lat, zoom: zoom, waySlug: waySlug };
};

/**
 * reducer
 */

exports.default = function () {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
    waySlug: null,
    lat: 20.029,
    lng: 105.73,
    zoom: 6
  };
  var action = arguments[1];

  if (action.type === SET_MAP_POSITION) {
    return Object.assign({}, state, {
      lat: action.lat,
      lng: action.lng,
      zoom: action.zoom,
      way: action.waySlug
    });
  } else if (action.type === _actionTypes.RECEIVE_ADMIN_BBOX) {
    var _bboxToLngLatZoom = (0, _zoom2.bboxToLngLatZoom)(action.json.bbox),
        lng = _bboxToLngLatZoom.lng,
        lat = _bboxToLngLatZoom.lat,
        zoom = _bboxToLngLatZoom.zoom;

    return Object.assign({}, state, {
      lng: lng,
      lat: lat,
      zoom: zoom
    });
  } else if (action.type === _roads.FETCH_ROAD_BBOX_SUCCESS) {
    var _bboxToLngLatZoom2 = (0, _zoom2.bboxToLngLatZoom)(action.bbox),
        _lng = _bboxToLngLatZoom2.lng,
        _lat = _bboxToLngLatZoom2.lat,
        _zoom = _bboxToLngLatZoom2.zoom;

    return Object.assign({}, state, {
      lng: _lng,
      lat: _lat,
      zoom: _zoom
    });
  } else if (action.type === _roads.FETCH_ROAD_PROPERTY_SUCCESS) {
    var waySlug = 'w' + action.properties.way_id;

    return Object.assign({}, state, { waySlug: waySlug });
  }

  return state;
};

},{"../../actions/action-types":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-types.js","../../utils/zoom":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/utils/zoom.js","./roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/osm.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.deleteEntireWaysEpic = exports.queryOsmEpic = exports.requestOsmChangeError = exports.requestOsmChangeSuccess = exports.requestOsmChange = exports.REQUEST_OSM_CHANGE_ERROR = exports.REQUEST_OSM_CHANGE_SUCCESS = exports.REQUEST_OSM_CHANGE = undefined;

var _xmlReader = require('xml-reader');

var _xmlReader2 = _interopRequireDefault(_xmlReader);

var _tasks = require('./tasks');

var _config = require('../../config');

var _config2 = _interopRequireDefault(_config);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Utils
 */
var objectToBlob = function objectToBlob(obj) {
  return new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
};

var createChangesetRequest = function createChangesetRequest(taskId, payload) {
  return fetch(_config2.default.api + '/changeset/create', {
    method: 'PUT',
    body: objectToBlob({ uid: 555555, user: 'Openroads Tasks' })
  }).then(function (response) {
    if (response.status >= 400) {
      throw new Error(response.textStatus);
    }
    return response.text();
  });
};

var uploadChangesetRequest = function uploadChangesetRequest(changesetId, taskId, payload) {
  return fetch(_config2.default.api + '/changeset/' + changesetId + '/upload', {
    method: 'POST',
    body: objectToBlob({ osmChange: payload })
  }).then(function (response) {
    if (response.status >= 400) {
      throw new Error(response.textStatus);
    }
  });
};

/**
 * constants
 */
var REQUEST_OSM_CHANGE = exports.REQUEST_OSM_CHANGE = 'REQUEST_OSM_CHANGE';
var REQUEST_OSM_CHANGE_SUCCESS = exports.REQUEST_OSM_CHANGE_SUCCESS = 'REQUEST_OSM_CHANGE_SUCCESS';
var REQUEST_OSM_CHANGE_ERROR = exports.REQUEST_OSM_CHANGE_ERROR = 'REQUEST_OSM_CHANGE_ERROR';

/**
 * action creators
 */
var requestOsmChange = exports.requestOsmChange = function requestOsmChange(taskId) {
  return { type: REQUEST_OSM_CHANGE, taskId: taskId };
};
var requestOsmChangeSuccess = exports.requestOsmChangeSuccess = function requestOsmChangeSuccess(taskId) {
  return { type: REQUEST_OSM_CHANGE_SUCCESS, taskId: taskId };
};
var requestOsmChangeError = exports.requestOsmChangeError = function requestOsmChangeError(taskId) {
  return { type: REQUEST_OSM_CHANGE_ERROR, taskId: taskId };
};

var queryOsmEpic = exports.queryOsmEpic = function queryOsmEpic(taskId, payload) {
  return function (dispatch) {
    dispatch(requestOsmChange(taskId));

    createChangesetRequest(taskId, payload).then(function (changesetId) {
      return uploadChangesetRequest(changesetId, taskId, payload);
    }).then(function () {
      dispatch((0, _tasks.fetchWayTaskEpic)(taskId));
      dispatch(requestOsmChangeSuccess(taskId));
    }).catch(function (e) {
      console.error('Error querying Osm', e);
      dispatch(requestOsmChangeError(taskId));
    });
  };
};

// Since the geojson that powers the tasks endpoint doesn't include node IDs,
// we must query the XML endpoint to get these IDs, then format them into
// a `delete` action.
var deleteEntireWaysEpic = exports.deleteEntireWaysEpic = function deleteEntireWaysEpic(taskId, wayIds) {
  return function (dispatch) {
    dispatch(requestOsmChange(taskId));

    return fetch(_config2.default.api + '/api/0.6/ways?nodes=true&excludeDoubleLinkedNodes=true&ways=' + wayIds.join(',')).then(function (response) {
      if (response.status >= 400) {
        throw new Error(response.statusText);
      }
      return response.text();
    }).then(function (xmlResponse) {
      // TODO - wrap XmlReader in promise to make Epic promises more composable
      var reader = _xmlReader2.default.create({ stream: true });
      var nodeIds = [];

      reader.on('tag:node', function (node) {
        if (node.attributes.id) {
          nodeIds.push(node.attributes.id);
        }
      });
      reader.on('done', function () {
        var payload = {
          delete: {
            node: nodeIds.map(function (id) {
              return { id: id };
            }),
            way: wayIds.map(function (id) {
              return { id: id };
            })
          }
        };
        createChangesetRequest(taskId, payload).then(function (changesetId) {
          return uploadChangesetRequest(changesetId, taskId, payload);
        }).then(function () {
          dispatch((0, _tasks.fetchWayTaskEpic)(taskId));
          dispatch(requestOsmChangeSuccess(taskId));
        }).catch(function (e) {
          console.error('Error Deleting Way', e);
          dispatch(requestOsmChangeError(taskId));
        });
      });
      reader.parse(xmlResponse);
    });
  };
};

/**
 * reducer
 */

exports.default = function () {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
    status: 'complete'
  };
  var action = arguments[1];

  switch (action.type) {
    case REQUEST_OSM_CHANGE:
      return Object.assign({}, state, {
        status: 'pending'
      });
    case REQUEST_OSM_CHANGE_SUCCESS:
      return Object.assign({}, state, {
        status: 'complete'
      });
    case REQUEST_OSM_CHANGE_ERROR:
      return Object.assign({}, state, {
        status: 'error'
      });
  }

  return state;
};

},{"../../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","./tasks":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/tasks.js","xml-reader":"xml-reader"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roadCount.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.fetchDistrictRoadCountEpic = exports.fetchProvincesRoadCountEpic = exports.clearRoadCount = exports.fetchDistrictRoadCountError = exports.fetchDistrictRoadCountSuccess = exports.fetchDistrictRoadCount = exports.fetchProvincesRoadCountError = exports.fetchProvincesRoadCountSuccess = exports.fetchProvincesRoadCount = exports.CLEAR_ROAD_COUNT = exports.FETCH_DISTRICT_ROAD_COUNT_ERROR = exports.FETCH_DISTRICT_ROAD_COUNT_SUCCESS = exports.FETCH_DISTRICT_ROAD_COUNT = exports.FETCH_PROVINCES_ROAD_COUNT_ERROR = exports.FETCH_PROVINCES_ROAD_COUNT_SUCCESS = exports.FETCH_PROVINCES_ROAD_COUNT = exports.getRoadCountKey = undefined;

var _url = require('url');

var _config = require('../../config');

var _config2 = _interopRequireDefault(_config);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * utils
 */
var getRoadCountKey = exports.getRoadCountKey = function getRoadCountKey(province, district) {
  return district ? province + '-' + district : province;
};

/**
 * constants
 */
var FETCH_PROVINCES_ROAD_COUNT = exports.FETCH_PROVINCES_ROAD_COUNT = 'FETCH_PROVINCES_ROAD_COUNT';
var FETCH_PROVINCES_ROAD_COUNT_SUCCESS = exports.FETCH_PROVINCES_ROAD_COUNT_SUCCESS = 'FETCH_PROVINCES_ROAD_COUNT_SUCCESS';
var FETCH_PROVINCES_ROAD_COUNT_ERROR = exports.FETCH_PROVINCES_ROAD_COUNT_ERROR = 'FETCH_PROVINCES_ROAD_COUNT_ERROR';
var FETCH_DISTRICT_ROAD_COUNT = exports.FETCH_DISTRICT_ROAD_COUNT = 'FETCH_DISTRICT_ROAD_COUNT';
var FETCH_DISTRICT_ROAD_COUNT_SUCCESS = exports.FETCH_DISTRICT_ROAD_COUNT_SUCCESS = 'FETCH_DISTRICT_ROAD_COUNT_SUCCESS';
var FETCH_DISTRICT_ROAD_COUNT_ERROR = exports.FETCH_DISTRICT_ROAD_COUNT_ERROR = 'FETCH_DISTRICT_ROAD_COUNT_ERROR';
var CLEAR_ROAD_COUNT = exports.CLEAR_ROAD_COUNT = 'CLEAR_ROAD_COUNT';

/**
 * actions
 */
var fetchProvincesRoadCount = exports.fetchProvincesRoadCount = function fetchProvincesRoadCount() {
  return { type: FETCH_PROVINCES_ROAD_COUNT };
};
var fetchProvincesRoadCountSuccess = exports.fetchProvincesRoadCountSuccess = function fetchProvincesRoadCountSuccess(provinces) {
  return { type: FETCH_PROVINCES_ROAD_COUNT_SUCCESS, provinces: provinces };
};
var fetchProvincesRoadCountError = exports.fetchProvincesRoadCountError = function fetchProvincesRoadCountError(error) {
  return { type: FETCH_PROVINCES_ROAD_COUNT_ERROR, error: error };
};
var fetchDistrictRoadCount = exports.fetchDistrictRoadCount = function fetchDistrictRoadCount(province, district) {
  return { type: FETCH_DISTRICT_ROAD_COUNT, province: province, district: district };
};
var fetchDistrictRoadCountSuccess = exports.fetchDistrictRoadCountSuccess = function fetchDistrictRoadCountSuccess(province, district, count, osmCount) {
  return { type: FETCH_DISTRICT_ROAD_COUNT_SUCCESS, province: province, district: district, count: count, osmCount: osmCount };
};
var fetchDistrictRoadCountError = exports.fetchDistrictRoadCountError = function fetchDistrictRoadCountError(province, district, error) {
  return { type: FETCH_DISTRICT_ROAD_COUNT_ERROR, province: province, district: district, error: error };
};
var clearRoadCount = exports.clearRoadCount = function clearRoadCount() {
  return { type: CLEAR_ROAD_COUNT };
};

var fetchProvincesRoadCountEpic = exports.fetchProvincesRoadCountEpic = function fetchProvincesRoadCountEpic() {
  return function (dispatch) {
    dispatch(fetchProvincesRoadCount());

    return fetch(_config2.default.api + '/admin/roads/total').then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return response.json();
    }).then(function (provinces) {
      dispatch(fetchProvincesRoadCountSuccess(provinces));
    }).catch(function (err) {
      return dispatch(fetchProvincesRoadCountError(err));
    });
  };
};

var fetchDistrictRoadCountEpic = exports.fetchDistrictRoadCountEpic = function fetchDistrictRoadCountEpic(province, district) {
  return function (dispatch) {
    dispatch(fetchDistrictRoadCount(province, district));

    return fetch((0, _url.format)({ pathname: _config2.default.api + '/properties/roads/count', query: { province: province, district: district } })).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return response.json();
    }).then(function (_ref) {
      var count = _ref.count,
          osmCount = _ref.osmCount;

      dispatch(fetchDistrictRoadCountSuccess(province, district, count, osmCount));
    }).catch(function (err) {
      return dispatch(fetchDistrictRoadCountError(province, district, err));
    });
  };
};

/**
 * reducer
 */

exports.default = function () {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
    provinces: {},
    districts: {}
  };
  var action = arguments[1];

  if (action.type === FETCH_PROVINCES_ROAD_COUNT) {
    return Object.assign({}, state, {
      provinces: Object.assign({}, state.provinces, {
        status: 'pending'
      })
    });
  } else if (action.type === FETCH_PROVINCES_ROAD_COUNT_SUCCESS) {
    return Object.assign({}, state, {
      provinces: Object.assign({}, state.provinces, {
        status: 'complete',
        provinceCount: action.provinces
      })
    });
  } else if (action.type === FETCH_PROVINCES_ROAD_COUNT_ERROR) {
    return Object.assign({}, state, {
      provinces: Object.assign({}, state.provinces, {
        status: 'error'
      })
    });
  } else if (action.type === FETCH_DISTRICT_ROAD_COUNT) {
    var province = action.province,
        district = action.district;

    var roadCountKey = getRoadCountKey(province, district);

    return Object.assign({}, state, {
      districts: Object.assign({}, state.districts, _defineProperty({}, roadCountKey, Object.assign({}, state.districts[roadCountKey] || {}, {
        status: 'pending'
      })))
    });
  } else if (action.type === FETCH_DISTRICT_ROAD_COUNT_SUCCESS) {
    var _province = action.province,
        _district = action.district,
        count = action.count,
        osmCount = action.osmCount;

    var _roadCountKey = getRoadCountKey(_province, _district);

    return Object.assign({}, state, {
      districts: Object.assign({}, state.districts, _defineProperty({}, _roadCountKey, {
        status: 'complete',
        count: count,
        osmCount: osmCount
      }))
    });
  } else if (action.type === FETCH_DISTRICT_ROAD_COUNT_ERROR) {
    var _province2 = action.province,
        _district2 = action.district;

    var _roadCountKey2 = getRoadCountKey(_province2, _district2);

    return Object.assign({}, state, {
      districts: Object.assign({}, state.districts, _defineProperty({}, _roadCountKey2, {
        status: 'error',
        count: undefined,
        osmCount: undefined
      }))
    });
  } else if (action.type === CLEAR_ROAD_COUNT) {
    return {
      provinces: {},
      districts: {}
    };
  }

  return state;
};

},{"../../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","url":"url"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.editRoadIdEpic = exports.fetchRoadPropertyEpic = exports.fetchRoadBboxEpic = exports.deleteRoadPropertyEpic = exports.editRoadPropertyEpic = exports.opOnRoadPropertyEpic = exports.createRoadPropertyEpic = exports.deleteRoadEpic = exports.editRoadStatusEpic = exports.editRoadEpic = exports.createRoadEpic = exports.fetchRoadGeometryEpic = exports.fetchRoadsEpic = exports.editRoadIdError = exports.editRoadIdSucess = exports.editRoadId = exports.fetchRoadPropertyError = exports.fetchRoadPropertySuccess = exports.fetchRoadProperty = exports.fetchRoadBboxError = exports.fetchRoadBboxSuccess = exports.fetchRoadBbox = exports.opOnRoadPropertyError = exports.opOnRoadPropertySuccess = exports.opOnRoadProperty = exports.deleteRoadPropertyError = exports.deleteRoadPropertySuccess = exports.deleteRoadProperty = exports.editRoadStatusError = exports.editRoadStatusSuccess = exports.editRoadStatus = exports.editRoadPropertyError = exports.editRoadPropertySuccess = exports.editRoadProperty = exports.createRoadPropertyError = exports.createRoadPropertySuccess = exports.createRoadProperty = exports.createRoadError = exports.createRoadSuccess = exports.createRoad = exports.deleteRoadError = exports.deleteRoadSuccess = exports.deleteRoad = exports.editRoadError = exports.editRoadSuccess = exports.editRoad = exports.fetchRoadGeometryError = exports.fetchRoadGeometrySuccess = exports.fetchRoadGeometry = exports.clearRoadsPages = exports.fetchRoadsError = exports.fetchRoadsSuccess = exports.fetchRoads = exports.EDIT_ROAD_ID_ERROR = exports.EDIT_ROAD_ID_SUCCESS = exports.EDIT_ROAD_ID = exports.FETCH_ROAD_PROPERTY_SUCCESS = exports.FETCH_ROAD_PROPERTY_ERROR = exports.FETCH_ROAD_PROPERTY = exports.FETCH_ROAD_BBOX_ERROR = exports.FETCH_ROAD_BBOX_SUCCESS = exports.FETCH_ROAD_BBOX = exports.OP_ON_ROAD_PROPERTY_ERROR = exports.OP_ON_ROAD_PROPERTY_SUCCESS = exports.OP_ON_ROAD_PROPERTY = exports.DELETE_ROAD_PROPERTY_ERROR = exports.DELETE_ROAD_PROPERTY_SUCCESS = exports.DELETE_ROAD_PROPERTY = exports.EDIT_ROAD_STATUS_ERROR = exports.EDIT_ROAD_STATUS_SUCCESS = exports.EDIT_ROAD_STATUS = exports.EDIT_ROAD_PROPERTY_ERROR = exports.EDIT_ROAD_PROPERTY_SUCCESS = exports.EDIT_ROAD_PROPERTY = exports.CREATE_ROAD_PROPERTY_ERROR = exports.CREATE_ROAD_PROPERTY_SUCCESS = exports.CREATE_ROAD_PROPERTY = exports.DELETE_ROAD_ERROR = exports.DELETE_ROAD_SUCCESS = exports.DELETE_ROAD = exports.EDIT_ROAD_ERROR = exports.EDIT_ROAD_SUCCESS = exports.EDIT_ROAD = exports.CREATE_ROAD_ERROR = exports.CREATE_ROAD_SUCCESS = exports.CREATE_ROAD = exports.FETCH_ROAD_GEOMETRY_ERROR = exports.FETCH_ROAD_GEOMETRY_SUCCESS = exports.FETCH_ROAD_GEOMETRY = exports.CLEAR_ROADS_PAGES = exports.FETCH_ROADS_ERROR = exports.FETCH_ROADS_SUCCESS = exports.FETCH_ROADS = exports.getRoadPageKey = exports.roadIdIsValid = undefined;

var _url = require('url');

var _lodash = require('lodash');

var _roadCount = require('./roadCount');

var _config = require('../../config');

var _config2 = _interopRequireDefault(_config);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * Utils
 */
var roadIdIsValid = exports.roadIdIsValid = function roadIdIsValid(id, province, district) {
  return (/^\d{3}([A-ZĐ]{2}|00)\d{5}$/.test(id) && (!province || id.substring(0, 2) === province) && (!district || id.substring(3, 5) === district)
  );
};
var getRoadPageKey = exports.getRoadPageKey = function getRoadPageKey() {
  var province = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
  var district = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
  var page = arguments[2];
  var sortField = arguments[3];
  var sortOrder = arguments[4];
  return province + '-' + district + '-' + page + '-' + sortField + '-' + sortOrder;
};

/**
 * constants
 */
var FETCH_ROADS = exports.FETCH_ROADS = 'FETCH_ROADS';
var FETCH_ROADS_SUCCESS = exports.FETCH_ROADS_SUCCESS = 'FETCH_ROADS_SUCCESS';
var FETCH_ROADS_ERROR = exports.FETCH_ROADS_ERROR = 'FETCH_ROADS_ERROR';
var CLEAR_ROADS_PAGES = exports.CLEAR_ROADS_PAGES = 'CLEAR_ROADS_PAGES';
var FETCH_ROAD_GEOMETRY = exports.FETCH_ROAD_GEOMETRY = 'FETCH_ROAD_GEOMETRY';
var FETCH_ROAD_GEOMETRY_SUCCESS = exports.FETCH_ROAD_GEOMETRY_SUCCESS = 'FETCH_ROAD_GEOMETRY_SUCCESS';
var FETCH_ROAD_GEOMETRY_ERROR = exports.FETCH_ROAD_GEOMETRY_ERROR = 'FETCH_ROAD_GEOMETRY_ERROR';
var CREATE_ROAD = exports.CREATE_ROAD = 'CREATE_ROAD';
var CREATE_ROAD_SUCCESS = exports.CREATE_ROAD_SUCCESS = 'CREATE_ROAD_SUCCESS';
var CREATE_ROAD_ERROR = exports.CREATE_ROAD_ERROR = 'CREATE_ROAD_ERROR';
var EDIT_ROAD = exports.EDIT_ROAD = 'EDIT_ROAD';
var EDIT_ROAD_SUCCESS = exports.EDIT_ROAD_SUCCESS = 'EDIT_ROAD_SUCCESS';
var EDIT_ROAD_ERROR = exports.EDIT_ROAD_ERROR = 'EDIT_ROAD_ERROR';
var DELETE_ROAD = exports.DELETE_ROAD = 'DELETE_ROAD';
var DELETE_ROAD_SUCCESS = exports.DELETE_ROAD_SUCCESS = 'DELETE_ROAD_SUCCESS';
var DELETE_ROAD_ERROR = exports.DELETE_ROAD_ERROR = 'DELETE_ROAD_ERROR';
var CREATE_ROAD_PROPERTY = exports.CREATE_ROAD_PROPERTY = 'CREATE_ROAD_PROPERTY';
var CREATE_ROAD_PROPERTY_SUCCESS = exports.CREATE_ROAD_PROPERTY_SUCCESS = 'CREATE_ROAD_PROPERTY_SUCCESS';
var CREATE_ROAD_PROPERTY_ERROR = exports.CREATE_ROAD_PROPERTY_ERROR = 'CREATE_ROAD_PROPERTY_ERROR';
var EDIT_ROAD_PROPERTY = exports.EDIT_ROAD_PROPERTY = 'EDIT_ROAD_PROPERTY';
var EDIT_ROAD_PROPERTY_SUCCESS = exports.EDIT_ROAD_PROPERTY_SUCCESS = 'EDIT_ROAD_PROPERTY_SUCCESS';
var EDIT_ROAD_PROPERTY_ERROR = exports.EDIT_ROAD_PROPERTY_ERROR = 'EDIT_ROAD_PROPERTY_ERROR';
var EDIT_ROAD_STATUS = exports.EDIT_ROAD_STATUS = 'EDIT_ROAD_STATUS';
var EDIT_ROAD_STATUS_SUCCESS = exports.EDIT_ROAD_STATUS_SUCCESS = 'EDIT_ROAD_STATUS_SUCCESS';
var EDIT_ROAD_STATUS_ERROR = exports.EDIT_ROAD_STATUS_ERROR = 'EDIT_ROAD_STATUS_ERROR';
var DELETE_ROAD_PROPERTY = exports.DELETE_ROAD_PROPERTY = 'DELETE_ROAD_PROPERTY';
var DELETE_ROAD_PROPERTY_SUCCESS = exports.DELETE_ROAD_PROPERTY_SUCCESS = 'DELETE_ROAD_PROPERTY_SUCCESS';
var DELETE_ROAD_PROPERTY_ERROR = exports.DELETE_ROAD_PROPERTY_ERROR = 'DELETE_ROAD_PROPERTY_ERROR';
var OP_ON_ROAD_PROPERTY = exports.OP_ON_ROAD_PROPERTY = 'OP_ON_ROAD_PROPERTY';
var OP_ON_ROAD_PROPERTY_SUCCESS = exports.OP_ON_ROAD_PROPERTY_SUCCESS = 'OP_ON_ROAD_PROPERTY_SUCCESS';
var OP_ON_ROAD_PROPERTY_ERROR = exports.OP_ON_ROAD_PROPERTY_ERROR = 'OP_ON_ROAD_PROPERTY_ERROR';
var FETCH_ROAD_BBOX = exports.FETCH_ROAD_BBOX = 'FETCH_ROAD_BBOX';
var FETCH_ROAD_BBOX_SUCCESS = exports.FETCH_ROAD_BBOX_SUCCESS = 'FETCH_ROAD_BBOX_SUCCESS';
var FETCH_ROAD_BBOX_ERROR = exports.FETCH_ROAD_BBOX_ERROR = 'FETCH_ROAD_BBOX_ERROR';
var FETCH_ROAD_PROPERTY = exports.FETCH_ROAD_PROPERTY = 'FETCH_ROAD_PROPERTY';
var FETCH_ROAD_PROPERTY_ERROR = exports.FETCH_ROAD_PROPERTY_ERROR = 'FETCH_ROAD_PROPERTY';
var FETCH_ROAD_PROPERTY_SUCCESS = exports.FETCH_ROAD_PROPERTY_SUCCESS = 'FETCH_ROAD_PROPERTY_SUCCESS';
var EDIT_ROAD_ID = exports.EDIT_ROAD_ID = 'EDIT_ROAD_ID';
var EDIT_ROAD_ID_SUCCESS = exports.EDIT_ROAD_ID_SUCCESS = 'EDIT_ROAD_ID_SUCCESS';
var EDIT_ROAD_ID_ERROR = exports.EDIT_ROAD_ID_ERROR = 'EDIT_ROAD_ID_ERROR';

/**
 * actions
 */
var fetchRoads = exports.fetchRoads = function fetchRoads(province, district, page, sortField, sortOrder) {
  return { type: FETCH_ROADS, province: province, district: district, page: page, sortField: sortField, sortOrder: sortOrder };
};
var fetchRoadsSuccess = exports.fetchRoadsSuccess = function fetchRoadsSuccess(roadsById, roadsByPage, province, district, page, sortField, sortOrder) {
  return { type: FETCH_ROADS_SUCCESS, roadsById: roadsById, roadsByPage: roadsByPage, province: province, district: district, page: page, sortField: sortField, sortOrder: sortOrder };
};
var fetchRoadsError = exports.fetchRoadsError = function fetchRoadsError(error, province, district, page, sortField, sortOrder) {
  return { type: FETCH_ROADS_ERROR, error: error, province: province, district: district, page: page, sortField: sortField, sortOrder: sortOrder };
};
var clearRoadsPages = exports.clearRoadsPages = function clearRoadsPages() {
  return { type: CLEAR_ROADS_PAGES };
};

var fetchRoadGeometry = exports.fetchRoadGeometry = function fetchRoadGeometry(id) {
  return { type: FETCH_ROAD_GEOMETRY, id: id };
};
var fetchRoadGeometrySuccess = exports.fetchRoadGeometrySuccess = function fetchRoadGeometrySuccess(id, geoJSON) {
  return { type: FETCH_ROAD_GEOMETRY_SUCCESS, id: id, geoJSON: geoJSON };
};
var fetchRoadGeometryError = exports.fetchRoadGeometryError = function fetchRoadGeometryError(id, error) {
  return { type: FETCH_ROAD_GEOMETRY_ERROR, id: id, error: error };
};

var editRoad = exports.editRoad = function editRoad(id, newId) {
  return { type: EDIT_ROAD, id: id, newId: newId };
};
var editRoadSuccess = exports.editRoadSuccess = function editRoadSuccess(id, newId) {
  return { type: EDIT_ROAD_SUCCESS, id: id, newId: newId };
};
var editRoadError = exports.editRoadError = function editRoadError(id, newId, error) {
  return { type: EDIT_ROAD_ERROR, id: id, newId: newId, error: error };
};

var deleteRoad = exports.deleteRoad = function deleteRoad(id) {
  return { type: DELETE_ROAD, id: id };
};
var deleteRoadSuccess = exports.deleteRoadSuccess = function deleteRoadSuccess(id) {
  return { type: DELETE_ROAD_SUCCESS, id: id };
};
var deleteRoadError = exports.deleteRoadError = function deleteRoadError(id, error) {
  return { type: DELETE_ROAD_ERROR, id: id, error: error };
};

var createRoad = exports.createRoad = function createRoad(id) {
  return { type: CREATE_ROAD, id: id };
};
var createRoadSuccess = exports.createRoadSuccess = function createRoadSuccess() {
  return { type: CREATE_ROAD_SUCCESS };
};
var createRoadError = exports.createRoadError = function createRoadError(error) {
  return { type: CREATE_ROAD_ERROR, error: error };
};

var createRoadProperty = exports.createRoadProperty = function createRoadProperty(id, key, value) {
  return { type: CREATE_ROAD_PROPERTY, id: id, key: key, value: value };
};
var createRoadPropertySuccess = exports.createRoadPropertySuccess = function createRoadPropertySuccess(id, key, value) {
  return { type: CREATE_ROAD_PROPERTY_SUCCESS, id: id, key: key, value: value };
};
var createRoadPropertyError = exports.createRoadPropertyError = function createRoadPropertyError(id, key, value, error) {
  return { type: CREATE_ROAD_PROPERTY_ERROR, id: id, key: key, value: value, error: error };
};

var editRoadProperty = exports.editRoadProperty = function editRoadProperty(id, key, value) {
  return { type: EDIT_ROAD_PROPERTY, id: id, key: key, value: value };
};
var editRoadPropertySuccess = exports.editRoadPropertySuccess = function editRoadPropertySuccess(id, key, value) {
  return { type: EDIT_ROAD_PROPERTY_SUCCESS, id: id, key: key, value: value };
};
var editRoadPropertyError = exports.editRoadPropertyError = function editRoadPropertyError(id, key, value, error) {
  return { type: EDIT_ROAD_PROPERTY_ERROR, id: id, key: key, value: value, error: error };
};

var editRoadStatus = exports.editRoadStatus = function editRoadStatus(id, value) {
  return { type: EDIT_ROAD_STATUS, id: id, value: value };
};
var editRoadStatusSuccess = exports.editRoadStatusSuccess = function editRoadStatusSuccess(id, value) {
  return { type: EDIT_ROAD_STATUS_SUCCESS, id: id, value: value };
};
var editRoadStatusError = exports.editRoadStatusError = function editRoadStatusError(id, value, error) {
  return { type: EDIT_ROAD_STATUS_ERROR, id: id, value: value, error: error };
};

var deleteRoadProperty = exports.deleteRoadProperty = function deleteRoadProperty(id, key) {
  return { type: DELETE_ROAD_PROPERTY, id: id, key: key };
};
var deleteRoadPropertySuccess = exports.deleteRoadPropertySuccess = function deleteRoadPropertySuccess(id, key) {
  return { type: DELETE_ROAD_PROPERTY_SUCCESS, id: id, key: key };
};
var deleteRoadPropertyError = exports.deleteRoadPropertyError = function deleteRoadPropertyError(id, key, error) {
  return { type: DELETE_ROAD_PROPERTY_ERROR, id: id, key: key, error: error };
};

var opOnRoadProperty = exports.opOnRoadProperty = function opOnRoadProperty() {
  return { type: OP_ON_ROAD_PROPERTY };
};
var opOnRoadPropertySuccess = exports.opOnRoadPropertySuccess = function opOnRoadPropertySuccess(data) {
  return { type: OP_ON_ROAD_PROPERTY_SUCCESS, data: data };
};
var opOnRoadPropertyError = exports.opOnRoadPropertyError = function opOnRoadPropertyError(error) {
  return { type: OP_ON_ROAD_PROPERTY_ERROR, error: error };
};

var fetchRoadBbox = exports.fetchRoadBbox = function fetchRoadBbox(roadId) {
  return { type: FETCH_ROAD_BBOX, roadId: roadId };
};
var fetchRoadBboxSuccess = exports.fetchRoadBboxSuccess = function fetchRoadBboxSuccess(roadId, bbox) {
  return { type: FETCH_ROAD_BBOX_SUCCESS, roadId: roadId, bbox: bbox };
};
var fetchRoadBboxError = exports.fetchRoadBboxError = function fetchRoadBboxError(roadId, error) {
  return { type: FETCH_ROAD_BBOX_ERROR, roadId: roadId, error: error };
};

var fetchRoadProperty = exports.fetchRoadProperty = function fetchRoadProperty(roadId) {
  return { type: FETCH_ROAD_PROPERTY, roadId: roadId };
};
var fetchRoadPropertySuccess = exports.fetchRoadPropertySuccess = function fetchRoadPropertySuccess(roadId, properties) {
  return { type: FETCH_ROAD_PROPERTY_SUCCESS, roadId: roadId, properties: properties };
};
var fetchRoadPropertyError = exports.fetchRoadPropertyError = function fetchRoadPropertyError(roadId, error) {
  return { type: FETCH_ROAD_PROPERTY_ERROR, roadId: roadId, error: error };
};

var editRoadId = exports.editRoadId = function editRoadId(wayId, vprommId) {
  return { type: EDIT_ROAD_ID, wayId: wayId, vprommId: vprommId };
};
var editRoadIdSucess = exports.editRoadIdSucess = function editRoadIdSucess(wayId, vprommId) {
  return { type: EDIT_ROAD_ID_SUCCESS, wayId: wayId };
};
var editRoadIdError = exports.editRoadIdError = function editRoadIdError(wayId, error) {
  return { type: EDIT_ROAD_ID_ERROR, wayId: wayId, error: error };
};

var fetchRoadsEpic = exports.fetchRoadsEpic = function fetchRoadsEpic(province, district, page, sortField, sortOrder) {
  return function (dispatch) {
    dispatch(fetchRoads(province, district, page, sortField, sortOrder));

    return fetch((0, _url.format)({ pathname: _config2.default.api + '/properties/roads', query: { province: province, district: district, page: page, sortField: sortField, sortOrder: sortOrder } })).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return response.json();
    }).then(function (roads) {
      // normalize response
      var roadsById = (0, _lodash.reduce)(roads, function (roadMap, road) {
        roadMap[road.id] = (0, _lodash.omit)(road, ['id']);
        return roadMap;
      }, {});
      var roadsByPage = (0, _lodash.map)(roads, (0, _lodash.property)('id'));

      dispatch(fetchRoadsSuccess(roadsById, roadsByPage, province, district, page, sortField, sortOrder));
    }).catch(function (err) {
      return dispatch(fetchRoadsError(err, province, district, page, sortField, sortOrder));
    });
  };
};

var fetchRoadGeometryEpic = exports.fetchRoadGeometryEpic = function fetchRoadGeometryEpic(id) {
  return function (dispatch) {
    dispatch(fetchRoadGeometry(id));

    return fetch(_config2.default.api + '/properties/roads/' + id + '.geojson').then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return response.json();
    }).then(function (geoJSON) {
      return dispatch(fetchRoadGeometrySuccess(id, geoJSON));
    }).catch(function (err) {
      return dispatch(fetchRoadGeometryError(id, err));
    });
  };
};

var createRoadEpic = exports.createRoadEpic = function createRoadEpic(id) {
  return function (dispatch) {
    dispatch(createRoad());

    return fetch(_config2.default.api + '/properties/roads/' + id, {
      method: 'PUT'
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return response.json();
    }).then(function (id) {
      return Promise.all([dispatch(createRoadSuccess(id)), dispatch(clearRoadsPages()), dispatch((0, _roadCount.clearRoadCount)())]);
    }, function (err) {
      return dispatch(createRoadError(err.message));
    });
  };
};

var editRoadEpic = exports.editRoadEpic = function editRoadEpic(id, newId) {
  return function (dispatch) {
    dispatch(editRoad(id, newId));

    return fetch(_config2.default.api + '/properties/roads/' + id + '/move', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ id: newId })
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return response.json();
    }).then(function (_ref) {
      var newId = _ref.id;

      return Promise.all([dispatch(editRoadSuccess(id, newId)), dispatch(clearRoadsPages()), dispatch((0, _roadCount.clearRoadCount)())]);
    }, function (err) {
      return dispatch(editRoadError(id, newId, err.message));
    });
  };
};

var editRoadStatusEpic = exports.editRoadStatusEpic = function editRoadStatusEpic(id, status) {
  return function (dispatch) {
    dispatch(editRoad(id, status));

    return fetch(_config2.default.api + '/properties/roads/' + id + '/status', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ status: status })
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return response.json();
    }).then(function () {
      return Promise.all([dispatch(editRoadStatusSuccess(id, status)), dispatch(clearRoadsPages()), dispatch((0, _roadCount.clearRoadCount)())]);
    }, function (err) {
      return dispatch(editRoadStatusError(id, status, err.message));
    });
  };
};

var deleteRoadEpic = exports.deleteRoadEpic = function deleteRoadEpic(id) {
  return function (dispatch) {
    dispatch(deleteRoad(id));

    return fetch(_config2.default.api + '/properties/roads/' + id, {
      method: 'DELETE'
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      dispatch(deleteRoadSuccess(id));
      dispatch(clearRoadsPages());
      dispatch((0, _roadCount.clearRoadCount)());
    }).catch(function (err) {
      return dispatch(deleteRoadError(id, err.message));
    });
  };
};

var createRoadPropertyEpic = exports.createRoadPropertyEpic = function createRoadPropertyEpic(id, key, value) {
  return function (dispatch) {
    dispatch(createRoadProperty(id, key, value));

    return fetch(_config2.default.api + '/properties/roads/' + id, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json-patch+json'
      },
      body: JSON.stringify([{ op: 'add', path: '/' + key, value: value }])
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      dispatch(createRoadPropertySuccess(id, key, value));
    }).catch(function (err) {
      return dispatch(createRoadPropertyError(id, key, value, err));
    });
  };
};

var opOnRoadPropertyEpic = exports.opOnRoadPropertyEpic = function opOnRoadPropertyEpic(id, operations) {
  return function (dispatch) {
    dispatch(opOnRoadProperty());

    var computeOps = function computeOps(type, ops) {
      return (ops[type] || []).map(function (field) {
        var path = field.key.replace(/~/g, '~0').replace(/\//g, '~1');
        return { op: type, path: '/' + path, value: field.value };
      });
    };
    var ops = computeOps('add', operations).concat(computeOps('replace', operations)).concat(computeOps('remove', operations));

    return fetch(_config2.default.api + '/properties/roads/' + id, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json-patch+json'
      },
      body: JSON.stringify(ops)
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return { ok: true };
    }).then(function (res) {
      return dispatch(opOnRoadPropertySuccess(res));
    }, function (err) {
      return dispatch(opOnRoadPropertyError(err));
    });
  };
};

var editRoadPropertyEpic = exports.editRoadPropertyEpic = function editRoadPropertyEpic(id, key, value) {
  return function (dispatch) {
    dispatch(editRoadProperty(id, key, value));

    return fetch(_config2.default.api + '/properties/roads/' + id, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json-patch+json'
      },
      body: JSON.stringify([{ op: 'replace', path: '/' + key, value: value }])
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      dispatch(editRoadPropertySuccess(id, key, value));
    }).catch(function (err) {
      return dispatch(editRoadPropertyError(id, key, value, err));
    });
  };
};

var deleteRoadPropertyEpic = exports.deleteRoadPropertyEpic = function deleteRoadPropertyEpic(id, key) {
  return function (dispatch) {
    dispatch(deleteRoadProperty(id, key));

    return fetch(_config2.default.api + '/properties/roads/' + id, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json-patch+json'
      },
      body: JSON.stringify([{ op: 'remove', path: '/' + key }])
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      dispatch(deleteRoadPropertySuccess(id, key));
    }).catch(function (err) {
      return dispatch(deleteRoadPropertyError(id, key, err));
    });
  };
};

var fetchRoadBboxEpic = exports.fetchRoadBboxEpic = function fetchRoadBboxEpic(roadId) {
  return function (dispatch) {
    dispatch(fetchRoadBbox());

    return fetch(_config2.default.api + '/way/' + roadId + '/bbox').then(function (response) {
      if (!response.ok) {
        return new Error(response.status);
      }

      return response.json();
    }).then(function (bbox) {
      return dispatch(fetchRoadBboxSuccess(roadId, bbox));
    }).catch(function (err) {
      return dispatch(fetchRoadBboxError(roadId, err));
    });
  };
};

var fetchRoadPropertyEpic = exports.fetchRoadPropertyEpic = function fetchRoadPropertyEpic(roadId) {
  return function (dispatch) {
    dispatch(fetchRoadProperty());

    return fetch(_config2.default.api + '/properties/roads/' + roadId).then(function (response) {
      if (!response.ok) {
        return new Error(response.status);
      }

      return response.json();
    }).then(function (property) {
      return dispatch(fetchRoadPropertySuccess(roadId, property));
    }).catch(function (err) {
      return dispatch(fetchRoadPropertyError(roadId, err));
    });
  };
};

var editRoadIdEpic = exports.editRoadIdEpic = function editRoadIdEpic(wayId, vprommId) {
  return function (dispatch) {
    dispatch(editRoadId(wayId, vprommId));

    return fetch(_config2.default.api + '/way/tags/vprommid/' + wayId, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json-patch+json'
      },
      body: JSON.stringify({ 'vprommid': vprommId })
    }).then(function (response) {
      if (!response.ok) {
        throw new Error(response.status);
      }

      return response.json();
    }).then(function (wayId) {
      return dispatch(editRoadIdSucess(wayId));
    }).catch(function (err) {
      return dispatch(editRoadError(err));
    });
  };
};

/**
 * reducer
 */

exports.default = function () {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
    roadsById: {},
    roadsByPage: {}
  };
  var action = arguments[1];

  if (action.type === FETCH_ROADS) {
    var province = action.province,
        district = action.district,
        page = action.page,
        sortField = action.sortField,
        sortOrder = action.sortOrder;

    var pageKey = getRoadPageKey(province, district, page, sortField, sortOrder);

    return Object.assign({}, state, {
      roadsByPage: Object.assign({}, state.roadsByPage, _defineProperty({}, pageKey, {
        status: 'pending',
        roads: state.roadsByPage[pageKey] ? state.roadsByPage[pageKey].roads : []
      }))
    });
  } else if (action.type === FETCH_ROADS_SUCCESS) {
    var roadsById = action.roadsById,
        roadsByPage = action.roadsByPage,
        _province = action.province,
        _district = action.district,
        _page = action.page,
        _sortField = action.sortField,
        _sortOrder = action.sortOrder;

    var _pageKey = getRoadPageKey(_province, _district, _page, _sortField, _sortOrder);

    return Object.assign({}, state, {
      roadsById: (0, _lodash.merge)({}, state.roadsById, roadsById),
      roadsByPage: Object.assign({}, state.roadsByPage, _defineProperty({}, _pageKey, {
        status: 'complete',
        roads: roadsByPage
      }))
    });
  } else if (action.type === FETCH_ROADS_ERROR) {
    var _province2 = action.province,
        _district2 = action.district,
        _page2 = action.page,
        _sortField2 = action.sortField,
        _sortOrder2 = action.sortOrder;

    var _pageKey2 = getRoadPageKey(_province2, _district2, _page2, _sortField2, _sortOrder2);

    return Object.assign({}, state, {
      roadsByPage: Object.assign({}, state.roadsByPage, _defineProperty({}, _pageKey2, {
        status: 'error',
        roads: []
      }))
    });
  } else if (action.type === CLEAR_ROADS_PAGES) {
    return Object.assign({}, state, {
      roadsByPage: {}
    });
  } else if (action.type === FETCH_ROAD_GEOMETRY_SUCCESS) {
    return Object.assign({}, state, {
      roadsById: Object.assign({}, state.roadsById, _defineProperty({}, action.id, Object.assign({}, state.roadsById[action.id] || {}, {
        geoJSON: action.geoJSON
      })))
    });
  } else if (action.type === CREATE_ROAD_PROPERTY_SUCCESS) {
    return Object.assign({}, state, {
      roadsById: Object.assign({}, state.roadsById, _defineProperty({}, action.id, Object.assign({}, state.roadsById[action.id], {
        properties: Object.assign({}, state.roadsById[action.id].properties, _defineProperty({}, action.key, action.value))
      })))
    });
  } else if (action.type === EDIT_ROAD_PROPERTY_SUCCESS) {
    return Object.assign({}, state, {
      roadsById: Object.assign({}, state.roadsById, _defineProperty({}, action.id, Object.assign({}, state.roadsById[action.id], {
        properties: Object.assign({}, state.roadsById[action.id].properties, _defineProperty({}, action.key, action.value))
      })))
    });
  } else if (action.type === DELETE_ROAD_PROPERTY_SUCCESS) {
    return Object.assign({}, state, {
      roadsById: Object.assign({}, state.roadsById, _defineProperty({}, action.id, Object.assign({}, state.roadsById[action.id], {
        properties: (0, _lodash.omit)(state.roadsById[action.id].properties, [action.key])
      })))
    });
  } else if (action.type === EDIT_ROAD_STATUS_SUCCESS) {
    return Object.assign({}, state, {
      roadsById: Object.assign({}, state.roadsById, _defineProperty({}, action.id, Object.assign({}, state.roadsById[action.id], {
        status: action.value
      })))
    });
  } else if (action.type === FETCH_ROAD_PROPERTY_SUCCESS) {
    return Object.assign({}, state, {
      roadsById: Object.assign({}, state.roadsById, _defineProperty({}, action.roadId, Object.assign({}, state.roadsById[action.roadId], {
        properties: action.properties
      })))
    });
  } else if (action.type === EDIT_ROAD_ID_SUCCESS) {
    return Object.assign({}, state);
  } else if (action.type === DELETE_ROAD_SUCCESS) {
    return Object.assign({}, state, {
      roadsById: Object.assign({}, state.roadsById, delete state.roadsById[action.id])
    });
  }

  return state;
};

},{"../../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","./roadCount":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roadCount.js","lodash":"lodash","url":"url"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/tasks.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.dedupeWayTaskEpic = exports.markWayTaskPendingEpic = exports.fetchWayTaskCountEpic = exports.fetchWayTaskEpic = exports.fetchNextWayTaskEpic = exports.dedupeWayTaskError = exports.dedupeWayTaskSuccess = exports.dedupeWayTask = exports.selectWayTaskProvince = exports.skipTask = exports.markWayTaskPendingError = exports.markWayTaskPendingSuccess = exports.markWayTaskPending = exports.fetchWayTaskCountError = exports.fetchWayTaskCountSuccess = exports.fetchWayTaskCount = exports.fetchWayTaskError = exports.fetchWayTaskSuccess = exports.fetchNextWayTask = exports.fetchWayTask = exports.DEDUPE_WAY_TASK_ERROR = exports.DEDUPE_WAY_TASK_SUCCESS = exports.DEDUPE_WAY_TASK = exports.SELECT_NEXT_WAY_TASK_PROVINCE = exports.SKIP_TASK = exports.MARK_WAY_TASK_PENDING_ERROR = exports.MARK_WAY_TASK_PENDING_SUCCESS = exports.MARK_WAY_TASK_PENDING = exports.FETCH_WAY_TASK_COUNT_ERROR = exports.FETCH_WAY_TASK_COUNT_SUCCESS = exports.FETCH_WAY_TASK_COUNT = exports.FETCH_WAY_TASK_ERROR = exports.FETCH_WAY_TASK_SUCCESS = exports.FETCH_NEXT_WAY_TASK = exports.FETCH_WAY_TASK = undefined;

var _config = require('../../config');

var _config2 = _interopRequireDefault(_config);

var _osm = require('./osm');

var _roads = require('./roads');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * constants
 */
var FETCH_WAY_TASK = exports.FETCH_WAY_TASK = 'FETCH_WAY_TASK';
var FETCH_NEXT_WAY_TASK = exports.FETCH_NEXT_WAY_TASK = 'FETCH_NEXT_WAY_TASK';
var FETCH_WAY_TASK_SUCCESS = exports.FETCH_WAY_TASK_SUCCESS = 'FETCH_WAY_TASK_SUCCESS';
var FETCH_WAY_TASK_ERROR = exports.FETCH_WAY_TASK_ERROR = 'FETCH_WAY_TASK_ERROR';
var FETCH_WAY_TASK_COUNT = exports.FETCH_WAY_TASK_COUNT = 'FETCH_WAY_TASK_COUNT';
var FETCH_WAY_TASK_COUNT_SUCCESS = exports.FETCH_WAY_TASK_COUNT_SUCCESS = 'FETCH_WAY_TASK_COUNT_SUCCESS';
var FETCH_WAY_TASK_COUNT_ERROR = exports.FETCH_WAY_TASK_COUNT_ERROR = 'FETCH_WAY_TASK_COUNT_ERROR';
var MARK_WAY_TASK_PENDING = exports.MARK_WAY_TASK_PENDING = 'MARK_WAY_TASK_PENDING';
var MARK_WAY_TASK_PENDING_SUCCESS = exports.MARK_WAY_TASK_PENDING_SUCCESS = 'MARK_WAY_TASK_PENDING_SUCCESS';
var MARK_WAY_TASK_PENDING_ERROR = exports.MARK_WAY_TASK_PENDING_ERROR = 'MARK_WAY_TASK_PENDING_ERROR';
var SKIP_TASK = exports.SKIP_TASK = 'SKIP_TASK';
var SELECT_NEXT_WAY_TASK_PROVINCE = exports.SELECT_NEXT_WAY_TASK_PROVINCE = 'SELECT_NEXT_WAY_TASK_PROVINCE';
var DEDUPE_WAY_TASK = exports.DEDUPE_WAY_TASK = 'DEDUPE_WAY_TASK';
var DEDUPE_WAY_TASK_SUCCESS = exports.DEDUPE_WAY_TASK_SUCCESS = 'DEDUPE_WAY_TASK_SUCCESS';
var DEDUPE_WAY_TASK_ERROR = exports.DEDUPE_WAY_TASK_ERROR = 'DEDUPE_WAY_TASK_ERROR';

/**
 * action creators
 */
var fetchWayTask = exports.fetchWayTask = function fetchWayTask(id) {
  return { type: FETCH_WAY_TASK, id: id };
};
var fetchNextWayTask = exports.fetchNextWayTask = function fetchNextWayTask() {
  return { type: FETCH_NEXT_WAY_TASK };
};
var fetchWayTaskSuccess = exports.fetchWayTaskSuccess = function fetchWayTaskSuccess(id, updatedAt, geoJSON) {
  return {
    type: FETCH_WAY_TASK_SUCCESS,
    id: id,
    updatedAt: updatedAt,
    geoJSON: geoJSON
  };
};
var fetchWayTaskError = exports.fetchWayTaskError = function fetchWayTaskError(error) {
  return { type: FETCH_WAY_TASK_ERROR, error: error };
};
var fetchWayTaskCount = exports.fetchWayTaskCount = function fetchWayTaskCount() {
  return { type: FETCH_WAY_TASK_COUNT };
};
var fetchWayTaskCountSuccess = exports.fetchWayTaskCountSuccess = function fetchWayTaskCountSuccess(count) {
  return { type: FETCH_WAY_TASK_COUNT_SUCCESS, count: count };
};
var fetchWayTaskCountError = exports.fetchWayTaskCountError = function fetchWayTaskCountError(count) {
  return { type: FETCH_WAY_TASK_COUNT_ERROR };
};
var markWayTaskPending = exports.markWayTaskPending = function markWayTaskPending() {
  return { type: MARK_WAY_TASK_PENDING };
};
var markWayTaskPendingSuccess = exports.markWayTaskPendingSuccess = function markWayTaskPendingSuccess() {
  return { type: MARK_WAY_TASK_PENDING_SUCCESS };
};
var markWayTaskPendingError = exports.markWayTaskPendingError = function markWayTaskPendingError() {
  return { type: MARK_WAY_TASK_PENDING_ERROR };
};
var skipTask = exports.skipTask = function skipTask(id) {
  return { type: SKIP_TASK, id: id };
};
var selectWayTaskProvince = exports.selectWayTaskProvince = function selectWayTaskProvince(provinceId) {
  return { type: SELECT_NEXT_WAY_TASK_PROVINCE, selectedProvince: provinceId };
};
var dedupeWayTask = exports.dedupeWayTask = function dedupeWayTask(taskId, wayIds, wayIdToKeep, dedupeId) {
  return { type: DEDUPE_WAY_TASK, taskId: taskId, wayIdsToDelete: wayIds, wayIdToKeep: wayIdToKeep, dedupeIdToApply: dedupeId };
};
var dedupeWayTaskSuccess = exports.dedupeWayTaskSuccess = function dedupeWayTaskSuccess() {
  return { type: DEDUPE_WAY_TASK_SUCCESS };
};
var dedupeWayTaskError = exports.dedupeWayTaskError = function dedupeWayTaskError(error) {
  return { type: DEDUPE_WAY_TASK_ERROR, error: error };
};

var fetchNextWayTaskEpic = exports.fetchNextWayTaskEpic = function fetchNextWayTaskEpic() {
  return function (dispatch, getState) {
    dispatch(fetchNextWayTask());

    var skipped = getState().waytasks.skipped;
    var selectedProvince = getState().waytasks.selectedProvince;

    var params = {};
    if (skipped.length) params['skip'] = skipped;
    if (selectedProvince) params['province'] = selectedProvince;

    var url = _config2.default.api + '/tasks/next';
    if (Object.keys(params).length) {
      url = url + '?' + Object.keys(params).map(function (key) {
        return key + '=' + params[key];
      }).join('&');
    }

    return fetch(url).then(function (response) {
      if (response.status === 404) {
        throw new Error('No tasks remaining');
      } else if (response.status >= 400) {
        throw new Error(response.statusText);
      }
      return response.json();
    }).then(function (json) {
      json.data.features.forEach(function (feature) {
        feature.properties._id = feature.meta.id;
        feature.properties.province = json.province;
      });
      dispatch(fetchWayTaskCountEpic());
      return dispatch(fetchWayTaskSuccess(json.id, json.updated_at, json.data));
    }, function (e) {
      console.error('Error requesting task', e);
      return dispatch(fetchWayTaskError(e));
    });
  };
};

var fetchWayTaskEpic = exports.fetchWayTaskEpic = function fetchWayTaskEpic(taskId) {
  return function (dispatch, getState) {
    dispatch(fetchWayTask(taskId));

    return fetch(_config2.default.api + '/tasks/' + taskId).then(function (response) {
      if (response.status >= 400) {
        throw new Error(response.statusText);
      }
      return response.json();
    }).then(function (_ref) {
      var id = _ref.id,
          data = _ref.data;

      data.features.forEach(function (feature) {
        feature.properties._id = feature.meta.id;
      });
      return dispatch(fetchWayTaskSuccess(id, data.updated_at, data));
    }, function (e) {
      console.error('Error reloading task', e);
      return dispatch(fetchWayTaskError());
    });
  };
};

var fetchWayTaskCountEpic = exports.fetchWayTaskCountEpic = function fetchWayTaskCountEpic() {
  return function (dispatch, getState) {
    dispatch(fetchWayTaskCount());
    var selectedProvince = getState().waytasks.selectedProvince;
    var url = selectedProvince ? _config2.default.api + '/tasks/count?province=' + selectedProvince : _config2.default.api + '/tasks/count';

    fetch(url).then(function (response) {
      if (response.status >= 400) {
        throw new Error(response.statusText);
      }
      return response.json();
    }).then(function (_ref2) {
      var count = _ref2.count;

      dispatch(fetchWayTaskCountSuccess(count));
    }, function (e) {
      console.error('Error requesting task count', e);
      dispatch(fetchWayTaskCountError());
    });
  };
};

var markWayTaskPendingEpic = exports.markWayTaskPendingEpic = function markWayTaskPendingEpic(wayIds) {
  return function (dispatch) {
    dispatch(markWayTaskPending());

    return fetch(_config2.default.api + '/tasks/pending', {
      method: 'PUT',
      body: new Blob([JSON.stringify({ way_ids: wayIds })], { type: 'application/json' })
    }).then(function (response) {
      if (response.status >= 400) {
        console.error('Error marking task as pending', response.statusText);
        dispatch(markWayTaskPendingError());
      }

      dispatch(markWayTaskPendingSuccess());
    });
  };
};

var dedupeWayTaskEpic = exports.dedupeWayTaskEpic = function dedupeWayTaskEpic(taskId, wayIds, wayIdToKeep, dedupeId) {
  return function (dispatch, getState) {
    dispatch(dedupeWayTask(taskId, wayIds, wayIdToKeep, dedupeId));
    // delete ways
    dispatch((0, _osm.deleteEntireWaysEpic)(taskId, wayIds)).then(function () {
      dispatch((0, _roads.editRoadIdEpic)(wayIdToKeep, dedupeId)).then(function () {
        dispatch(dedupeWayTaskSuccess);
      }).catch(function (err) {
        dispatch(dedupeWayTaskError(err));
      });
    });
  };
};
/**
 * reducer
 */

exports.default = function () {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
    status: 'complete',
    countStatus: 'complete',
    id: null,
    geoJSON: null,
    skipped: [],
    provinces: [],
    selectedProvince: null,
    dedupeTaskId: null,
    wayIdsToDelete: [],
    dedupeIdToApply: null,
    wayIdToKeep: null,
    osmChangeTaskId: null
  };
  var action = arguments[1];

  if (action.type === FETCH_WAY_TASK) {
    return Object.assign({}, state, {
      status: 'pending'
    });
  } else if (action.type === FETCH_NEXT_WAY_TASK) {
    return Object.assign({}, state, {
      status: 'pending'
    });
  } else if (action.type === FETCH_WAY_TASK_SUCCESS) {
    return Object.assign({}, state, {
      geoJSON: action.geoJSON,
      id: action.id,
      updatedAt: action.updatedAt,
      status: 'complete'
    });
  } else if (action.type === FETCH_WAY_TASK_ERROR) {
    return Object.assign({}, state, {
      status: action.error.message === 'No tasks remaining' ? 'No tasks remaining' : 'error'
    });
  } else if (action.type === FETCH_WAY_TASK_COUNT) {
    return Object.assign({}, state, {
      taskCount: action.count,
      countStatus: 'pending'
    });
  } else if (action.type === FETCH_WAY_TASK_COUNT_SUCCESS) {
    return Object.assign({}, state, {
      taskCount: action.count,
      countStatus: 'complete'
    });
  } else if (action.type === FETCH_WAY_TASK_COUNT_ERROR) {
    return Object.assign({}, state, {
      countStatus: 'error'
    });
  } else if (action.type === SKIP_TASK) {
    return Object.assign({}, state, {
      skipped: state.skipped.concat(action.id)
    });
  } else if (action.type === SELECT_NEXT_WAY_TASK_PROVINCE) {
    return Object.assign({}, state, {
      selectedProvince: action.selectedProvince
    });
  } else if (action.type === DEDUPE_WAY_TASK) {
    return Object.assign({}, state, {
      dedupeTaskId: action.taskId,
      wayIdsToDelete: action.wayIdsToDelete,
      dedupeIdToApply: action.dedupeIdToApply,
      wayIdToKeep: action.wayIdToKeep
    });
  } else if (action.type === _osm.REQUEST_OSM_CHANGE_SUCCESS) {
    return Object.assign({}, state, {
      osmChangeTaskId: action.taskId
    });
  }

  return state;
};

},{"../../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","./osm":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/osm.js","./roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/reducer.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _redux = require('redux');

var _reactRouterRedux = require('react-router-redux');

var _reduxFractal = require('redux-fractal');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _actionTypes = require('../actions/action-types');

var actions = _interopRequireWildcard(_actionTypes);

var _tasks = require('./modules/tasks');

var _tasks2 = _interopRequireDefault(_tasks);

var _osm = require('./modules/osm');

var _osm2 = _interopRequireDefault(_osm);

var _roads = require('./modules/roads');

var _roads2 = _interopRequireDefault(_roads);

var _roadCount = require('./modules/roadCount');

var _roadCount2 = _interopRequireDefault(_roadCount);

var _map = require('./modules/map');

var _map2 = _interopRequireDefault(_map);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var admins = function admins() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : { units: [], fetching: false, fetched: false };
  var action = arguments[1];

  switch (action.type) {
    case actions.REQUEST_ADMINS:
      console.log('REQUEST_ADMINS');
      state = _lodash2.default.cloneDeep(state);
      state.fetching = true;
      break;
    case actions.RECEIVE_ADMINS:
      console.log('RECEIVE_ADMINS');
      state = _lodash2.default.cloneDeep(state);
      state.units = action.json;
      state.fetching = false;
      state.fetched = true;
      break;
    case actions.CLEAR_ADMINS:
      state = _lodash2.default.cloneDeep(state);
      state.units = [];
      break;
  }
  return state;
};

var search = function search() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : { results: [], fetching: false, fetched: false, query: '', searching: false };
  var action = arguments[1];

  switch (action.type) {
    case actions.REQUEST_SEARCH_RESULTS:
      console.log('REQUEST_SEARCH_RESULTS');
      state = _lodash2.default.cloneDeep(state);
      state.fetching = true;
      state.query = action.query;
      state.searching = true;
      break;
    case actions.RECEIVE_SEARCH_RESULTS:
      console.log('RECEIVE_SEARCH_RESULTS');
      state = _lodash2.default.cloneDeep(state);
      state.results = action.json;
      state.fetching = false;
      break;
    case actions.CLEAN_SEARCH_RESULTS:
      console.log('CLEAN_SEARCH_RESULTS');
      state = _lodash2.default.cloneDeep(state);
      state.results = [];
      state.fetching = false;
      state.fetched = true;
      state.query = '';
      state.searching = false;
      break;
  }
  return state;
};

var defaultFieldVProMMsids = {
  fetching: false,
  fetched: false,
  ids: []
};

var fieldVProMMsids = function fieldVProMMsids() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultFieldVProMMsids;
  var action = arguments[1];

  switch (action.type) {
    case actions.REQUEST_VPROMMS_FIELD_IDS:
      state = _lodash2.default.cloneDeep(state);
      state.fetching = true;
      break;
    case actions.RECEIVE_VPROMMS_FIELD_IDS:
      state = _lodash2.default.cloneDeep(state);
      state.fetching = false;
      state.fetched = true;
      state.ids = action.json;
      break;
    case actions.REMOVE_VPROMMS_FIELD_IDS:
      return defaultFieldVProMMsids;
  }
  return state;
};

var exploreMapDefaultState = {
  layer: 'iri',
  showNoVpromms: true
};
var exploreMap = function exploreMap() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : exploreMapDefaultState;
  var action = arguments[1];

  var newState = _lodash2.default.cloneDeep(state);
  switch (action.type) {
    case actions.SELECT_EXPLORE_MAP_LAYER:
      newState.layer = action.layer;
      break;
    case actions.EXPLORE_MAP_SHOW_NO_VPROMMS:
      newState.showNoVpromms = action.bool;
      break;
  }
  return newState;
};

var defaultSearchType = {
  searchType: 'Admin'
};

var setSearchType = function setSearchType() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultSearchType;
  var action = arguments[1];

  switch (action.type) {
    case actions.SET_SEARCH_TYPE:
      state = _lodash2.default.cloneDeep(state);
      state.searchType = action.text;
      break;
  }
  return state;
};

var setFilteredVProMMs = function setFilteredVProMMs() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
  var action = arguments[1];

  switch (action.type) {
    case actions.SET_FILTERED_VPROMMS:
      state = _lodash2.default.cloneDeep(state);
      state = action.array;
      break;
  }
  return state;
};

var defaultProvinces = {
  fetching: false,
  fetched: false,
  data: {}
};

var provinces = function provinces() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultProvinces;
  var action = arguments[1];

  switch (action.type) {
    case actions.REQUEST_PROVINCES:
      state = _lodash2.default.cloneDeep(state);
      state.fetching = true;
      break;
    case actions.RECEIVE_PROVINCES:
      state = _lodash2.default.cloneDeep(state);
      state.fetching = false;
      state.fetched = true;
      state.data = action.json;
      break;
  }
  return state;
};

var defaultAdminInfo = {
  fetched: false,
  fetching: false,
  data: {}
};

var adminInfo = function adminInfo() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultAdminInfo;
  var action = arguments[1];

  switch (action.type) {
    case actions.REQUEST_ADMIN_INFO:
      state = _lodash2.default.cloneDeep(state);
      state.fetching = true;
      break;
    case actions.RECEIVE_ADMIN_INFO:
      state = _lodash2.default.cloneDeep(state);
      state.fetching = false;
      state.fetched = true;
      state.data = action.json;
      break;
    case actions.REMOVE_ADMIN_INFO:
      state = defaultAdminInfo;
      break;
  }
  return state;
};

exports.default = (0, _redux.combineReducers)({
  routing: _reactRouterRedux.routeReducer,
  local: _reduxFractal.localReducer,
  admins: admins,
  adminInfo: adminInfo,
  roads: _roads2.default,
  roadCount: _roadCount2.default,
  map: _map2.default,
  waytasks: _tasks2.default,
  osmChange: _osm2.default,
  search: search,
  exploreMap: exploreMap,
  provinces: provinces,
  setSearchType: setSearchType,
  setFilteredVProMMs: setFilteredVProMMs,
  fieldVProMMsids: fieldVProMMsids // TODO - delete
});

},{"../actions/action-types":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-types.js","./modules/map":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/map.js","./modules/osm":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/osm.js","./modules/roadCount":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roadCount.js","./modules/roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js","./modules/tasks":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/tasks.js","lodash":"lodash","react-router-redux":"react-router-redux","redux":"redux","redux-fractal":"redux-fractal"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/store.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _redux = require('redux');

var _reduxThunk = require('redux-thunk');

var _reduxThunk2 = _interopRequireDefault(_reduxThunk);

var _reactRouterRedux = require('react-router-redux');

var _reducer = require('./reducer');

var _reducer2 = _interopRequireDefault(_reducer);

var _reactRouter = require('react-router');

var _reduxLogger = require('redux-logger');

var _reduxLogger2 = _interopRequireDefault(_reduxLogger);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var middlewares = [(0, _reactRouterRedux.syncHistory)(_reactRouter.hashHistory), _reduxThunk2.default];

if ("staging" === 'staging') {
  middlewares.push(_reduxLogger2.default);
}
var composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || _redux.compose;

exports.default = (0, _redux.createStore)(_reducer2.default, composeEnhancers(_redux.applyMiddleware.apply(null, middlewares)));

},{"./reducer":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/reducer.js","react-router":"react-router","react-router-redux":"react-router-redux","redux":"redux","redux-logger":"redux-logger","redux-thunk":"redux-thunk"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/utils/line-colors.js":[function(require,module,exports){
'use strict';

module.exports = {
  'iri': {
    property: 'iri',
    type: 'exponential',
    colorSpace: 'lab',
    stops: [[3, '#8CCA1B'], [16, '#DA251D']]
  },
  'RouteShoot': {
    property: 'RouteShoot',
    type: 'nominal',
    stops: [false, '#808080']
  },
  'RoadLabPro': {
    property: 'RoadLabPro',
    type: 'nominal',
    stops: [false, '#808080']
  }
};

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/utils/to-osm.js":[function(require,module,exports){
'use strict';

module.exports.createModifyLineString = function (features) {
  var nodes = [];
  var ways = [];
  var nodesIndex = {};

  features.forEach(function (f) {
    var geometry = f.geometry,
        properties = f.properties;

    processExistingLineString(geometry.coordinates, properties, ways, nodes, nodesIndex);
  });
  var lastNodeId = -1;
  var changeset = {
    create: {
      node: nodes.map(function (n) {
        n.id = lastNodeId--;
        return {
          id: n.id,
          lat: n.lat,
          lon: n.lon
        };
      })
    },
    modify: {
      way: ways.map(function (w) {
        return {
          id: w.id,
          nd: w.nodes.map(function (wn) {
            return { ref: wn.id };
          }),
          tag: processTags(w.tags)
        };
      })
    }
  };
  return changeset;
};

function processTags(tags) {
  var res = [];
  for (var k in tags) {
    res.push({ k: k, v: tags[k] });
  }
  return res;
}

function processExistingLineString(coordinates, properties, ways, nodes, nodesIndex) {
  var props = Object.assign({}, properties);
  var id = props._id;
  delete props._id;
  var way = {
    tags: props,
    nodes: [],
    id: id
  };
  ways.push(way);

  coordinates.forEach(function (point) {
    var hash = getNodeHash(point);
    var node = nodesIndex[hash];
    if (!node) {
      node = emptyNode(point);
      nodes.push(node);
      nodesIndex[hash] = node;
    }
    way.nodes.push(node);
  });
}

function getNodeHash(coords) {
  return JSON.stringify(coords);
}

function emptyNode(coordinates) {
  return {
    lat: coordinates[1],
    lon: coordinates[0]
  };
}

},{}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/utils/zoom.js":[function(require,module,exports){
'use strict';

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

// Leaflet inspired implementation of extracting a midpoint and zoom level from a set of bounds //
var _require = require('global-mercator'),
    lngLatToMeters = _require.lngLatToMeters,
    metersToPixels = _require.metersToPixels;

/**
 * calculates tranformed pixel point from coordinate point
 * @param {object} geoCoordinate A geographic coordinate
 * @param {number} zoom current map zoom
 * @return {object} tranformed pixel coordinate
 */


var transformGeoToPixel = exports.transformGeoToPixel = function (geoCoordinate, zoom) {
  var meterCrds = lngLatToMeters([geoCoordinate.lng, geoCoordinate.lat]);
  var pixelCrd = metersToPixels(meterCrds, zoom);
  return {
    x: pixelCrd[0],
    y: pixelCrd[1]
  };
};

/**
 * generates object with pixel reprentation of distances between bounds' latitude and longitude extrema
 * @param {object} nwPixel northwest bounds coordinate as pixel coordinate
 * @param {object} sePixel southeastbounds coordinate as pixel coordinate
 * @return {object} object with pixel distances
 */
var pixelDistances = exports.pixelDistances = function (nwPixel, sePixel) {
  return {
    x: Math.abs(nwPixel.x - sePixel.x),
    y: Math.abs(nwPixel.y - sePixel.y)
  };
};

/**
 * returns max zoom for showing extent of the bounding box provided
 * @param {number} scale the scale factor used to calcualte the new zoom
 * @param {number} zoom the map's current zoom
 * @return {number} new zoom for bounds
 */
var makeNewZoom = exports.makeNewZoom = function (scale, zoom) {
  // the high level calculation for new zoom comes from:
  // https://github.com/Leaflet/Leaflet/blob/703ae02aa8cbd0b87be5b01e77754b83ad732267/src/geo/crs/CRS.js#L65
  // the high level calculation's components come from
  // https://github.com/Leaflet/Leaflet/blob/703ae02aa8cbd0b87be5b01e77754b83ad732267/src/map/Map.js#L893
  var scaledZoom = 256 * Math.pow(2, zoom);
  var scaledScaledZoom = scale * scaledZoom;
  var newZoom = Math.log(scaledScaledZoom / 256) / Math.LN2;
  // the maximum possible zoom is 24.
  return newZoom > 24 ? 24 : newZoom;
};

exports.bboxToLngLatZoom = function (_ref) {
  var _ref2 = _slicedToArray(_ref, 4),
      west = _ref2[0],
      south = _ref2[1],
      east = _ref2[2],
      north = _ref2[3];

  var lng = west + (east - west) / 2;
  var lat = south + (north - south) / 2;
  var xDimension = 1000;
  var yDimension = 500;
  var padding = 10;
  var zoom = 6;

  // TODO - this implementation shouldn't care about current zoom to calculate new zoom for bbox
  // hardcoding at 6 produces fine enough results, but it shouldn't be necessary
  // actually using current zoom produces bad/inconsistent results

  var _pixelDistances = pixelDistances(transformGeoToPixel({ lng: west, lat: north }, zoom), transformGeoToPixel({ lng: east, lat: south }, zoom)),
      xDistance = _pixelDistances.x,
      yDistance = _pixelDistances.y;

  var zoomScale = Math.min(xDimension / (xDistance + padding / 2), yDimension / (yDistance + padding / 2));
  var newZoom = makeNewZoom(zoomScale, zoom);

  return { lng: lng, lat: lat, zoom: newZoom };
};

},{"global-mercator":"global-mercator"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/app.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _recompose = require('recompose');

var _actionCreators = require('../actions/action-creators');

var _siteHeader = require('../components/site-header');

var _siteHeader2 = _interopRequireDefault(_siteHeader);

var _confirmationPrompt = require('../components/confirmation-prompt');

var _confirmationPrompt2 = _interopRequireDefault(_confirmationPrompt);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var App = _react2.default.createClass({
  displayName: 'App',

  propTypes: {
    _fetchSearchResults: _react2.default.PropTypes.func,
    _cleanSearchResults: _react2.default.PropTypes.func,
    search: _react2.default.PropTypes.object,
    routes: _react2.default.PropTypes.array,
    children: _react2.default.PropTypes.object,
    location: _react2.default.PropTypes.object
  },

  render: function render() {
    var pageClass = _lodash2.default.get(_lodash2.default.last(this.props.routes), 'pageClass', '');
    return _react2.default.createElement(
      'div',
      { className: 'site-canvas-inner ' + pageClass },
      _react2.default.createElement(_siteHeader2.default, null),
      _react2.default.createElement(
        'main',
        { className: 'site-body' },
        this.props.children
      ),
      _react2.default.createElement(_confirmationPrompt2.default, null)
    );
  }
});

exports.default = (0, _recompose.compose)((0, _reactRedux.connect)(function (state) {
  return {
    subregions: state.adminSubregions,
    search: state.search
  };
}, function (dispatch) {
  return {
    _fetchSearchResults: function _fetchSearchResults(query) {
      return dispatch((0, _actionCreators.fetchSearchResults)(query));
    },
    _cleanSearchResults: function _cleanSearchResults() {
      return dispatch((0, _actionCreators.cleanSearchResults)());
    }
  };
}), (0, _recompose.withContext)({ language: _react2.default.PropTypes.string }, function (_ref) {
  var language = _ref.params.lang;
  return { language: language };
}))(App);

},{"../actions/action-creators":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-creators.js","../components/confirmation-prompt":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/confirmation-prompt.js","../components/site-header":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/site-header.js","lodash":"lodash","react":"react","react-redux":"react-redux","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/assets-admin-area.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _recompose = require('recompose');

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

var _reactRouter = require('react-router');

var _roadTableContainer = require('../containers/road-table-container');

var _roadTableContainer2 = _interopRequireDefault(_roadTableContainer);

var _districtList = require('../components/district-list');

var _districtList2 = _interopRequireDefault(_districtList);

var _actionCreators = require('../actions/action-creators');

var _config = require('../config');

var _config2 = _interopRequireDefault(_config);

var _constants = require('../constants');

var _assetsCreate = require('../components/assets-create');

var _assetsCreate2 = _interopRequireDefault(_assetsCreate);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var renderAdminName = function renderAdminName(children, aaId, aaIdSub) {
  var adminName = aaIdSub ? children.find(function (child) {
    return child.id === Number(aaIdSub);
  }).name_en : _constants.ADMIN_MAP.province[aaId].name;

  return _react2.default.createElement(
    'h2',
    { className: 'incontainer__title' },
    adminName
  );
};

var AssetsAA = function (_React$Component) {
  _inherits(AssetsAA, _React$Component);

  function AssetsAA(props) {
    _classCallCheck(this, AssetsAA);

    var _this = _possibleConstructorReturn(this, (AssetsAA.__proto__ || Object.getPrototypeOf(AssetsAA)).call(this, props));

    _this.onCreateAssetClick = _this.onCreateAssetClick.bind(_this);

    _this.state = {
      createModalOpen: false
    };
    return _this;
  }

  _createClass(AssetsAA, [{
    key: 'componentWillMount',
    value: function componentWillMount() {
      this.props._fetchAdminInfo(this.props.params.aaId);
    }
  }, {
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (this.props.params.aaId !== nextProps.params.aaId) {
        this.props._fetchAdminInfo(nextProps.params.aaId);
      }
    }
  }, {
    key: 'onModalClose',
    value: function onModalClose() {
      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

      this.setState({ createModalOpen: false });
    }
  }, {
    key: 'onCreateAssetClick',
    value: function onCreateAssetClick(e) {
      e.preventDefault();
      this.setState({ createModalOpen: true });
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          adminInfoFetched = _props.adminInfoFetched,
          language = _props.language,
          children = _props.adminInfo.children,
          _props$params = _props.params,
          aaId = _props$params.aaId,
          aaIdSub = _props$params.aaIdSub;


      return _react2.default.createElement(
        'div',
        { className: 'incontainer' },
        _react2.default.createElement(
          'div',
          { className: 'incontainer__header' },
          _react2.default.createElement(
            'div',
            { className: 'incontainer__headline' },
            children && renderAdminName(children, aaId, aaIdSub),
            _react2.default.createElement(
              'ol',
              { className: 'incontainer__breadcrumb' },
              _react2.default.createElement(
                'li',
                null,
                _react2.default.createElement(
                  _reactRouter.Link,
                  { title: 'View', to: language + '/assets' },
                  'Overview'
                )
              ),
              aaIdSub && _react2.default.createElement(
                'li',
                null,
                _react2.default.createElement(
                  _reactRouter.Link,
                  { title: 'View', to: language + '/assets/' + aaId },
                  _constants.ADMIN_MAP.province[aaId].name
                )
              )
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'incontainer__hactions' },
            !aaIdSub && aaId && _react2.default.createElement(
              'a',
              { href: '' + _config2.default.provinceDumpBaseUrl + aaId + '.csv', className: 'ica-download' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Download'
              )
            ),
            _react2.default.createElement(_assetsCreate2.default, null)
          )
        ),
        _react2.default.createElement(
          'div',
          null,
          !aaIdSub && adminInfoFetched && _react2.default.createElement(_districtList2.default, {
            districts: children,
            aaId: aaId,
            language: language
          })
        ),
        _react2.default.createElement(_roadTableContainer2.default, null)
      );
    }
  }]);

  return AssetsAA;
}(_react2.default.Component);

if (_config2.default.environment !== 'production') {
  AssetsAA.propTypes = {
    _fetchAdminInfo: _react2.default.PropTypes.func,
    params: _react2.default.PropTypes.object,
    language: _react2.default.PropTypes.string,
    adminInfo: _react2.default.PropTypes.object,
    adminInfoFetched: _react2.default.PropTypes.bool
  };
}

//
//
//

exports.default = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), (0, _reactRedux.connect)(function (state) {
  return {
    adminInfo: state.adminInfo.data,
    adminInfoFetched: state.adminInfo.fetched
  };
}, function (dispatch) {
  return {
    _fetchAdminInfo: function _fetchAdminInfo(id, level) {
      return dispatch((0, _actionCreators.fetchAdminInfo)(id, level));
    }
  };
}))(AssetsAA);

},{"../actions/action-creators":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-creators.js","../components/assets-create":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/assets-create.js","../components/district-list":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/district-list.js","../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","../constants":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/constants.js","../containers/road-table-container":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/containers/road-table-container.js","react":"react","react-redux":"react-redux","react-router":"react-router","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/assets-detail.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _lodash = require('lodash');

var _recompose = require('recompose');

var _reduxFractal = require('redux-fractal');

var _redux = require('redux');

var _reactRouter = require('react-router');

var _bbox = require('@turf/bbox');

var _bbox2 = _interopRequireDefault(_bbox);

var _mapboxGl = require('mapbox-gl');

var _mapboxGl2 = _interopRequireDefault(_mapboxGl);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

var _dropdown = require('../components/dropdown');

var _dropdown2 = _interopRequireDefault(_dropdown);

var _assetsEditModal = require('../components/assets-edit-modal');

var _assetsEditModal2 = _interopRequireDefault(_assetsEditModal);

var _roads = require('../redux/modules/roads');

var _constants = require('../constants');

var _config = require('../config');

var _confirmationPrompt = require('../components/confirmation-prompt');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

_mapboxGl2.default.accessToken = _config.mbToken;

var AssetsDetail = function (_React$Component) {
  _inherits(AssetsDetail, _React$Component);

  function AssetsDetail(props) {
    _classCallCheck(this, AssetsDetail);

    var _this = _possibleConstructorReturn(this, (AssetsDetail.__proto__ || Object.getPrototypeOf(AssetsDetail)).call(this, props));

    _this.onEditDelete = _this.onEditDelete.bind(_this);
    _this.onEditProperties = _this.onEditProperties.bind(_this);
    _this.onModalClose = _this.onModalClose.bind(_this);

    _this.state = {
      layerRendered: false,
      editModalOpen: false
    };
    return _this;
  }

  _createClass(AssetsDetail, [{
    key: 'componentWillMount',
    value: function componentWillMount() {
      var _props = this.props,
          vpromm = _props.vpromm,
          fetchRoadProperty = _props.fetchRoadProperty,
          fetchRoadGeometry = _props.fetchRoadGeometry;

      fetchRoadProperty(vpromm);
      fetchRoadGeometry(vpromm);
    }
  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      var _this2 = this;

      this.map = new _mapboxGl2.default.Map({
        container: 'asset-map',
        center: [106.12774207395364, 16.185396038978936],
        zoom: 4,
        style: 'mapbox://styles/mapbox/light-v9',
        failIfMajorPerformanceCaveat: false
      });

      this.map.addControl(new _mapboxGl2.default.ScaleControl({ unit: 'metric' }));
      this.map.addControl(new _mapboxGl2.default.NavigationControl(), 'top-left');

      this.map.on('load', function () {
        _this2.setupMapStyle();
      });

      // Disable map rotation using right click + drag.
      this.map.dragRotate.disable();

      // Disable map rotation using touch rotation gesture.
      this.map.touchZoomRotate.disableRotation();

      // Remove compass.
      document.querySelector('.mapboxgl-ctrl .mapboxgl-ctrl-compass').remove();
    }
  }, {
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (this.props.vpromm !== nextProps.vpromm) {
        this.props.fetchRoadProperty(nextProps.vpromm);
        this.props.fetchRoadGeometry(nextProps.vpromm);
      }

      if (this.props.roadGeo.fetching && !nextProps.roadGeo.fetching && !nextProps.roadGeo.error) {
        this.setupMapStyle();
      }
    }
  }, {
    key: 'setupMapStyle',
    value: function setupMapStyle() {
      var _props$roadGeo = this.props.roadGeo,
          fetched = _props$roadGeo.fetched,
          data = _props$roadGeo.data;


      if (!fetched || this.map.getSource('road-geometry')) return;

      this.map.addSource('road-geometry', { type: 'geojson', data: data });
      this.map.addLayer({
        id: 'road-geometry-layer',
        type: 'line',
        source: 'road-geometry',
        paint: {
          'line-width': 4,
          'line-color': '#da251d'
        }
      });

      if (data.features.length > 0) {
        this.map.fitBounds((0, _bbox2.default)(data), { padding: 20 });
      }
    }
  }, {
    key: 'onModalClose',
    value: function onModalClose() {
      var _this3 = this;

      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

      this.setState({ editModalOpen: false });
      if (data.action === 'refresh') {
        // Why the setTimeout you ask?
        // For some reason redux-fractal doesn't play well with thunks.
        // It thinks that the action is being dispatched from a reducer and
        // throws an error. "Reducers may not dispatch actions."
        // This is meant to refresh the data after properties are saved.
        setTimeout(function () {
          _this3.props.fetchRoadProperty(_this3.props.vpromm);
        }, 0);
      } else if (data.action === 'redirect') {
        setTimeout(function () {
          _this3.props.router.push({ pathname: '/' + _this3.props.language + '/assets/road/' + data.vpromm + '/' });
        }, 0);
      }
    }
  }, {
    key: 'onEditProperties',
    value: function onEditProperties(e) {
      e.preventDefault();
      this.setState({ editModalOpen: true });
    }
  }, {
    key: 'onEditDelete',
    value: function onEditDelete(e) {
      var _this4 = this;

      e.preventDefault();
      (0, _confirmationPrompt.showConfirm)({
        title: 'Delete asset',
        body: _react2.default.createElement(
          'div',
          null,
          _react2.default.createElement(
            'p',
            null,
            _react2.default.createElement(
              _t2.default,
              null,
              'Are you sure you want to delete road ',
              _react2.default.createElement(
                'strong',
                null,
                this.props.vpromm
              ),
              '?',
              _react2.default.createElement('br', null),
              ' Note that this action is irreversible.'
            )
          )
        )
      }, function () {
        _this4.props.deleteRoad(_this4.props.vpromm);
        _this4.props.router.push({ pathname: '/' + _this4.props.language + '/assets' });
      });
    }
  }, {
    key: 'onStateChange',
    value: function () {
      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(status, e) {
        var res;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                e.preventDefault();

                _context.prev = 1;
                _context.next = 4;
                return this.props.editRoadStatus(this.props.vpromm, status);

              case 4:
                res = _context.sent;

                if (!res.error) {
                  _context.next = 7;
                  break;
                }

                throw new Error(res.error);

              case 7:
                _context.next = 12;
                break;

              case 9:
                _context.prev = 9;
                _context.t0 = _context['catch'](1);

                alert('An error occurred while saving. Please try again.');

              case 12:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this, [[1, 9]]);
      }));

      function onStateChange(_x2, _x3) {
        return _ref.apply(this, arguments);
      }

      return onStateChange;
    }()
  }, {
    key: 'hasGeometry',
    value: function hasGeometry() {
      var roadGeo = this.props.roadGeo;

      return roadGeo.fetched ? (0, _lodash.get)(roadGeo, 'data.features', []).length > 0 : true;
    }
  }, {
    key: 'renderProperties',
    value: function renderProperties() {
      var _props$roadProps = this.props.roadProps,
          fetched = _props$roadProps.fetched,
          data = _props$roadProps.data;


      if (!fetched) return null;

      var propNames = Object.keys(data.properties);
      propNames.sort(function (a, b) {
        return a.toLowerCase() > b.toLowerCase() ? 1 : -1;
      });

      var renderDlItem = function renderDlItem(name) {
        return [_react2.default.createElement(
          'dt',
          { key: 'dt-' + name },
          name
        ), _react2.default.createElement(
          'dd',
          { key: 'dd-' + name },
          data.properties[name] || '-'
        )];
      };

      return _react2.default.createElement(
        'section',
        null,
        _react2.default.createElement(
          'h3',
          null,
          'Attributes'
        ),
        propNames.length ? _react2.default.createElement(
          'dl',
          { className: 'attributes-list' },
          propNames.map(renderDlItem)
        ) : _react2.default.createElement(
          'div',
          { className: 'no-content no-content--attributes' },
          _react2.default.createElement(
            'p',
            null,
            _react2.default.createElement(
              _t2.default,
              null,
              'This asset doesn\'t have any attributes.'
            )
          ),
          _react2.default.createElement(
            'p',
            null,
            _react2.default.createElement(
              'a',
              { className: 'button button--base-raised-light', href: '#', onClick: this.onEditProperties },
              _react2.default.createElement(
                _t2.default,
                null,
                'Edit attributes'
              )
            )
          )
        )
      );
    }
  }, {
    key: 'renderReviewStatus',
    value: function renderReviewStatus() {
      var stateMap = {
        'pending': (0, _t.translate)(this.props.language, 'Pending'),
        'reviewed': (0, _t.translate)(this.props.language, 'Reviewed')
      };

      var reviewState = this.props.roadProps.data.status || 'pending';
      var triggerText = this.props.roadProps.fetched ? stateMap[reviewState] : 'Loading';
      var classForState = function classForState(state) {
        return (0, _classnames2.default)('drop__menu-item', { 'drop__menu-item--active': reviewState === state });
      };

      return _react2.default.createElement(
        _dropdown2.default,
        {
          className: 'review-status-menu',
          triggerClassName: 'button-review-status',
          triggerActiveClassName: 'button--active',
          triggerText: triggerText,
          triggerTitle: 'Change review state',
          direction: 'down',
          alignment: 'left' },
        _react2.default.createElement(
          'h3',
          { className: 'drop__title' },
          _react2.default.createElement(
            _t2.default,
            null,
            'Review status'
          )
        ),
        _react2.default.createElement(
          'ul',
          { className: 'drop__menu drop__menu--select' },
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              'a',
              { href: '#', className: classForState('pending'), onClick: this.onStateChange.bind(this, 'pending'), 'data-hook': 'dropdown:close' },
              stateMap['pending']
            )
          ),
          _react2.default.createElement(
            'li',
            null,
            _react2.default.createElement(
              'a',
              { href: '#', className: classForState('reviewed'), onClick: this.onStateChange.bind(this, 'reviewed'), 'data-hook': 'dropdown:close' },
              stateMap['reviewed']
            )
          )
        )
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var _props2 = this.props,
          vpromm = _props2.vpromm,
          language = _props2.language,
          roadProps = _props2.roadProps;


      var disId = (0, _lodash.get)(roadProps, 'data.district.id', null);
      var disName = (0, _lodash.get)(roadProps, 'data.district.name', null);
      var provId = (0, _lodash.get)(roadProps, 'data.province.id', null);
      var provName = (0, _lodash.get)(roadProps, 'data.province.name', null);
      var hasGeometry = this.hasGeometry();

      return _react2.default.createElement(
        'div',
        { className: 'incontainer' },
        _react2.default.createElement(
          'div',
          { className: 'incontainer__header' },
          _react2.default.createElement(
            'div',
            { className: 'incontainer__headline' },
            _react2.default.createElement(
              'h2',
              { className: 'incontainer__title' },
              vpromm
            ),
            _react2.default.createElement(
              'ol',
              { className: 'incontainer__breadcrumb' },
              _react2.default.createElement(
                'li',
                null,
                _react2.default.createElement(
                  _reactRouter.Link,
                  { title: 'View assets page', to: '/' + language + '/assets' },
                  'Overview'
                )
              ),
              provId && _react2.default.createElement(
                'li',
                null,
                _react2.default.createElement(
                  _reactRouter.Link,
                  { title: 'View province page', to: '/' + language + '/assets/' + provId },
                  provName
                )
              ),
              disId && _react2.default.createElement(
                'li',
                null,
                _react2.default.createElement(
                  _reactRouter.Link,
                  { title: 'View district page', to: '/' + language + '/assets/' + provId + '/' + disId },
                  disName
                )
              )
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'incontainer__hactions' },
            this.renderReviewStatus(),
            _react2.default.createElement(
              'a',
              { href: _config.api + '/properties/roads/' + vpromm + '.geojson?download', className: 'ica-download' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Download'
              )
            ),
            _react2.default.createElement(
              _dropdown2.default,
              {
                className: 'browse-menu',
                triggerClassName: 'ica-pencil ica-main',
                triggerActiveClassName: 'button--active',
                triggerText: 'Edit',
                triggerTitle: 'Toggle menu options',
                direction: 'down',
                alignment: 'right' },
              _react2.default.createElement(
                'ul',
                { className: 'drop__menu drop__menu--iconified edit-menu' },
                _react2.default.createElement(
                  'li',
                  null,
                  _react2.default.createElement(
                    'a',
                    { href: '#', className: 'drop__menu-item em-attributes', onClick: this.onEditProperties },
                    'Attributes'
                  )
                ),
                _react2.default.createElement(
                  'li',
                  null,
                  _react2.default.createElement(
                    _reactRouter.Link,
                    { to: '/' + language + '/editor?way=w' + roadProps.data.way_id, className: (0, _classnames2.default)('drop__menu-item em-geometry', { disabled: !hasGeometry }), disabled: !hasGeometry },
                    'Geometry'
                  )
                )
              ),
              _react2.default.createElement(
                'ul',
                { className: 'drop__menu drop__menu--iconified' },
                _react2.default.createElement(
                  'li',
                  null,
                  _react2.default.createElement(
                    'a',
                    { href: '#', className: 'drop__menu-item em-delete', onClick: this.onEditDelete },
                    'Delete'
                  )
                )
              )
            )
          )
        ),
        _react2.default.createElement(
          'figure',
          { className: 'map map--detail' },
          _react2.default.createElement('div', { className: 'map__media', id: 'asset-map' }),
          !hasGeometry ? _react2.default.createElement(
            'div',
            { className: 'no-content no-content--geometry' },
            _react2.default.createElement(
              'p',
              null,
              _react2.default.createElement(
                _t2.default,
                null,
                'This asset doesn\'t have geometry.'
              )
            ),
            _react2.default.createElement(
              'p',
              null,
              _react2.default.createElement(
                _reactRouter.Link,
                { to: '/' + language + '/upload', className: 'button button--achromic-glass' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'Upload geometry'
                )
              )
            )
          ) : null,
          _react2.default.createElement(
            'figcaption',
            { className: 'map__caption' },
            _react2.default.createElement(
              'p',
              null,
              _react2.default.createElement(
                _t2.default,
                null,
                'Asset geometry'
              )
            )
          )
        ),
        this.renderProperties(),
        this.props.roadProps.fetched ? _react2.default.createElement(_assetsEditModal2.default, {
          revealed: this.state.editModalOpen,
          onCloseClick: this.onModalClose,
          opOnRoadProperty: this.props.opOnRoadProperty,
          editRoad: this.props.editRoad,
          vpromm: vpromm,
          roadPropsOp: this.props.roadPropsOp,
          roadProps: this.props.roadProps }) : null
      );
    }
  }]);

  return AssetsDetail;
}(_react2.default.Component);

if (_config.environment !== 'production') {
  AssetsDetail.propTypes = {
    vpromm: _react.PropTypes.string,
    router: _react.PropTypes.object,
    roadGeo: _react.PropTypes.object,
    roadProps: _react.PropTypes.object,
    roadPropsOp: _react.PropTypes.object,
    language: _react.PropTypes.string,
    fetchRoadProperty: _react.PropTypes.func,
    fetchRoadGeometry: _react.PropTypes.func,
    deleteRoad: _react.PropTypes.func,
    opOnRoadProperty: _react.PropTypes.func,
    editRoad: _react.PropTypes.func,
    editRoadStatus: _react.PropTypes.func
  };
}

//
//
//

// Road properties state and reducer.
var stateRoadProps = {
  fetched: false,
  fetching: false,
  data: {}
};

var reducerRoadProps = function reducerRoadProps() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : stateRoadProps;
  var action = arguments[1];

  switch (action.type) {
    case _roads.FETCH_ROAD_PROPERTY:
      return _extends({}, state, { fetching: true, fetched: false, error: false });
    case _roads.FETCH_ROAD_PROPERTY_ERROR:
      return _extends({}, state, { fetching: false, fetched: true, error: true });
    case _roads.FETCH_ROAD_PROPERTY_SUCCESS:
      return _extends({}, state, { fetching: false, fetched: true, data: action.properties });
    case _roads.EDIT_ROAD_STATUS_SUCCESS:
      return _extends({}, state, { data: _extends({}, state.data, { status: action.value }) });
  }

  return state;
};

// Road geometry state and reducer.
var stateRoadGeo = {
  fetched: false,
  fetching: false,
  data: {}
};

var reducerRoadGeo = function reducerRoadGeo() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : stateRoadGeo;
  var action = arguments[1];

  switch (action.type) {
    case _roads.FETCH_ROAD_GEOMETRY:
      return _extends({}, state, { fetching: true, fetched: false, error: false });
    case _roads.FETCH_ROAD_GEOMETRY_ERROR:
      return _extends({}, state, { fetching: false, fetched: true, error: true });
    case _roads.FETCH_ROAD_GEOMETRY_SUCCESS:
      return _extends({}, state, { fetching: false, fetched: true, data: action.geoJSON });
  }

  return state;
};

// Road operations state and reducer.
// Handles operations done to the properties.
var stateOpOnRoad = {
  processing: false,
  data: {}
};

var reducerOpOnRoad = function reducerOpOnRoad() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : stateOpOnRoad;
  var action = arguments[1];

  switch (action.type) {
    case _roads.OP_ON_ROAD_PROPERTY:
      return _extends({}, state, { processing: true, error: false });
    case _roads.OP_ON_ROAD_PROPERTY_SUCCESS:
      return _extends({}, state, { processing: false, error: false, data: action.data });
    case _roads.OP_ON_ROAD_PROPERTY_ERROR:
      return _extends({}, state, { processing: false, error: true });
  }

  return state;
};

var reducer = (0, _redux.combineReducers)({
  properties: reducerRoadProps,
  geometry: reducerRoadGeo,
  operations: reducerOpOnRoad
});

// Notes:
// The state for each road is handled locally with redux-fractal.
// The data from the api is also saved in the global state but since each
// mapStateToProps (either local() or connect()) causes a render is difficult
// to merge both therefore we're handling everything here.
exports.default = (0, _recompose.compose)(_reactRouter.withRouter, (0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), (0, _recompose.withProps)(function (_ref2) {
  var language = _ref2.language,
      vpromm = _ref2.params.vpromm;

  var _find = (0, _lodash.find)((0, _lodash.toPairs)(_constants.ADMIN_MAP.province), function (_ref3) {
    var _ref4 = _slicedToArray(_ref3, 2),
        aaId = _ref4[0],
        id = _ref4[1].id;

    return id === vpromm.substring(0, 2);
  }),
      _find2 = _slicedToArray(_find, 2),
      aaId = _find2[0],
      name = _find2[1].name;

  return {
    vpromm: vpromm,
    provinceName: name,
    aaId: aaId
  };
}), (0, _reduxFractal.local)({
  key: function key(_ref5) {
    var vpromm = _ref5.vpromm;
    return vpromm + '-road-map';
  },
  createStore: function createStore() {
    return (0, _redux.createStore)(reducer);
  },
  mapStateToProps: function mapStateToProps(state) {
    return {
      roadProps: state.properties,
      roadGeo: state.geometry,
      roadPropsOp: state.operations
    };
  },
  filterGlobalActions: function filterGlobalActions(_ref6) {
    var type = _ref6.type;
    return [_roads.FETCH_ROAD_GEOMETRY, _roads.FETCH_ROAD_GEOMETRY_SUCCESS, _roads.FETCH_ROAD_GEOMETRY_ERROR, _roads.FETCH_ROAD_PROPERTY, _roads.FETCH_ROAD_PROPERTY_SUCCESS, _roads.FETCH_ROAD_PROPERTY_ERROR, _roads.OP_ON_ROAD_PROPERTY, _roads.OP_ON_ROAD_PROPERTY_SUCCESS, _roads.OP_ON_ROAD_PROPERTY_ERROR, _roads.EDIT_ROAD_STATUS_SUCCESS].indexOf(type) > -1;
  }
}), (0, _reactRedux.connect)(function (state, props) {
  return {};
}, function (dispatch) {
  return {
    fetchRoadGeometry: function fetchRoadGeometry() {
      return dispatch(_roads.fetchRoadGeometryEpic.apply(undefined, arguments));
    },
    fetchRoadProperty: function fetchRoadProperty() {
      return dispatch(_roads.fetchRoadPropertyEpic.apply(undefined, arguments));
    },
    opOnRoadProperty: function opOnRoadProperty() {
      return dispatch(_roads.opOnRoadPropertyEpic.apply(undefined, arguments));
    },
    deleteRoad: function deleteRoad() {
      return dispatch(_roads.deleteRoadEpic.apply(undefined, arguments));
    },
    editRoad: function editRoad() {
      return dispatch(_roads.editRoadEpic.apply(undefined, arguments));
    },
    editRoadStatus: function editRoadStatus() {
      return dispatch(_roads.editRoadStatusEpic.apply(undefined, arguments));
    }
  };
}))(AssetsDetail);

},{"../components/assets-edit-modal":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/assets-edit-modal.js","../components/confirmation-prompt":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/confirmation-prompt.js","../components/dropdown":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/dropdown.js","../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","../constants":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/constants.js","../redux/modules/roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js","@turf/bbox":"@turf/bbox","classnames":"classnames","lodash":"lodash","mapbox-gl":"mapbox-gl","react":"react","react-redux":"react-redux","react-router":"react-router","recompose":"recompose","redux":"redux","redux-fractal":"redux-fractal"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/assets-index.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _recompose = require('recompose');

var _lodash = require('lodash');

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

var _actionCreators = require('../actions/action-creators');

var _roadCount = require('../redux/modules/roadCount');

var _provinceTableContainer = require('../containers/province-table-container');

var _provinceTableContainer2 = _interopRequireDefault(_provinceTableContainer);

var _constants = require('../constants');

var _assetsCreate = require('../components/assets-create');

var _assetsCreate2 = _interopRequireDefault(_assetsCreate);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var AssetsIndex = function AssetsIndex(_ref) {
  var provinces = _ref.provinces,
      provincesFetched = _ref.provincesFetched,
      provincesRoadCount = _ref.provincesRoadCount,
      totalRoadCount = _ref.totalRoadCount,
      osmRoadCount = _ref.osmRoadCount,
      provincesRoadCountStatus = _ref.provincesRoadCountStatus;

  return _react2.default.createElement(
    'div',
    { className: 'incontainer' },
    _react2.default.createElement(
      'div',
      { className: 'incontainer__header' },
      _react2.default.createElement(
        'div',
        { className: 'incontainer__headline' },
        _react2.default.createElement(
          'h2',
          { className: 'incontainer__title' },
          _react2.default.createElement(
            _t2.default,
            null,
            'Overview'
          )
        )
      ),
      _react2.default.createElement(
        'div',
        { className: 'incontainer__hactions' },
        _react2.default.createElement(_assetsCreate2.default, null)
      )
    ),
    provincesRoadCountStatus === 'complete' && _react2.default.createElement(
      'div',
      { className: 'a-main__status' },
      _react2.default.createElement(
        'h2',
        null,
        _react2.default.createElement(
          'strong',
          null,
          (osmRoadCount / totalRoadCount).toFixed(2),
          '% '
        ),
        _react2.default.createElement(
          _t2.default,
          null,
          'of VPRoMMS Ids have field data collected'
        ),
        ' (',
        osmRoadCount,
        ' of ',
        totalRoadCount,
        ')'
      ),
      _react2.default.createElement(
        'div',
        { className: 'meter' },
        _react2.default.createElement('div', { className: 'meter__internal', style: { width: osmRoadCount / totalRoadCount + '%' } })
      )
    ),
    provincesFetched && provincesRoadCountStatus === 'complete' && _react2.default.createElement(_provinceTableContainer2.default, {
      provinces: provinces.filter(function (province) {
        return _constants.ADMIN_MAP.province[province.id];
      }),
      provincesRoadCount: provincesRoadCount
    })
  );
};

var fetchData = function fetchData(_ref2) {
  var provinces = _ref2.provinces,
      provincesRoadCount = _ref2.provincesRoadCount,
      provincesRoadCountStatus = _ref2.provincesRoadCountStatus,
      fetchProvinces = _ref2.fetchProvinces,
      fetchRoadCount = _ref2.fetchRoadCount;

  if (!provinces) {
    fetchProvinces();
  }

  if (!provincesRoadCount && provincesRoadCountStatus !== 'pending' && provincesRoadCountStatus !== 'error') {
    fetchRoadCount();
  }
};

exports.default = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), (0, _reactRedux.connect)(function (state) {
  return {
    provinces: state.provinces.data.province,
    provincesFetched: state.provinces.fetched,
    provincesRoadCount: state.roadCount.provinces.provinceCount,
    provincesRoadCountStatus: state.roadCount.provinces.status
  };
}, function (dispatch) {
  return {
    fetchProvinces: function fetchProvinces() {
      return dispatch((0, _actionCreators.fetchProvinces)());
    },
    fetchRoadCount: function fetchRoadCount() {
      return dispatch((0, _roadCount.fetchProvincesRoadCountEpic)());
    }
  };
}), (0, _recompose.lifecycle)({
  componentWillMount: function componentWillMount() {
    fetchData(this.props);
  },
  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    fetchData(nextProps);
  }
}), (0, _recompose.withProps)(function (_ref3) {
  var provincesRoadCount = _ref3.provincesRoadCount,
      provincesRoadCountStatus = _ref3.provincesRoadCountStatus;

  if (provincesRoadCount) {
    return {
      totalRoadCount: (0, _lodash.reduce)(provincesRoadCount, function (total, _ref4) {
        var count = _ref4.count;
        return total + count;
      }, 0),
      osmRoadCount: (0, _lodash.reduce)(provincesRoadCount, function (total, _ref5) {
        var osmCount = _ref5.osmCount;
        return total + osmCount;
      }, 0)
    };
  }

  return {};
}))(AssetsIndex);

},{"../actions/action-creators":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-creators.js","../components/assets-create":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/assets-create.js","../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../constants":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/constants.js","../containers/province-table-container":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/containers/province-table-container.js","../redux/modules/roadCount":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roadCount.js","lodash":"lodash","react":"react","react-redux":"react-redux","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/assets.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Assets = function Assets(_ref) {
  var children = _ref.children;
  return _react2.default.createElement(
    'section',
    { className: 'inpage' },
    _react2.default.createElement(
      'header',
      { className: 'inpage__header' },
      _react2.default.createElement(
        'div',
        { className: 'inner' },
        _react2.default.createElement(
          'div',
          { className: 'inpage__headline' },
          _react2.default.createElement(
            'h1',
            { className: 'inpage__title' },
            _react2.default.createElement(
              _t2.default,
              null,
              'Assets'
            )
          )
        )
      )
    ),
    _react2.default.createElement(
      'div',
      { className: 'inpage__body' },
      _react2.default.createElement(
        'div',
        { className: 'inner' },
        children
      )
    )
  );
};

exports.default = Assets;

},{"../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/demo.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactBootstrapTable = require('react-bootstrap-table');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var products = [];

var selectRowProp = {
  mode: 'checkbox',
  bgColor: 'rgb(238, 193, 213)'
};

function addProducts(quantity) {
  var startId = products.length;
  for (var i = 0; i < quantity; i++) {
    var id = startId + i;
    products.push({
      id: id,
      name: 'Item name ' + id,
      price: 2100 + i,
      coupon: 'yes',
      status: 'no',
      customer: 'Customer' + i,
      order: i
    });
  }
}

addProducts(15);

var cellEditProp = {
  mode: 'click',
  blurToSave: true
};

var ClickToEditTable = function (_React$Component) {
  _inherits(ClickToEditTable, _React$Component);

  function ClickToEditTable() {
    _classCallCheck(this, ClickToEditTable);

    return _possibleConstructorReturn(this, (ClickToEditTable.__proto__ || Object.getPrototypeOf(ClickToEditTable)).apply(this, arguments));
  }

  _createClass(ClickToEditTable, [{
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'div',
        { className: 'content' },
        _react2.default.createElement(
          _reactBootstrapTable.BootstrapTable,
          { data: products, cellEdit: cellEditProp, selectRow: selectRowProp,
            deleteRow: true,
            exportCSV: true },
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '0', rowSpan: '2', dataField: 'id', isKey: true },
            'ID'
          ),
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '0', colSpan: '3', dataSort: true, csvHeader: 'Product', headerAlign: 'center' },
            'Product'
          ),
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '1', dataField: 'name', width: '175', dataAlign: 'center' },
            'name'
          ),
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '1', dataField: 'price', dataSort: true },
            'price'
          ),
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '1', dataField: 'coupon', width: '70' },
            'Coupon'
          ),
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '0', csvHeader: 'In stock', rowSpan: '2', headerAlign: 'center', dataField: 'status' },
            'In stock'
          ),
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '0', colSpan: '2', csvHeader: 'Customer', headerAlign: 'center', filter: { type: 'TextFilter', delay: 1000 } },
            'Customer'
          ),
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '1', csvHeader: 'name', headerAlign: 'center', dataField: 'customer' },
            'name'
          ),
          _react2.default.createElement(
            _reactBootstrapTable.TableHeaderColumn,
            { row: '1', csvHeader: 'order', headerAlign: 'center', dataField: 'order', dataSort: true },
            'order'
          )
        )
      );
    }
  }]);

  return ClickToEditTable;
}(_react2.default.Component);

exports.default = ClickToEditTable;

},{"react":"react","react-bootstrap-table":"react-bootstrap-table"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/editor.js":[function(require,module,exports){
'use strict';

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _recompose = require('recompose');

var _mapSearch = require('../components/map-search');

var _mapSearch2 = _interopRequireDefault(_mapSearch);

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

var _map = require('../redux/modules/map');

var _config = require('../config');

var _config2 = _interopRequireDefault(_config);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Editor = _react2.default.createClass({
  displayName: 'Editor',

  propTypes: {
    setMapPosition: _react2.default.PropTypes.func,
    lng: _react2.default.PropTypes.number,
    lat: _react2.default.PropTypes.number,
    zoom: _react2.default.PropTypes.number,
    language: _react2.default.PropTypes.string.isRequired,
    way: _react2.default.PropTypes.string
  },

  // /////////////////////////////////////////////////////////////////////////////
  // / Message listener (postMessage)
  // /
  // / When receiving a message form the iframe, process the url and set it.
  // / The url now becomes shareable. The action to take on the url will depend on
  // / the app.
  // /
  // / The switch is done based on the app id, defined when the OR_frame_notifier
  // / is included.
  // /
  // /
  // / What this actually does:
  // / When a the iframe's url changes it is sent via postMessage to the parent. It
  // / removes the base portion on the url (defined in the config) and stores
  // / the rest:
  // / - Url on the "editor" changes to:
  // /     http://devseed.com/editor/#background=something
  // / - Prefix is removed resulting in:
  // /     #background=something
  // / - Appended to the current url:
  // /     http://devseed.com/openroads/#/editor/background=something
  // / - When entering the page, everything after (/#/editor/)
  // /   is sent to the iframe alongside the proper prefix.
  // /
  messageListener: function messageListener(e) {
    if (e.data.type === 'urlchange') {
      switch (e.data.id) {
        case 'or-editor':
          this.hash = e.data.url.replace(new RegExp('(http:|https:)?' + _config2.default.editorUrl + '/?#?'), '');
          // TODO: reconcile how params are surfaced upto the app. don't dispatch anything upto the app for now.
          // this.props.dispatch(replace(`/${this.props.language}/editor/${this.hash}`));
          break;
      }
    } else if (e.data.type === 'navigate') {
      switch (e.data.id) {
        case 'or-editor':
          // TODO: reconcile how params are surfaced upto the app. don't dispatch anything upto the app for now.
          // this.props.dispatch(push(e.data.url));
          break;
      }
    }
  },

  componentDidMount: function componentDidMount() {
    this.hash = '';
    window.addEventListener('message', this.messageListener, false);
  },

  componentWillReceiveProps: function componentWillReceiveProps(_ref) {
    var lng = _ref.lng,
        lat = _ref.lat,
        zoom = _ref.zoom,
        way = _ref.way;

    this.props.setMapPosition(lng, lat, zoom, way);
  },

  componentWillUnmount: function componentWillUnmount() {
    window.removeEventListener('message', this.messageListener, false);

    var mapPositionHash = /[0-9.]+\/[0-9.]+\/[0-9.]+$/.exec(this.hash);
    if (mapPositionHash && mapPositionHash[0] && mapPositionHash[0].split('/').length === 3) {
      var _mapPositionHash$0$sp = mapPositionHash[0].split('/').map(Number),
          _mapPositionHash$0$sp2 = _slicedToArray(_mapPositionHash$0$sp, 3),
          zoom = _mapPositionHash$0$sp2[0],
          lng = _mapPositionHash$0$sp2[1],
          lat = _mapPositionHash$0$sp2[2];

      this.props.setMapPosition(lng, lat, zoom);
    }
  },

  render: function render() {
    var _props = this.props,
        lng = _props.lng,
        lat = _props.lat,
        way = _props.way;

    var zoom = way ? 16 : this.props.zoom;
    return _react2.default.createElement(
      'section',
      { className: 'inpage inpage--alt' },
      _react2.default.createElement(
        'header',
        { className: 'inpage__header' },
        _react2.default.createElement(
          'div',
          { className: 'inner' },
          _react2.default.createElement(
            'div',
            { className: 'inpage__headline' },
            _react2.default.createElement(
              'h1',
              { className: 'inpage__title' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Editor'
              )
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'inpage__actions' },
            _react2.default.createElement(_mapSearch2.default, null)
          )
        )
      ),
      _react2.default.createElement(
        'div',
        { className: 'inpage__body' },
        _react2.default.createElement(
          'div',
          { className: 'inner' },
          _react2.default.createElement(
            'figure',
            { className: 'map' },
            _react2.default.createElement('iframe', {
              className: 'map__media',
              src: _config2.default.editorUrl + '/#id=' + way + '&map=' + zoom + '/' + lng + '/' + lat,
              id: 'main-frame',
              name: 'main-frame',
              ref: 'iframe'
            })
          )
        )
      )
    );
  }
});

module.exports = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), (0, _reactRedux.connect)(function (state) {
  return {
    lng: state.map.lng || 108.239,
    lat: state.map.lat || 15.930,
    zoom: state.map.zoom || 6,
    way: state.map.waySlug
  };
}, function (dispatch) {
  return {
    setMapPosition: function setMapPosition(lng, lat, zoom, way) {
      return dispatch((0, _map.setMapPosition)(lng, lat, zoom, way));
    }
  };
}))(Editor);

},{"../components/map-search":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/map-search.js","../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","../redux/modules/map":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/map.js","react":"react","react-redux":"react-redux","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/explore.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _recompose = require('recompose');

var _mapboxGl = require('mapbox-gl');

var _mapboxGl2 = _interopRequireDefault(_mapboxGl);

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

var _config = require('../config');

var _config2 = _interopRequireDefault(_config);

var _lineColors = require('../utils/line-colors');

var _lineColors2 = _interopRequireDefault(_lineColors);

var _actionCreators = require('../actions/action-creators');

var _map = require('../redux/modules/map');

var _roads = require('../redux/modules/roads');

var _mapSearch = require('../components/map-search');

var _mapSearch2 = _interopRequireDefault(_mapSearch);

var _mapOptions = require('../components/map-options');

var _mapOptions2 = _interopRequireDefault(_mapOptions);

var _mapLegend = require('../components/map-legend');

var _mapLegend2 = _interopRequireDefault(_mapLegend);

var _reactRouter = require('react-router');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Explore = _react2.default.createClass({
  displayName: 'Explore',

  propTypes: {
    layer: _react2.default.PropTypes.string,
    activeRoad: _react2.default.PropTypes.string,
    lng: _react2.default.PropTypes.number,
    lat: _react2.default.PropTypes.number,
    zoom: _react2.default.PropTypes.number,
    selectExploreMapLayer: _react2.default.PropTypes.func,
    exploreMapShowNoVpromms: _react2.default.PropTypes.func,
    setMapPosition: _react2.default.PropTypes.func,
    fetchActiveRoad: _react2.default.PropTypes.func
  },

  componentDidMount: function componentDidMount() {
    var _this = this;

    _mapboxGl2.default.accessToken = _config2.default.mbToken;

    var _props = this.props,
        lng = _props.lng,
        lat = _props.lat,
        zoom = _props.zoom,
        activeRoad = _props.activeRoad;


    if (activeRoad) {
      this.props.fetchActiveRoad(activeRoad);
    }

    this.map = new _mapboxGl2.default.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v9',
      failIfMajorPerformanceCaveat: false,
      center: [lng, lat],
      zoom: zoom
    });

    this.map.addControl(new _mapboxGl2.default.NavigationControl(), 'top-left');

    // Disable map rotation using right click + drag.
    this.map.dragRotate.disable();

    // Disable map rotation using touch rotation gesture.
    this.map.touchZoomRotate.disableRotation();

    // Remove compass.
    document.querySelector('.mapboxgl-ctrl .mapboxgl-ctrl-compass').remove();

    this.map.on('load', function () {
      // Load all roads with VPRoMMS values, and color by IRI
      _this.map.addLayer({
        id: 'active_road',
        type: 'line',
        source: {
          type: 'vector',
          url: 'mapbox://openroads.vietnam-conflated-1'
        },
        'source-layer': 'conflated',
        paint: {
          'line-width': 20,
          'line-color': '#D3D3D3'
        },
        layout: { 'line-cap': 'round' },
        filter: ['==', 'or_vpromms', activeRoad]
      }).addLayer({
        id: 'novpromm',
        type: 'line',
        source: {
          type: 'vector',
          url: 'mapbox://openroads.vietnam-conflated-1'
        },
        'source-layer': 'conflated',
        paint: {
          'line-width': ['interpolate', ['linear'], ['zoom'], 0, 1, 10, 2]
        },
        layout: { 'line-cap': 'round' },
        filter: ['!has', 'or_vpromms'],
        maxzoom: 11
      }).addLayer({
        id: 'novpromm_dashed',
        type: 'line',
        source: {
          type: 'vector',
          url: 'mapbox://openroads.vietnam-conflated-1'
        },
        'source-layer': 'conflated',
        paint: {
          'line-width': ['interpolate', ['linear'], ['zoom'], 0, 1, 10, 2],
          'line-dasharray': [1, 2, 1]
        },
        layout: { 'line-cap': 'round' },
        filter: ['!has', 'or_vpromms'],
        minzoom: 10
      }).addLayer({
        id: 'vpromm',
        type: 'line',
        source: {
          type: 'vector',
          url: 'mapbox://openroads.vietnam-conflated-1'
        },
        'source-layer': 'conflated',
        paint: {
          'line-width': ['interpolate', ['linear'], ['zoom'], 0, 1, 10, 2]
        },
        layout: { 'line-cap': 'round' },
        filter: ['has', 'or_vpromms']
      }).setPaintProperty('novpromm', 'line-color', _lineColors2.default['iri']).setPaintProperty('novpromm_dashed', 'line-color', _lineColors2.default['iri']).setPaintProperty('vpromm', 'line-color', _lineColors2.default['iri']);
    });
  },

  componentWillReceiveProps: function componentWillReceiveProps(_ref) {
    var lng = _ref.lng,
        lat = _ref.lat,
        zoom = _ref.zoom,
        activeRoad = _ref.activeRoad;

    if (lng !== this.props.lng || lat !== this.props.lat || zoom !== this.props.zoom) {
      this.map.flyTo({ center: [lng, lat], zoom: zoom });
    }

    if (activeRoad !== this.props.activeRoad) {
      this.map.setFilter('active_road', ['==', 'or_vpromms', activeRoad]);
      this.props.fetchActiveRoad(activeRoad);
    }
  },

  componentWillUnmount: function componentWillUnmount() {
    var _map$getCenter = this.map.getCenter(),
        lng = _map$getCenter.lng,
        lat = _map$getCenter.lat;

    var zoom = this.map.getZoom();
    this.props.setMapPosition(lng, lat, zoom);
  },

  handleLayerChange: function handleLayerChange(_ref2) {
    var value = _ref2.target.value;

    this.props.selectExploreMapLayer(value);
    this.map.setPaintProperty('conflated', 'line-color', _lineColors2.default[value]);
  },

  handleShowNoVpromms: function handleShowNoVpromms(_ref3) {
    var checked = _ref3.target.checked;

    this.props.exploreMapShowNoVpromms(checked);

    if (checked) {
      this.map.setLayoutProperty('novpromm', 'visibility', 'visible');
      this.map.setLayoutProperty('novpromm_dashed', 'visibility', 'visible');
    } else {
      this.map.setLayoutProperty('novpromm', 'visibility', 'none');
      this.map.setLayoutProperty('novpromm_dashed', 'visibility', 'none');
    }
  },

  render: function render() {
    return _react2.default.createElement(
      'section',
      { className: 'inpage inpage--alt' },
      _react2.default.createElement(
        'header',
        { className: 'inpage__header' },
        _react2.default.createElement(
          'div',
          { className: 'inner' },
          _react2.default.createElement(
            'div',
            { className: 'inpage__headline' },
            _react2.default.createElement(
              'h1',
              { className: 'inpage__title' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Explore'
              )
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'inpage__actions' },
            _react2.default.createElement(_mapSearch2.default, null)
          )
        )
      ),
      _react2.default.createElement(
        'div',
        { className: 'inpage__body' },
        _react2.default.createElement(
          'div',
          { className: 'inner' },
          _react2.default.createElement(
            'figure',
            { className: 'map' },
            _react2.default.createElement('div', { className: 'map__media', id: 'map' }),
            _react2.default.createElement(
              'div',
              { className: 'map__controls map__controls--top-right' },
              _react2.default.createElement(_mapOptions2.default, {
                handleLayerChange: this.handleLayerChange,
                handleShowNoVpromms: this.handleShowNoVpromms
              })
            ),
            _react2.default.createElement(
              'div',
              { className: 'map__controls map__controls--bottom-right' },
              _react2.default.createElement(_mapLegend2.default, {
                layer: this.props.layer
              })
            )
          )
        )
      )
    );
  }
});

exports.default = (0, _recompose.compose)(_reactRouter.withRouter, (0, _recompose.withProps)(function (_ref4) {
  var _ref4$location$query$ = _ref4.location.query.activeRoad,
      activeRoad = _ref4$location$query$ === undefined ? '' : _ref4$location$query$;
  return {
    activeRoad: activeRoad
  };
}), (0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), (0, _reactRedux.connect)(function (state) {
  return {
    layer: state.exploreMap.layer,
    lng: state.map.lng,
    lat: state.map.lat,
    zoom: state.map.zoom
  };
}, function (dispatch, _ref5) {
  var activeRoad = _ref5.activeRoad;
  return {
    setMapPosition: function setMapPosition(lng, lat, zoom) {
      return dispatch((0, _map.setMapPosition)(lng, lat, zoom));
    },
    selectExploreMapLayer: function selectExploreMapLayer(value) {
      return dispatch((0, _actionCreators.selectExploreMapLayer)(value));
    },
    exploreMapShowNoVpromms: function exploreMapShowNoVpromms(checked) {
      return dispatch((0, _actionCreators.exploreMapShowNoVpromms)(checked));
    },
    fetchActiveRoad: function fetchActiveRoad(activeRoad) {
      return dispatch((0, _roads.fetchRoadBboxEpic)(activeRoad));
    }
  };
}))(Explore);

},{"../actions/action-creators":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-creators.js","../components/map-legend":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/map-legend.js","../components/map-options":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/map-options.js","../components/map-search":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/map-search.js","../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","../redux/modules/map":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/map.js","../redux/modules/roads":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/roads.js","../utils/line-colors":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/utils/line-colors.js","mapbox-gl":"mapbox-gl","react":"react","react-redux":"react-redux","react-router":"react-router","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/faq.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Faq = function Faq(_ref) {
  var language = _ref.language;
  return _react2.default.createElement(
    'section',
    { className: 'inpage' },
    _react2.default.createElement(
      'header',
      { className: 'inpage__header' },
      _react2.default.createElement(
        'div',
        { className: 'inner' },
        _react2.default.createElement(
          'div',
          { className: 'inpage__headline' },
          _react2.default.createElement(
            'h1',
            { className: 'inpage__title' },
            _react2.default.createElement(
              _t2.default,
              null,
              'Frequently Asked Questions'
            )
          )
        )
      )
    ),
    _react2.default.createElement(
      'div',
      { className: 'inpage__body' },
      _react2.default.createElement(
        'div',
        { className: 'inner' },
        language === 'en' ? _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'I typed in the correct username and password but couldn\u2019t open ORMA'
          ),
          _react2.default.createElement(
            'p',
            null,
            'Please change your Vietnamese typing into English'
          )
        ) : _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'T\xF4i \u0111\xE3 nh\u1EADp \u0111\xFAng t\xEAn ng\u01B0\u1EDDi d\xF9ng v\xE0 m\u1EADt kh\u1EA9u nh\u01B0ng kh\xF4ng th\u1EC3 m\u1EDF ORMA'
          ),
          _react2.default.createElement(
            'p',
            null,
            'H\xE3y chuy\u1EC3n ki\u1EC3u g\xF5 Ti\u1EBFng Vi\u1EC7t sang ti\u1EBFng Anh'
          )
        ),
        language === 'en' ? _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'I tried to upload data multiple times but keep getting error'
          ),
          _react2.default.createElement(
            'p',
            null,
            'Make sure the following conditions are met'
          ),
          _react2.default.createElement(
            'ul',
            null,
            _react2.default.createElement(
              'li',
              null,
              'The data hasn\u2019t been uploaded before'
            ),
            _react2.default.createElement(
              'li',
              null,
              'The format of uploading file is ZIP'
            ),
            _react2.default.createElement(
              'li',
              null,
              'File size is less than 4MB'
            ),
            _react2.default.createElement(
              'li',
              null,
              'VPRoMMS ID in the data is correct'
            )
          )
        ) : _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'T\xF4i \u0111\xE3 th\u1EED t\u1EA3i d\u1EEF li\u1EC7u l\xEAn nhi\u1EC1u l\u1EA7n nh\u01B0ng v\u1EABn g\u1EB7p l\u1ED7i'
          ),
          _react2.default.createElement(
            'p',
            null,
            'Ch\u1EAFc ch\u1EAFn r\u1EB1ng nh\u1EEFng \u0111i\u1EC1u ki\u1EC7n sau \u0111\u01B0\u1EE3c th\u1ECFa m\xE3n:'
          ),
          _react2.default.createElement(
            'ul',
            null,
            _react2.default.createElement(
              'li',
              null,
              'D\u1EEF li\u1EC7u n\xE0y ch\u01B0a \u0111\u01B0\u1EE3c t\u1EA3i l\xEAn tr\u01B0\u1EDBc \u0111\xE2y'
            ),
            _react2.default.createElement(
              'li',
              null,
              '\u0110\u1ECBnh d\u1EA1ng t\u1EADp tin l\xE0 ZIP'
            ),
            _react2.default.createElement(
              'li',
              null,
              'K\xEDch th\u01B0\u1EDBc t\u1EADp tin nh\u1ECF h\u01A1n 4MB'
            ),
            _react2.default.createElement(
              'li',
              null,
              'M\xE3 VPRoMMS trong d\u1EEF li\u1EC7u ch\xEDnh x\xE1c'
            )
          )
        ),
        language === 'en' ? _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'How can I show only one selected road on the map?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'You can click on \u2018Explore\u2019 button next to a VPRoMMS ID'
          )
        ) : _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'L\xE0m th\u1EBF n\xE0o \u0111\u1EC3 ch\u1EC9 hi\u1EC7n m\u1ED9t \u0111\u01B0\u1EDDng \u0111\xE3 ch\u1ECDn tr\xEAn b\u1EA3n \u0111\u1ED3?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'B\u1EA1n c\xF3 th\u1EC3 \u1EA5n v\xE0o n\xFAt \u2018Hi\u1EC3n th\u1ECB\u2019 c\u1EA1nh m\u1ED9t m\xE3 VPRoMMS'
          )
        ),
        language === 'en' ? _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'How can I know which VPRoMMS IDs are uploaded?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'The uploaded VPRoMMS IDs are shown in red color.'
          )
        ) : _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'L\xE0m sao t\xF4i c\xF3 th\u1EC3 bi\u1EBFt nh\u1EEFng m\xE3 VPRoMMS n\xE0o \u0111\xE3 \u0111\u01B0\u1EE3c t\u1EA3i l\xEAn?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'Nh\u1EEFng m\xE3 VPRoMMS \u0111\xE3 \u0111\u01B0\u1EE3c t\u1EA3i l\xEAn \u0111\u01B0\u1EE3c hi\u1EC3n th\u1ECB m\xE0u \u0111\u1ECF.'
          )
        ),
        language === 'en' ? _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'Why can\u2019t I click on some VPRoMMS IDs?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'You can only choose a VPRoMMS ID when it has data attached to (the red one)'
          )
        ) : _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'T\u1EA1i sao t\xF4i kh\xF4ng th\u1EC3 ch\u1ECDn m\u1ED9t s\u1ED1 m\xE3 VPRoMMS?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'B\u1EA1n ch\u1EC9 c\xF3 th\u1EC3 ch\u1ECDn m\u1ED9t m\xE3 VPRoMMS khi n\xF3 c\xF3 d\u1EEF li\u1EC7u \u0111\xEDnh k\xE8m (m\xE3 m\xE0u \u0111\u1ECF)'
          )
        ),
        language === 'en' ? _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'Why are there two different values of road length in one VPRoMMS ID?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'There are two values of length in a VPRoMMS ID: one comes from VPRoMMS speardsheet, one is calculated from GPS trace in the field. In some cases, these can be different.'
          )
        ) : _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'T\u1EA1i sao c\xF3 hai gi\xE1 tr\u1ECB c\u1EE7a chi\u1EC1u d\xE0i \u0111\u01B0\u1EDDng trong m\u1ED9t m\xE3 VPRoMMS?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'C\xF3 hai gi\xE1 tr\u1ECB c\u1EE7a chi\u1EC1u d\xE0i \u0111\u01B0\u1EDDng trong m\u1ED9t m\xE3 VPRoMMS: m\u1ED9t l\xE0 t\u1EEB b\u1EA3ng d\u1EEF li\u1EC7u VPRoMMS, m\u1ED9t l\xE0 \u0111\u01B0\u1EE3c t\xEDnh t\u1EEB d\u1EEF li\u1EC7u GPS t\u1EEB hi\u1EC7n tr\u01B0\u1EDDng. Trong m\u1ED9t s\u1ED1 tr\u01B0\u1EDDng h\u1EE3p, nh\u1EEFng d\u1EEF li\u1EC7u n\xE0y c\xF3 th\u1EC3 kh\xE1c nhau.'
          )
        ),
        language === 'en' ? _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'What is \u2018road without VPRoMMS ID\u2019?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'Some previously uploaded roads have no VPRoMMS IDs or the VPRoMMS IDs mismatch with VPRoMMS ID list in ORMA.'
          )
        ) : _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            '\u2018\u0111\u01B0\u1EDDng kh\xF4ng c\xF3 m\xE3 VPRoMMS\u2019 l\xE0 g\xEC?'
          ),
          _react2.default.createElement(
            'p',
            null,
            'M\u1ED9t s\u1ED1 \u0111\u01B0\u1EDDng \u0111\xE3 \u0111\u01B0\u1EE3c t\u1EA3i l\xEAn t\u1EEB tr\u01B0\u1EDBc kh\xF4ng c\xF3 m\xE3 VPRoMMS ho\u1EB7c m\xE3 VPRoMMS kh\xF4ng kh\u1EDBp v\u1EDBi danh s\xE1ch m\xE3 VPRoMMS trong ORMA'
          )
        ),
        language === 'en' ? _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'In \u2018Tasks\u2019, the system shows that there are 3 roads but I can only see 2 roads.'
          ),
          _react2.default.createElement(
            'p',
            null,
            'Please try to zoom in and look around the roads, you may find the third one.'
          )
        ) : _react2.default.createElement(
          'section',
          { className: 'question' },
          _react2.default.createElement(
            'h3',
            { className: 'inpage__title' },
            'Trong m\u1EE5c \u2018Nhi\u1EC7m v\u1EE5\u2019, h\u1EC7 th\u1ED1ng b\xE1o r\u1EB1ng c\xF3 3 \u0111\u01B0\u1EDDng \u0111ang \u0111\u01B0\u1EE3c hi\u1EC3n th\u1ECB nh\u01B0ng t\xF4i ch\u1EC9 th\u1EA5y 2 \u0111\u01B0\u1EDDng.'
          ),
          _react2.default.createElement(
            'p',
            null,
            'H\xE3y th\u1EED ph\xF3ng to v\xE0 t\xECm xung quanh c\xE1c \u0111\u01B0\u1EDDng \u0111ang hi\u1EC3n th\u1ECB, b\u1EA1n c\xF3 th\u1EC3 t\xECm th\u1EA5y \u0111\u01B0\u1EDDng th\u1EE9 ba.'
          )
        ),
        _react2.default.createElement(
          'section',
          null,
          _react2.default.createElement(
            'p',
            null,
            _react2.default.createElement(
              _t2.default,
              null,
              'If you have any remaining questions'
            ),
            _react2.default.createElement(
              'a',
              { href: 'mailto:dphan2@worldbank.org?cc=gost@worldbank.org&subject=' + (0, _t.translate)(language, 'Question regarding ORMA, not answered in the FAQ') },
              _react2.default.createElement(
                'button',
                { className: 'button button--base-raised-light' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'email us'
                )
              )
            )
          )
        )
      )
    )
  );
};

exports.default = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }))(Faq);

},{"../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/home.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _reactRouter = require('react-router');

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Home = function Home(_ref) {
  var language = _ref.language;
  return _react2.default.createElement(
    'section',
    null,
    _react2.default.createElement(
      'header',
      { className: 'page__header--landing' },
      _react2.default.createElement(
        'div',
        { className: 'page__headline--landing' },
        _react2.default.createElement(
          'h1',
          { className: 'page__title--landing' },
          _react2.default.createElement('img', { src: 'assets/graphics/layout/openroads-vn-logo-hor-neg.svg', width: '736', height: '96', alt: 'OpenRoads Vietnam logo' }),
          _react2.default.createElement(
            'span',
            null,
            'OpenRoads'
          ),
          ' ',
          _react2.default.createElement(
            'strong',
            null,
            'Vietnam'
          )
        ),
        _react2.default.createElement(
          'p',
          { className: 'page__description--landing' },
          _react2.default.createElement(
            _t2.default,
            null,
            'Tracking and visualizing road assets in Vietnam for inclusive growth.'
          )
        )
      )
    ),
    _react2.default.createElement(
      'div',
      { className: 'page__body--landing' },
      _react2.default.createElement(
        'div',
        { className: 'inner' },
        _react2.default.createElement(
          'h2',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Access and improve Road Networks'
          )
        ),
        _react2.default.createElement(
          'p',
          { className: 'description' },
          _react2.default.createElement(
            _t2.default,
            null,
            'Work with the OpenRoads project to close this critical information gap and create a comprehensive road network of Vietnam'
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'cta-block' },
          _react2.default.createElement(
            _reactRouter.Link,
            { to: '/' + language + '/assets', className: 'button button--xlarge button--base-raised-light' },
            _react2.default.createElement(
              _t2.default,
              null,
              'View assets'
            )
          ),
          ' ',
          _react2.default.createElement(
            'small',
            null,
            'or'
          ),
          ' ',
          _react2.default.createElement(
            _reactRouter.Link,
            { to: '/' + language + '/explore', className: 'button button--xlarge button--primary-raised-dark' },
            _react2.default.createElement(
              _t2.default,
              null,
              'Explore on map'
            )
          )
        )
      )
    )
  );
};

exports.default = (0, _recompose.getContext)({ language: _react.PropTypes.string })(Home);

},{"../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react","react-router":"react-router","recompose":"recompose"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/tasks.js":[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _recompose = require('recompose');

var _reactRedux = require('react-redux');

var _mapboxGl = require('mapbox-gl');

var _mapboxGl2 = _interopRequireDefault(_mapboxGl);

var _config = require('../config');

var _config2 = _interopRequireDefault(_config);

var _turfExtent = require('turf-extent');

var _turfExtent2 = _interopRequireDefault(_turfExtent);

var _reactRouter = require('react-router');

var _lineIntersect = require('@turf/line-intersect');

var _lineIntersect2 = _interopRequireDefault(_lineIntersect);

var _pointOnLine = require('@turf/point-on-line');

var _pointOnLine2 = _interopRequireDefault(_pointOnLine);

var _turfPoint = require('turf-point');

var _turfPoint2 = _interopRequireDefault(_turfPoint);

var _meta = require('@turf/meta');

var _distance = require('@turf/distance');

var _distance2 = _interopRequireDefault(_distance);

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

var _osm = require('../redux/modules/osm');

var _map = require('../redux/modules/map');

var _tasks = require('../redux/modules/tasks');

var _actionCreators = require('../actions/action-creators.js');

var _toOsm = require('../utils/to-osm');

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

var _taskListItem = require('../components/task-list-item');

var _taskListItem2 = _interopRequireDefault(_taskListItem);

var _reactSelect = require('react-select');

var _reactSelect2 = _interopRequireDefault(_reactSelect);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var source = 'collisions';
var roadHoverId = 'road-hover';
var roadSelected = 'road-selected';
var roadSelectedStep1 = 'road-selected-step1';
var layers = [{
  id: 'road',
  type: 'line',
  source: source,
  paint: {
    'line-width': 4,
    'line-opacity': 0.2
  },
  layout: { 'line-cap': 'round' }
}, {
  id: roadHoverId,
  type: 'line',
  source: source,
  paint: {
    'line-width': 6,
    'line-opacity': 0.9
  },
  layout: { 'line-cap': 'round' },
  filter: ['==', '_id', '']
}, {
  id: roadSelected,
  type: 'line',
  source: source,
  paint: {
    'line-width': 6,
    'line-opacity': 0.9,
    'line-color': '#FF0000'
  },
  layout: { 'line-cap': 'round' },
  filter: ['==', '_id', '']
}, {
  id: roadSelectedStep1,
  type: 'line',
  source: source,
  paint: {
    'line-width': 6,
    'line-opacity': 0.9,
    'line-color': '#8F1812'
  },
  layout: { 'line-cap': 'round' },
  filter: ['==', '_id', '']
}];

var layerIds = layers.map(function (layer) {
  return layer.id;
});

var Tasks = _react2.default.createClass({
  displayName: 'Tasks',

  getInitialState: function getInitialState() {
    return {
      renderedFeatures: null,
      mode: 'dedupe',

      // Steps are 0, 1 and 2 in accordance with new step workflow
      step: 0,
      hoverId: '',
      selectedIds: [],
      selectedStep0: [], // ids of selected features in step 0
      selectedStep1: null, // in step "1", there can only ever be one id selected
      selectedProvince: null,
      selectedVpromm: null
    };
  },

  propTypes: {
    fetchNextTask: _react2.default.PropTypes.func,
    setMapPosition: _react2.default.PropTypes.func,
    _queryOsm: _react2.default.PropTypes.func,
    _markTaskAsDone: _react2.default.PropTypes.func,
    _deleteWays: _react2.default.PropTypes.func,
    skipTask: _react2.default.PropTypes.func,
    fetchTaskCount: _react2.default.PropTypes.func,
    osmStatus: _react2.default.PropTypes.string,
    taskStatus: _react2.default.PropTypes.string,
    meta: _react2.default.PropTypes.object,
    task: _react2.default.PropTypes.object,
    taskId: _react2.default.PropTypes.number,
    taskUpdatedAt: _react2.default.PropTypes.string,
    taskCount: _react2.default.PropTypes.number,
    selectOptions: _react2.default.PropTypes.object,
    selectedProvince: _react2.default.PropTypes.number,
    selectNextTaskProvince: _react2.default.PropTypes.func,
    dedupeWayTask: _react2.default.PropTypes.func,
    language: _react2.default.PropTypes.string
  },

  componentDidMount: function componentDidMount() {
    var _this = this;

    _mapboxGl2.default.accessToken = _config2.default.mbToken;
    var map = this.map = new _mapboxGl2.default.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v9',
      failIfMajorPerformanceCaveat: false,
      zoom: 12
    }).addControl(new _mapboxGl2.default.NavigationControl(), 'top-left');

    // Disable map rotation using right click + drag.
    this.map.dragRotate.disable();

    // Disable map rotation using touch rotation gesture.
    this.map.touchZoomRotate.disableRotation();

    // Remove compass.
    document.querySelector('.mapboxgl-ctrl .mapboxgl-ctrl-compass').remove();

    this.onMapLoaded(function () {
      map.on('mousemove', function (e) {
        // toggle cursor and hover filters on mouseover
        var features = map.queryRenderedFeatures(e.point, { layers: layerIds });
        var id = void 0;

        if (features.length && features[0].properties._id) {
          map.getCanvas().style.cursor = 'pointer';
          id = features[0].properties._id;
        } else {
          map.getCanvas().style.cursor = '';
          id = '';
        }

        _this.hoverItemOver(id);
      });

      map.on('click', function (e) {
        var step = _this.state.step;

        var features = map.queryRenderedFeatures(e.point, { layers: [roadHoverId] });
        if (features.length && features[0].properties._id) {
          var featId = features[0].properties._id;
          if (step === 0) {
            _this.selectStep0(featId);
          } else if (step === 1) {
            _this.selectStep1(featId);
          } else {
            // do nothing
          }
        }
      });
    });
  },

  componentWillReceiveProps: function componentWillReceiveProps(_ref) {
    var _this2 = this;

    var nextTask = _ref.task,
        nextTaskId = _ref.taskId,
        nextOsmStatus = _ref.osmStatus;

    if (this.props.task !== nextTask) {
      // TODO - ANTIPATTERN: should not mirror properties task and taskId in state
      this.setState({ renderedFeatures: nextTask }, function () {
        return _this2.onMapLoaded(function () {
          return _this2.syncMap();
        });
      });
    } else if (this.props.osmStatus === 'pending' && nextOsmStatus === 'complete') {
      // We've just successfully completed an osm changeset

      // TODO - move this state into redux store so it can be modified directly by actions
      // specifically, COMPLETE_OSM_CHANGE
      this.setState({
        selectedIds: [],
        mode: null
      });
    }
  },

  componentWillUnmount: function componentWillUnmount() {
    var _map$getCenter = this.map.getCenter(),
        lng = _map$getCenter.lng,
        lat = _map$getCenter.lat;

    var zoom = this.map.getZoom();
    this.props.setMapPosition(lng, lat, zoom);
  },

  onMapLoaded: function onMapLoaded(fn) {
    if (this.map.loaded()) fn();else this.map.once('load', fn);
  },

  syncMap: function syncMap() {
    var features = this.state.renderedFeatures;
    var map = this.map;

    var existingSource = map.getSource(source);
    var selectedIds = [].concat(this.state.selectedStep0);
    var selectedStep1 = this.state.selectedStep1 || '';
    var hoverId = this.state.hoverId;
    if (!existingSource) {
      map.addSource(source, {
        type: 'geojson',
        data: features
      });
      layers.forEach(function (layer) {
        map.addLayer(layer);
      });
    } else {
      existingSource.setData(features);
    }
    map.fitBounds((0, _turfExtent2.default)(features), {
      linear: true,
      padding: 25
    });
    map.setFilter(roadSelected, ['in', '_id'].concat(selectedIds));
    map.setFilter(roadHoverId, ['==', '_id', hoverId]);
    map.setFilter(roadSelectedStep1, ['==', '_id', selectedStep1]);
  },

  renderPropertiesOverlay: function renderPropertiesOverlay() {
    var hoverId = this.state.hoverId;
    var task = this.props.task;

    var properties = task.features.find(function (c) {
      return hoverId === c.properties._id;
    }).properties;
    var displayList = Object.keys(properties).filter(function (key) {
      return key.charAt(0) !== '_' && typeof properties[key] === 'string';
    }).map(function (key) {
      return [_react2.default.createElement(
        'dt',
        { key: key + '-key' },
        _react2.default.createElement(
          'strong',
          null,
          key
        )
      ), _react2.default.createElement(
        'dd',
        { key: key + '-value' },
        properties[key] ? properties[key] : '--'
      )];
    });
    return _react2.default.createElement(
      'div',
      { className: 'map__controls map__controls--top-left' },
      _react2.default.createElement(
        'figcaption',
        { className: 'panel properties-panel' },
        _react2.default.createElement(
          'div',
          { className: 'panel__body' },
          _react2.default.createElement(
            'dl',
            null,
            displayList
          )
        )
      )
    );
  },

  getPanelTitle: function getPanelTitle() {
    var _state = this.state,
        mode = _state.mode,
        step = _state.step;

    if (step === 0) {
      return 'Prepare workflow';
    }
    if (step === 1 && mode === 'dedupe') {
      return 'Remove duplicates';
    }
    if (step === 1 && mode === 'join') {
      return 'Create intersection';
    }
    if (step === 2) {
      return 'Workflow completed';
    }
  },

  renderInstrumentPanel: function renderInstrumentPanel() {
    var _state2 = this.state,
        step = _state2.step,
        renderedFeatures = _state2.renderedFeatures;
    var _props = this.props,
        osmStatus = _props.osmStatus,
        language = _props.language,
        taskId = _props.taskId,
        taskUpdatedAt = _props.taskUpdatedAt;

    var diffHours = (0, _moment2.default)().diff(taskUpdatedAt, 'hours');
    var hoursText = diffHours === 1 ? (0, _t.translate)(language, 'hour ago') : (0, _t.translate)(language, 'hours ago');
    var panelTitle = this.getPanelTitle();
    if (osmStatus === 'pending') {
      return _react2.default.createElement(
        'div',
        { className: 'map__controls map__controls--column-right' },
        _react2.default.createElement(
          'div',
          { className: 'panel tasks-panel' },
          _react2.default.createElement(
            'div',
            { className: 'panel__body' },
            _react2.default.createElement(
              'h2',
              null,
              _react2.default.createElement(
                _t2.default,
                null,
                'Performing action...'
              )
            )
          )
        )
      );
    }
    return _react2.default.createElement(
      'div',
      { className: 'map__controls map__controls--column-right' },
      _react2.default.createElement(
        'article',
        { className: 'panel task-panel' },
        renderedFeatures && _react2.default.createElement(
          'header',
          { className: 'panel__header' },
          _react2.default.createElement(
            'div',
            { className: 'panel__headline' },
            _react2.default.createElement(
              'h1',
              { className: 'panel__sectitle' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Task'
              ),
              ' #',
              taskId
            ),
            _react2.default.createElement(
              'p',
              { className: 'panel__subtitle' },
              _react2.default.createElement(
                'time',
                { dateTime: taskUpdatedAt },
                diffHours,
                ' ',
                hoursText
              )
            ),
            _react2.default.createElement(
              'h2',
              { className: 'panel__title' },
              _react2.default.createElement(
                _t2.default,
                null,
                panelTitle
              )
            )
          )
        ),
        step === 0 && renderedFeatures && this.renderStep0(),
        step === 1 && renderedFeatures && this.renderStep1(),
        step === 2 && renderedFeatures && this.renderStep2(),
        _react2.default.createElement(
          'footer',
          { className: 'panel__footer' },
          step === 0 && renderedFeatures && this.renderActionsStep0(),
          step === 1 && renderedFeatures && this.renderActionsStep1(),
          step === 2 && renderedFeatures && this.renderActionsStep2()
        )
      )
    );
  },

  // reset selected items when user changes mode, user can only change mode in step 0
  handleChangeMode: function handleChangeMode(event) {
    this.setState({ mode: event.target.value, selectedStep0: [] }, this.syncMap);
  },

  // trigger when an item is selected during step 0
  selectStep0: function selectStep0(id) {
    var _state3 = this.state,
        mode = _state3.mode,
        selectedStep0 = _state3.selectedStep0;

    var selectedClone = [].concat(selectedStep0);
    if (mode === 'dedupe') {
      // user can select multiple
      if (selectedClone.includes(id)) {
        selectedClone.splice(selectedClone.indexOf(id));
      } else {
        selectedClone.push(id);
      }
    } else if (mode === 'join') {
      // Intersect mode will only allow one element to be selected
      if (selectedClone[0] === id) {
        selectedClone = [];
      } else {
        selectedClone[0] = id;
      }
    }
    this.setState({ selectedStep0: selectedClone }, this.syncMap);
  },

  selectStep1: function selectStep1(id) {
    this.setState({ selectedStep1: id }, this.syncMap);
  },

  hoverItemOver: function hoverItemOver(id) {
    this.setState({ hoverId: id }, this.syncMap);
  },

  hoverItemOut: function hoverItemOut(id) {
    this.setState({ hoverId: '' }, this.syncMap);
  },

  renderStep0: function renderStep0() {
    var _this3 = this;

    var _state4 = this.state,
        renderedFeatures = _state4.renderedFeatures,
        mode = _state4.mode,
        selectedStep0 = _state4.selectedStep0,
        hoverId = _state4.hoverId;
    var language = this.props.language;

    var title = mode === 'dedupe' ? 'Select roads to work on' : 'Select road to work on';
    var type = mode === 'dedupe' ? 'checkbox' : 'radio';

    // we need to assign these translated strings as variables
    // because if we use the <T> tag inside an <option>, it generates invalid markup
    // by inserting a <span> around the string
    var removeDuplicatesT = (0, _t.translate)(language, 'Remove duplicates');
    var createIntersectionT = (0, _t.translate)(language, 'Create intersection');
    return _react2.default.createElement(
      'div',
      { className: 'panel__body' },
      _react2.default.createElement(
        'section',
        { className: 'task-group' },
        _react2.default.createElement(
          'header',
          { className: 'task-group__header' },
          _react2.default.createElement(
            'h1',
            { className: 'task-group__title' },
            _react2.default.createElement(
              _t2.default,
              null,
              'Select action to perform'
            )
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'task-group__body' },
          _react2.default.createElement(
            'form',
            { className: 'form task-group__actions' },
            _react2.default.createElement(
              'div',
              { className: 'form__group' },
              _react2.default.createElement(
                'label',
                { className: 'form__label visually-hidden' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'Actions'
                )
              ),
              _react2.default.createElement(
                'select',
                { className: 'form__control', value: mode, onChange: this.handleChangeMode },
                _react2.default.createElement(
                  'option',
                  { value: 'dedupe' },
                  removeDuplicatesT
                ),
                _react2.default.createElement(
                  'option',
                  { value: 'join' },
                  createIntersectionT
                )
              )
            )
          )
        )
      ),
      _react2.default.createElement(
        'section',
        { className: 'task-group' },
        _react2.default.createElement(
          'header',
          { className: 'task-group__header' },
          _react2.default.createElement(
            'h1',
            { className: 'task-group__title' },
            _react2.default.createElement(
              _t2.default,
              null,
              title
            )
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'task-group__body' },
          _react2.default.createElement(
            'ul',
            { className: 'road-list' },
            renderedFeatures.features.map(function (road) {
              return _react2.default.createElement(_taskListItem2.default, {
                vpromm: road.properties.or_vpromms,
                province: road.properties.province,
                _id: road.properties._id,
                mode: mode,
                type: type,
                language: language,
                key: road.properties._id,
                selected: selectedStep0.includes(road.properties._id),
                isHighlighted: road.properties._id === hoverId,
                onMouseOver: _this3.hoverItemOver,
                onMouseOut: _this3.hoverItemOut,
                toggleSelect: _this3.selectStep0
              });
            })
          )
        )
      )
    );
  },

  renderActionsStep0: function renderActionsStep0() {
    var _state5 = this.state,
        mode = _state5.mode,
        selectedStep0 = _state5.selectedStep0;

    var isDisabled = void 0;
    if (mode === 'dedupe') {
      isDisabled = selectedStep0.length < 2;
    } else if (mode === 'join') {
      isDisabled = selectedStep0.length === 0;
    }
    return _react2.default.createElement(
      'div',
      { className: 'panel__f-actions' },
      _react2.default.createElement(
        'button',
        { type: 'button', className: 'pfa-secondary', onClick: this.next },
        _react2.default.createElement(
          'span',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Skip task'
          )
        )
      ),
      _react2.default.createElement(
        'button',
        {
          type: 'button',
          className: 'pfa-primary ' + (isDisabled ? 'disabled' : ''),
          disabled: isDisabled,
          onClick: this.gotoStep1
        },
        _react2.default.createElement(
          'span',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Continue'
          )
        )
      )
    );
  },

  renderActionsStep1: function renderActionsStep1() {
    var _state6 = this.state,
        mode = _state6.mode,
        selectedStep1 = _state6.selectedStep1;

    var isDisabled = !selectedStep1;
    var onClick = void 0;
    if (mode === 'join') {
      onClick = this.commitJoin;
    } else if (mode === 'dedupe') {
      onClick = this.commitDedupe;
    }
    return _react2.default.createElement(
      'div',
      { className: 'panel__f-actions' },
      _react2.default.createElement(
        'button',
        { type: 'button', className: 'pfa-secondary', onClick: this.gotoStep0 },
        _react2.default.createElement(
          'span',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Back'
          )
        )
      ),
      _react2.default.createElement(
        'button',
        {
          type: 'button',
          className: 'pfa-primary ' + (isDisabled ? 'disabled' : ''),
          disabled: isDisabled,
          onClick: onClick
        },
        _react2.default.createElement(
          'span',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Apply'
          )
        )
      )
    );
  },

  doMore: function doMore() {
    this.setState({
      selectedStep0: [],
      selectedStep1: null,
      step: 0
    }, this.syncMap);
  },

  renderActionsStep2: function renderActionsStep2() {
    return _react2.default.createElement(
      'div',
      { className: 'panel__f-actions' },
      _react2.default.createElement(
        'button',
        { type: 'button', className: 'pfa-secondary', onClick: this.doMore },
        _react2.default.createElement(
          'span',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Do more'
          )
        )
      ),
      _react2.default.createElement(
        'button',
        { type: 'button', onClick: this.next, className: 'pfa-primary' },
        _react2.default.createElement(
          'span',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Next task'
          )
        )
      )
    );
  },

  getSelectedVpromms: function getSelectedVpromms() {
    var _state7 = this.state,
        renderedFeatures = _state7.renderedFeatures,
        selectedStep0 = _state7.selectedStep0;

    var vpromms = renderedFeatures.features.filter(function (feat) {
      return selectedStep0.includes(feat.properties._id);
    }).map(function (feat) {
      return feat.properties.or_vpromms || 'No ID';
    });
    return _lodash2.default.uniq(vpromms);
  },

  renderStep1: function renderStep1() {
    var _this4 = this;

    var _state8 = this.state,
        mode = _state8.mode,
        selectedStep0 = _state8.selectedStep0,
        selectedStep1 = _state8.selectedStep1,
        renderedFeatures = _state8.renderedFeatures,
        hoverId = _state8.hoverId;
    var language = this.props.language;

    var step1Features = void 0;
    var title = mode === 'dedupe' ? 'Select Road to Keep' : 'Select Road to Intersect With';
    if (mode === 'dedupe') {
      // in dedupe mode, show all features selected in previous step
      step1Features = renderedFeatures.features.filter(function (feat) {
        return selectedStep0.includes(feat.properties._id);
      });
    } else if (mode === 'join') {
      // in join mode, show all features except the one selected in previous step
      step1Features = renderedFeatures.features.filter(function (feat) {
        return feat.properties._id !== selectedStep0[0];
      });
    }
    var vpromms = this.getSelectedVpromms();
    return _react2.default.createElement(
      'div',
      { className: 'panel__body' },
      _react2.default.createElement(
        'section',
        { className: 'task-group' },
        _react2.default.createElement(
          'header',
          { className: 'task-group__header' },
          _react2.default.createElement(
            'h1',
            { className: 'task-group__title' },
            _react2.default.createElement(
              _t2.default,
              null,
              title
            )
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'task-group__body' },
          _react2.default.createElement(
            'ul',
            { className: 'road-list' },
            step1Features.map(function (road) {
              return _react2.default.createElement(_taskListItem2.default, {
                vpromm: road.properties.or_vpromms,
                province: road.properties.province,
                _id: road.properties._id,
                mode: mode,
                type: 'radio',
                language: language,
                key: road.properties._id,
                selected: selectedStep1 === road.properties._id,
                isHighlighted: road.properties._id === hoverId,
                onMouseOver: _this4.hoverItemOver,
                onMouseOut: _this4.hoverItemOut,
                toggleSelect: _this4.selectStep1
              });
            })
          )
        )
      ),
      mode === 'dedupe' && _react2.default.createElement(
        'section',
        { className: 'task-group' },
        _react2.default.createElement(
          'header',
          { className: 'task-group__header' },
          _react2.default.createElement(
            'h1',
            { className: 'task-group__title' },
            _react2.default.createElement(
              _t2.default,
              null,
              'Select VPROMMID to Apply'
            )
          )
        ),
        _react2.default.createElement(
          'div',
          { className: 'task-group__body' },
          _react2.default.createElement(
            'form',
            { className: 'form task-group__actions' },
            _react2.default.createElement(
              'div',
              { className: 'form__group' },
              _react2.default.createElement(
                'label',
                { className: 'form__label visually-hidden' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'VPROMMIDs'
                )
              ),
              _react2.default.createElement(
                'select',
                { className: 'form__control', onChange: this.selectVpromm },
                vpromms.map(function (id) {
                  return _react2.default.createElement(
                    'option',
                    { key: id, value: id },
                    id
                  );
                })
              )
            )
          )
        )
      )
    );
  },

  renderStep2: function renderStep2() {
    var _state9 = this.state,
        mode = _state9.mode,
        selectedStep0 = _state9.selectedStep0;
    var language = this.props.language;


    var numRoads = mode === 'dedupe' ? selectedStep0.length - 1 : 2;
    var roadStr = numRoads === 1 ? (0, _t.translate)(language, 'road was') : (0, _t.translate)(language, 'roads were');
    var actionStr = mode === 'dedupe' ? (0, _t.translate)(language, 'removed') : (0, _t.translate)(language, 'intersected');
    return _react2.default.createElement(
      'div',
      { className: 'panel__body' },
      _react2.default.createElement(
        'div',
        { className: 'prose task-prose' },
        _react2.default.createElement(
          'p',
          null,
          numRoads,
          ' ',
          roadStr,
          ' ',
          actionStr,
          ' ',
          _react2.default.createElement(
            _t2.default,
            null,
            'and submitted to the system for review.'
          )
        ),
        _react2.default.createElement(
          'p',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Do you want to continue to work on this task or move to the next one?'
          )
        )
      )
    );
  },

  gotoStep0: function gotoStep0() {
    this.setState({ step: 0, selectedStep1: null }, this.syncMap);
  },

  gotoStep1: function gotoStep1() {
    this.setState({ step: 1 });
  },

  gotoStep2: function gotoStep2() {
    this.setState({ step: 2 });
  },

  handleSelectVprommid: function handleSelectVprommid(selectedVprommid) {
    this.setState({ applyVprommid: selectedVprommid });
  },

  commitDedupe: function commitDedupe() {
    var _state10 = this.state,
        selectedStep1 = _state10.selectedStep1,
        renderedFeatures = _state10.renderedFeatures,
        applyVprommid = _state10.applyVprommid;
    var features = renderedFeatures.features;

    var toDelete = features.filter(function (feature) {
      return feature.properties._id !== selectedStep1;
    });
    var wayIdToKeep = selectedStep1;
    this.props.dedupeWayTask(this.props.taskId, toDelete.map(function (feature) {
      return feature.properties._id;
    }), wayIdToKeep, applyVprommid === 'No ID' ? null : applyVprommid);
    // this.props._deleteWays(this.props.taskId, toDelete.map(feature => feature.properties._id));

    // TODO - should deduping mark task as done?
    this.props._markTaskAsDone(toDelete.map(function (feature) {
      return feature.properties._id;
    }));
    this.gotoStep2();
  },

  commitJoin: function commitJoin() {
    var _state11 = this.state,
        selectedStep0 = _state11.selectedStep0,
        selectedStep1 = _state11.selectedStep1,
        renderedFeatures = _state11.renderedFeatures;
    var features = renderedFeatures.features;

    var line1 = features.find(function (f) {
      return f.properties._id === selectedStep0[0];
    });
    var line2 = features.find(function (f) {
      return f.properties._id === selectedStep1;
    });
    var intersectingFeatures = (0, _lineIntersect2.default)(line1, line2);
    var changes = [];

    if (!intersectingFeatures.features.length) {
      // lines don't intersect, find the two nearest points on the two respective lines.
      var closestPoints = (0, _meta.coordReduce)(line1, function (context, line1Point) {
        // If we find two points with shorter distance between them,
        // set the coordinates on the second line to this variable.
        var closerLine2Point = null;
        var bestDistance = (0, _meta.coordReduce)(line2, function (currentBest, line2Point) {
          var distance = (0, _distance2.default)(line1Point, line2Point);
          if (distance < currentBest) {
            closerLine2Point = line2Point;
            return distance;
          }
          return currentBest;
        }, context.distance);

        if (closerLine2Point) {
          return {
            distance: bestDistance,
            line1Point: line1Point,
            line2Point: closerLine2Point
          };
        }
        return context;
      }, { distance: Infinity, line1Point: null, line2Point: null });

      // Figure out where to add the extra point.
      // For either line, if the closest coordinate is at the start or tail end of the line,
      // we can just add it to the beginning or end.
      var line1Point = (0, _pointOnLine2.default)(line1, (0, _turfPoint2.default)(closestPoints.line1Point));
      var line2Point = (0, _pointOnLine2.default)(line2, (0, _turfPoint2.default)(closestPoints.line2Point));

      if (line1Point.properties.index === 0 || line1Point.properties.index === line1.geometry.coordinates.length - 1) {
        changes.push(insertPointOnLine(line1, line2Point));
      } else if (line2Point.properties.index === 0 || line2Point.properties.index === line2.geometry.coordinates.length - 1) {
        changes.push(insertPointOnLine(line2, line1Point));
      } else {
        changes.push(insertPointOnLine(line1, (0, _turfPoint2.default)(closestPoints.line2Point)));
        changes.push(insertPointOnLine(line2, (0, _turfPoint2.default)(closestPoints.line1Point)));
      }
    } else {
      var intersection = intersectingFeatures.features[0];
      changes.push(insertPointOnLine(line1, intersection));
      changes.push(insertPointOnLine(line2, intersection));
    }

    var changeset = (0, _toOsm.createModifyLineString)(changes);

    this.props._queryOsm(this.props.taskId, changeset);

    // TODO - should deduping mark task as done?
    this.props._markTaskAsDone([line1.properties._id, line2.properties._id]);

    this.gotoStep2();
  },

  markAsDone: function markAsDone() {
    // This function is different from #next, in that it allows you
    // to specify all visible roads as 'done'
    this.props._markTaskAsDone(this.state.renderedFeatures.features.map(function (feature) {
      return Number(feature.properties._id);
    }));
    this.props.fetchTaskCount();
    this.next();
  },

  next: function next() {
    this.map.setFilter(roadSelected, ['all', ['in', '_id', '']]);
    this.props.skipTask(this.props.taskId);
    this.setState({ selectedStep0: [], selectedStep1: null, mode: 'dedupe', selectedVpromm: null, step: 0, renderedFeatures: null }, this.props.fetchNextTask);
  },

  handleProvinceChange: function handleProvinceChange(selectedProvince) {
    var value = selectedProvince ? selectedProvince.value : null;
    this.props.selectNextTaskProvince(value);
    this.props.fetchNextTask();
  },

  renderProvinceSelect: function renderProvinceSelect() {
    var _props2 = this.props,
        selectedProvince = _props2.selectedProvince,
        language = _props2.language;

    var provinceOptions = this.props.selectOptions.province.map(function (p) {
      return { value: p.id, label: p.name_en };
    });
    var value = selectedProvince;
    return _react2.default.createElement(_reactSelect2.default, {
      name: 'form-province-select',
      value: value,
      onChange: this.handleProvinceChange,
      options: provinceOptions,
      placeholder: (0, _t.translate)(language, 'Filter tasks by province')
    });
  },

  render: function render() {
    var _props3 = this.props,
        taskId = _props3.taskId,
        taskCount = _props3.taskCount,
        taskStatus = _props3.taskStatus;
    var hoverId = this.state.hoverId;

    var renderPanel = !(taskStatus === 'error' || taskStatus === 'No tasks remaining' || !taskId && taskStatus === 'pending');

    return _react2.default.createElement(
      'section',
      { className: 'inpage inpage--alt' },
      _react2.default.createElement(
        'header',
        { className: 'inpage__header' },
        _react2.default.createElement(
          'div',
          { className: 'inner' },
          _react2.default.createElement(
            'div',
            { className: 'inpage__headline' },
            _react2.default.createElement(
              'h1',
              { className: 'inpage__title' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Tasks'
              )
            )
          ),
          _react2.default.createElement(
            'nav',
            { className: 'inpage__nav' },
            _react2.default.createElement(
              'ul',
              { className: 'inpage__menu' },
              _react2.default.createElement(
                'li',
                null,
                _react2.default.createElement(
                  _reactRouter.Link,
                  { to: '/' + this.props.language + '/tasks', className: 'inpage__menu-link', activeClassName: 'inpage__menu-link--active', title: 'View' },
                  _react2.default.createElement(
                    'span',
                    null,
                    _react2.default.createElement(
                      _t2.default,
                      null,
                      'Solve'
                    ),
                    ' ',
                    _react2.default.createElement(
                      'small',
                      { className: 'label' },
                      taskCount
                    )
                  )
                )
              ),
              _react2.default.createElement(
                'li',
                null,
                _react2.default.createElement(
                  'a',
                  { className: 'inpage__menu-link disabled', href: '#', title: 'View' },
                  _react2.default.createElement(
                    'span',
                    null,
                    _react2.default.createElement(
                      _t2.default,
                      null,
                      'Stats'
                    )
                  )
                )
              )
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'inpage__actions' },
            _react2.default.createElement(
              'div',
              { className: 'form__group task-search' },
              _react2.default.createElement(
                'label',
                { className: 'form__label', htmlFor: 'form-select-1' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'Search admin area'
                )
              ),
              this.props.selectOptions.province && this.renderProvinceSelect()
            )
          )
        )
      ),
      _react2.default.createElement(
        'div',
        { className: 'inpage__body' },
        _react2.default.createElement(
          'div',
          { className: 'inner' },
          _react2.default.createElement(
            'figure',
            { className: 'map' },
            _react2.default.createElement('div', { className: 'map__media', id: 'map' }),
            hoverId && this.renderPropertiesOverlay(),
            taskStatus === 'error' && _react2.default.createElement(
              'div',
              { className: 'placeholder__fullscreen' },
              _react2.default.createElement(
                'h3',
                { className: 'placeholder__message' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'Error'
                )
              )
            ),
            taskStatus === 'No tasks remaining' && _react2.default.createElement(
              'div',
              { className: 'placeholder__fullscreen' },
              _react2.default.createElement(
                'h3',
                { className: 'placeholder__message' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'No tasks remaining'
                )
              )
            ),
            !taskId && taskStatus === 'pending' && _react2.default.createElement(
              'div',
              { className: 'placeholder__fullscreen' },
              _react2.default.createElement(
                'h3',
                { className: 'placeholder__message' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'Loading'
                )
              )
            ),
            renderPanel && this.renderInstrumentPanel()
          )
        )
      )
    );
  }
});

exports.default = (0, _recompose.compose)((0, _recompose.getContext)({ language: _react2.default.PropTypes.string }), (0, _reactRedux.connect)(function (state) {
  return {
    task: state.waytasks.geoJSON,
    taskId: state.waytasks.id,
    taskUpdatedAt: state.waytasks.updatedAt,
    taskCount: state.waytasks.taskCount,
    taskStatus: state.waytasks.status,
    osmStatus: state.osmChange.status,
    selectOptions: state.provinces.data,
    selectedProvince: state.waytasks.selectedProvince
  };
}, function (dispatch) {
  return {
    fetchProvinces: function fetchProvinces() {
      return dispatch((0, _actionCreators.fetchProvinces)());
    },
    selectNextTaskProvince: function selectNextTaskProvince(provinceId) {
      return dispatch((0, _tasks.selectWayTaskProvince)(provinceId));
    },
    dedupeWayTask: function dedupeWayTask(taskId, wayIds, wayIdToKeep, dedupeVprommid) {
      return dispatch((0, _tasks.dedupeWayTaskEpic)(taskId, wayIds, wayIdToKeep, dedupeVprommid));
    },
    fetchNextTask: function fetchNextTask() {
      return dispatch((0, _tasks.fetchNextWayTaskEpic)());
    },
    fetchTaskCount: function fetchTaskCount() {
      return dispatch((0, _tasks.fetchWayTaskCountEpic)());
    },
    skipTask: function skipTask(id) {
      return dispatch((0, _tasks.skipTask)(id));
    },
    _markTaskAsDone: function _markTaskAsDone(taskIds) {
      return dispatch((0, _tasks.markWayTaskPendingEpic)(taskIds));
    },
    _queryOsm: function _queryOsm(taskId, payload) {
      return dispatch((0, _osm.queryOsmEpic)(taskId, payload));
    },
    _deleteWays: function _deleteWays(taskId, wayIds) {
      return dispatch((0, _osm.deleteEntireWaysEpic)(taskId, wayIds));
    },
    setMapPosition: function setMapPosition(lng, lat, zoom) {
      return dispatch((0, _map.setMapPosition)(lng, lat, zoom));
    }
  };
}), (0, _recompose.lifecycle)({
  componentDidMount: function componentDidMount() {
    // TODO - data fetching for this page should be moved into a route container
    // fire to get all the provinces here.
    this.props.fetchProvinces();
    this.props.fetchNextTask();
    this.props.fetchTaskCount();
  }
}))(Tasks);


function insertPointOnLine(feature, point) {
  var nearest = (0, _pointOnLine2.default)(feature, point);
  var index = nearest.properties.index;

  var coordinates = feature.geometry.coordinates.slice();
  var targetIndex = index === 0 ? 0 : index === coordinates.length - 1 ? coordinates.length : (0, _distance2.default)(point, coordinates[index - 1]) < (0, _distance2.default)(point, coordinates[index + 1]) ? index : index + 1;
  coordinates.splice(targetIndex, 0, point.geometry.coordinates);
  return Object.assign({}, feature, {
    geometry: {
      type: 'LineString',
      coordinates: coordinates
    }
  });
}

},{"../actions/action-creators.js":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/actions/action-creators.js","../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../components/task-list-item":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/task-list-item.js","../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","../redux/modules/map":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/map.js","../redux/modules/osm":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/osm.js","../redux/modules/tasks":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/redux/modules/tasks.js","../utils/to-osm":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/utils/to-osm.js","@turf/distance":"@turf/distance","@turf/line-intersect":"@turf/line-intersect","@turf/meta":"@turf/meta","@turf/point-on-line":"@turf/point-on-line","lodash":"lodash","mapbox-gl":"mapbox-gl","moment":"moment","react":"react","react-redux":"react-redux","react-router":"react-router","react-select":"react-select","recompose":"recompose","turf-extent":"turf-extent","turf-point":"turf-point"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/uhoh.js":[function(require,module,exports){
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var UhOh = _react2.default.createClass({
  displayName: 'UhOh',

  render: function render() {
    return _react2.default.createElement(
      'div',
      { className: 'inpage__body' },
      _react2.default.createElement(
        'div',
        { className: 'inner' },
        _react2.default.createElement(
          'h2',
          null,
          _react2.default.createElement(
            _t2.default,
            null,
            'Page Not Found'
          )
        )
      )
    );
  }
});

module.exports = UhOh;

},{"../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","react":"react"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/views/upload.js":[function(require,module,exports){
'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _config = require('../config');

var _config2 = _interopRequireDefault(_config);

var _t = require('../components/t');

var _t2 = _interopRequireDefault(_t);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Upload = _react2.default.createClass({
  displayName: 'Upload',

  render: function render() {
    return _react2.default.createElement(
      'section',
      { className: 'inpage' },
      _react2.default.createElement(
        'header',
        { className: 'inpage__header' },
        _react2.default.createElement(
          'div',
          { className: 'inner' },
          _react2.default.createElement(
            'div',
            { className: 'inpage__headline' },
            _react2.default.createElement(
              'h1',
              { className: 'inpage__title' },
              _react2.default.createElement(
                _t2.default,
                null,
                'Upload'
              )
            )
          )
        )
      ),
      _react2.default.createElement(
        'div',
        { className: 'inpage__body' },
        _react2.default.createElement(
          'div',
          { className: 'inner' },
          _react2.default.createElement(
            'h2',
            null,
            _react2.default.createElement(
              _t2.default,
              null,
              'Upload RoadLabPro ZIP files'
            )
          ),
          _react2.default.createElement(
            'form',
            { className: 'form upload-form', method: 'post', encType: 'multipart/form-data', action: _config2.default.api + '/fielddata/properties/rlp' },
            _react2.default.createElement(
              'div',
              { className: 'form__group' },
              _react2.default.createElement(
                'label',
                { className: 'form__label', htmlFor: 'rlp-zip-properties' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'Road properties'
                )
              ),
              _react2.default.createElement(
                'div',
                { className: 'form__input-group form__input-group--medium' },
                _react2.default.createElement('input', { type: 'file', className: 'form__control', id: 'rlp-zip-properties', name: 'rlp-zip-properties', accept: '.zip' }),
                _react2.default.createElement(
                  'button',
                  { type: 'Submit', className: 'button button--primary-raised-dark', title: 'Submit' },
                  _react2.default.createElement(
                    'span',
                    null,
                    _react2.default.createElement(
                      _t2.default,
                      null,
                      'Upload'
                    )
                  )
                )
              )
            )
          ),
          _react2.default.createElement(
            'form',
            { className: 'form upload-form', method: 'post', encType: 'multipart/form-data', action: _config2.default.api + '/fielddata/geometries/rlp' },
            _react2.default.createElement(
              'div',
              { className: 'form__group' },
              _react2.default.createElement(
                'label',
                { className: 'form__label', htmlFor: 'rlp-zip-geometries' },
                _react2.default.createElement(
                  _t2.default,
                  null,
                  'Road geometries'
                )
              ),
              _react2.default.createElement(
                'div',
                { className: 'form__input-group form__input-group--medium' },
                _react2.default.createElement('input', { type: 'file', className: 'form__control', id: 'rlp-zip-geometries', name: 'rlp-zip-geometries', accept: '.zip' }),
                _react2.default.createElement(
                  'button',
                  { type: 'Submit', className: 'button button--primary-raised-dark', title: 'Submit' },
                  _react2.default.createElement(
                    'span',
                    null,
                    _react2.default.createElement(
                      _t2.default,
                      null,
                      'Upload'
                    )
                  )
                )
              )
            )
          )
        )
      )
    );
  }
});

module.exports = Upload;

},{"../components/t":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/components/t.js","../config":"/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/config.js","react":"react"}],"/home/tungst/Desktop/OpenRoads/pycba-webapp/node_modules/process/browser.js":[function(require,module,exports){
// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}]},{},["/home/tungst/Desktop/OpenRoads/pycba-webapp/app/assets/scripts/main.js"])

//# sourceMappingURL=bundle.js.map
